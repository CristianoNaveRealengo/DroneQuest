<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>VR Drone Racing - Cen√°rio Limpo</title>
        <meta name="description" content="Corrida de Drone VR - Cen√°rio Limpo Otimizado para Oculus">
        <!-- Evitar cache -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="0">

        <!-- A-Frame Core (Local) -->
        <script src="libs/aframe.min.js"></script>

        <!-- A-Frame Extras (Local) -->
        <script src="libs/aframe-extras.min.js"></script>
        <script src="libs/aframe-environment-component.min.js"></script>

        <!-- Componente Sky 360 - Carregar DEPOIS do A-Frame -->
        <script>
            console.log('üîß Registrando componente sky-360-loader...');

            AFRAME.registerComponent('sky-360-loader', {
                schema: {
                    src: { type: 'string', default: 'assets/textures/bg-1.jpeg' }
                },

                init: function () {
                    console.log('üåÜ Sky 360 Loader INICIADO');
                    console.log('üìÇ Caminho:', this.data.src);
                    this.loadSkyTexture();
                },

                loadSkyTexture: function () {
                    const loader = new THREE.TextureLoader();
                    const sky = this.el;

                    console.log('üì• Carregando textura:', this.data.src);

                    // Aguardar o mesh estar pronto
                    setTimeout(() => {
                        loader.load(
                            this.data.src,
                            (texture) => {
                                console.log('‚úÖ SUCESSO! Textura carregada:', {
                                    width: texture.image.width,
                                    height: texture.image.height
                                });

                                // For√ßar aplica√ß√£o da textura
                                const mesh = sky.getObject3D('mesh');
                                if (mesh && mesh.material) {
                                    console.log('üîß Material antes:', mesh.material);

                                    // Aplicar textura
                                    mesh.material.map = texture;
                                    mesh.material.needsUpdate = true;

                                    // Garantir que est√° vis√≠vel
                                    mesh.material.side = THREE.BackSide;
                                    mesh.material.transparent = false;
                                    mesh.material.opacity = 1;

                                    console.log('üîß Material depois:', mesh.material);
                                    console.log('‚úÖ Sky 360 APLICADO!');
                                } else {
                                    console.error('‚ùå Mesh ou material n√£o encontrado!');
                                }
                            },
                            (xhr) => {
                                const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
                                console.log(`üìä Progresso: ${percent}%`);
                            },
                            (error) => {
                                console.error('‚ùå ERRO ao carregar:', error);
                                console.error('‚ùå Caminho:', this.data.src);
                            }
                        );
                    }, 1000);
                }
            });

            console.log('‚úÖ Componente sky-360-loader registrado!');

        </script>

        <!-- Estilos CSS -->
        <link rel="stylesheet" type="text/css" href="css/style.css?v=1.0.2">

        <!-- Componente para Desabilitar Frustum Culling -->
        <script>
            AFRAME.registerComponent('frustum-culling-fix', {
                init: function () {
                    console.log('üîß Desabilitando frustum culling...');

                    this.el.addEventListener('model-loaded', () => {
                        console.log('‚úÖ Modelo carregado - aplicando fix de culling');

                        // Desabilitar frustum culling em todos os meshes
                        this.el.object3D.traverse((node) => {
                            if (node.isMesh) {
                                node.frustumCulled = false;
                                console.log('‚úÖ Frustum culling desabilitado para:', node.name);
                            }
                        });

                        // For√ßar renderiza√ß√£o sempre vis√≠vel
                        this.el.object3D.frustumCulled = false;

                        console.log('‚úÖ Fix de culling aplicado com sucesso!');
                    });
                }
            });
        </script>

    </head>

    <body>
        <!-- Scripts Essenciais (Limpo e Otimizado) -->
        <script src="js/experience-selector.js?v=2.0.0"></script>
        <script src="js/drone-controller.js?v=1.0.5"></script>
        <script src="js/vr-joystick-controls.js?v=1.0.0"></script>
        <script src="js/cockpit-hud-data.js?v=1.0.0"></script>
        <script src="js/checkpoint-system.js?v=1.0.2"></script>
        <script src="js/model-collision.js?v=1.0.1"></script>
        <script src="js/hover-animation.js?v=1.0.0"></script>

        <!-- √öNICA A-SCENE - ULTRA OTIMIZADA COM INSTANCIAMENTO -->
        <a-scene vr-mode-ui="enabled: true" webxr="requiredFeatures: local-floor"
            renderer="antialias: false; colorManagement: false; sortObjects: false; physicallyCorrectLights: false; powerPreference: high-performance; precision: mediump"
            mesh-instancing="enabled: true" experience-selector="defaultExperience: cockpit" stats>

            <!-- Assets -->
            <a-assets>
                <!-- Assets vazios - checkpoints agora s√£o formas b√°sicas individuais -->
            </a-assets>

            <!-- C√©u com Imagem (Ajustado e Alinhado) -->
            <!-- Ilumina√ß√£o Otimizada -->
            <a-light type="ambient" color="#ffffff" intensity="1.0"></a-light>
            <a-light type="hemisphere" color="#ffffff" groundColor="#8A7050" intensity="0.7"></a-light>

            <!-- Drone Principal - Cockpit VR -->
            <a-entity id="drone" position="0 3 0" drone-controller
                vr-joystick-controls="moveSpeed: 3.0; rotationSpeed: 1.2"
                hover-animation="enabled: true; amplitude: 0.08; duration: 2000">

                <!-- Cockpit VR - Nave Principal (Girado 180¬∞ para frente ficar correta) -->
                <a-gltf-model id="cockpit" position="0 0 0" rotation="0 180 0" scale="1.0 1.0 1.0"
                    model-collision="type: box; width: 2; height: 2; depth: 3; offsetY: 0; visible: false; bounceForce: 1.0"
                    gltf-model="assets/drone/cockpit_vr.glb" frustum-culling-fix>
                </a-gltf-model>

                <!-- HUD Fixo no Painel (na frente do usu√°rio, n√£o segue a cabe√ßa) -->
                <a-plane id="cockpit-hud" position="0.00887 1.3971 -1.78627" rotation="-16.58 0 0" width="2.4"
                    height="1.35" scale="0.574 0.75 1"
                    material="src: assets/drone/hud-01.svg; transparent: true; opacity: 0.5; shader: flat; depthWrite: false; depthTest: true"
                    cockpit-hud-data="" geometry="" visible="" render-order="-1">
                </a-plane>

                <!-- C√¢mera do Piloto - Dentro do Cockpit (Vis√£o Elevada) -->
                <!-- VIS√ÉO 360¬∞ TOTALMENTE LIBERADA: Passageiro pode olhar livremente ao redor -->
                <a-camera id="drone-camera" position="0 1.6 0.07007" rotation="0 0 0" wasd-controls="enabled: false"
                    look-controls="enabled: true; reverseMouseDrag: false; reverseTouchDrag: false; touchEnabled: true; mouseEnabled: true; pointerLockEnabled: false; magicWindowTrackingEnabled: true"
                    camera="far: 5000; near: 0.1">
                </a-camera>
            </a-entity>

            <!-- ========== CHECKPOINTS (ARGOLAS) - FORMAS B√ÅSICAS ========== -->

            <!-- Checkpoint 1 -->
            <a-torus id="checkpoint-1" position="0 3 -15" rotation="0 0 0" radius="3" radius-tubular="0.3"
                segments-radial="16" segments-tubular="32" color="#00ff00"
                material="transparent: true; opacity: 0.7; metalness: 0; roughness: 1; emissive: #00ff00; emissiveIntensity: 0.5; depthWrite: true; depthTest: true"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
                checkpoint="id: 1; nextCheckpoint: 2" render-order="1"></a-torus>
            </a-torus>

            <!-- Checkpoint 2 -->
            <a-torus id="checkpoint-2" position="10 4 -30" rotation="0 0 0" radius="3" radius-tubular="0.3"
                segments-radial="16" segments-tubular="32" color="#00ff00"
                material="transparent: true; opacity: 0.7; metalness: 0; roughness: 1; emissive: #00ff00; emissiveIntensity: 0.5; depthWrite: true; depthTest: true"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
                checkpoint="id: 2; nextCheckpoint: 3" render-order="1"></a-torus>
            </a-torus>

            <!-- Checkpoint 3 -->
            <a-torus id="checkpoint-3" position="-10 5 -45" rotation="0 0 0" radius="3" radius-tubular="0.3"
                segments-radial="16" segments-tubular="32" color="#00ff00"
                material="transparent: true; opacity: 0.7; metalness: 0; roughness: 1; emissive: #00ff00; emissiveIntensity: 0.5; depthWrite: true; depthTest: true"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
                checkpoint="id: 3; nextCheckpoint: 4" render-order="1"></a-torus>
            </a-torus>

            <!-- Checkpoint 4 -->
            <a-torus id="checkpoint-4" position="15 3 -60" rotation="0 0 0" radius="3" radius-tubular="0.3"
                segments-radial="16" segments-tubular="32" color="#00ff00"
                material="transparent: true; opacity: 0.7; metalness: 0; roughness: 1; emissive: #00ff00; emissiveIntensity: 0.5; depthWrite: true; depthTest: true"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
                checkpoint="id: 4; nextCheckpoint: 5" render-order="1"></a-torus>
            </a-torus>

            <!-- Checkpoint 5 -->
            <a-torus id="checkpoint-5" position="-5 6 -75" rotation="0 0 0" radius="3" radius-tubular="0.3"
                segments-radial="16" segments-tubular="32" color="#00ff00"
                material="transparent: true; opacity: 0.7; metalness: 0; roughness: 1; emissive: #00ff00; emissiveIntensity: 0.5; depthWrite: true; depthTest: true"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
                checkpoint="id: 5; nextCheckpoint: finish" render-order="1"></a-torus>
            </a-torus>

            <!-- NPCs removidos para performance -->
            <!--  ========== Ilumina√ß√£o  ==========-->
            <!-- Luz para o rosto da Abby -->
            <a-light type="point" position="-1.806 1.5 -2.5" color="#ffffff" intensity="2.0" distance="5"></a-light>

            <!-- Luz para o Untitled -->
            <a-light type="point" position="-0.3 1.5 -2.5" color="#ffffff" intensity="2.0" distance="5"></a-light>

            <!-- ========== CEN√ÅRIO ========== -->
            <!-- Sky e Ch√£o com Tamanho Balanceado -->
            <a-sky id="sky" src="assets/cenario/Sky-01.jpg" rotation="0 0 0" radius="500" segments-width="16"
                segments-height="8" color="#87CEEB">
            </a-sky>

            <!-- Ch√£o com Piso de Asfalto -->
            <a-plane id="ground-main" position="0 -1 0" rotation="-90 0 0" width="500" height="500"
                material="src: assets/cenario/Piso-asphalt.jpg; repeat: 50 50" segments-width="1" segments-height="1"
                shadow="receive: false" visible="true"></a-plane>

            <!-- Quadra com Colis√£o OTIMIZADA (VIS√çVEL PARA DEBUG) -->
            <a-gltf-model id="Quadra" position="-0.997 -2.20319 -0.264" scale="0.8 0.8 0.8"
                model-collision="type: box; width: 20; height: 5; depth: 30; offsetY: 2.5; visible: true; bounceForce: 1.0"
                gltf-model="assets/cenario/Quadra.glb">
            </a-gltf-model>

            <!-- Limitador Invis√≠vel - Paredes do Sky -->
            <a-entity id="sky-boundary" boundary-limiter="radius:1000"></a-entity>

            <!-- Controles VR Otimizados -->
            <a-entity id="leftHand" oculus-touch-controls="hand: left; model: false" quest-controls="hand: left"
                position="-0.5 1 -0.5">
            </a-entity>

            <a-entity id="rightHand" oculus-touch-controls="hand: right; model: false" quest-controls="hand: right"
                position="0.5 1 -0.5">
            </a-entity>

            <!-- Linha de chegada -->
            <a-entity geometry="primitive: box; width: 15; height: 0.3; depth: 1.5"
                material="color: #ff0000; transparent: true; opacity: 0.6" position="0 1 -50" finish-line></a-entity>
        </a-scene>

        <!-- Tela de carregamento -->
        <div id="loading">
            <h2>Carregando Cen√°rio VR...</h2>
            <h3>Prepare-se pra nova experiencia</h3>
            <small>Alfa - 1.0</small>
            <div class="progress-bar">
                <div class="progress"></div>
            </div>
        </div>

        <!-- Painel de Controles do Cockpit VR -->
        <div id="hud-help"
            style="position: fixed; top: 10px; right: 10px; background: rgba(0, 20, 30, 0.9); color: #00ffff; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; z-index: 1000; border: 2px solid #00ffff; max-width: 350px; box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);">
            <div style="font-weight: bold; margin-bottom: 10px; color: #00ff88; text-align: center; font-size: 14px;">ÔøΩ
                COCKPIT VR - PILOTO</div>

            <div style="color: #00ffff; font-weight: bold; margin: 8px 0 5px 0;">‚å®Ô∏è Desktop:</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">‚Üë/I</strong> - Frente | <strong
                    style="color: #00ff88;">‚Üì/K</strong> - Tr√°s</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">‚Üê/J</strong> - Esquerda | <strong
                    style="color: #00ff88;">‚Üí/L</strong> - Direita</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">W</strong> - Subir | <strong
                    style="color: #00ff88;">S</strong> - Descer</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">A/D</strong> - Girar</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">R</strong> - Reset</div>

            <div style="color: #00ffff; font-weight: bold; margin: 10px 0 5px 0;">ü•Ω VR (Quest):</div>
            <div style="margin-bottom: 5px;">üïπÔ∏è <strong>Esquerdo</strong> - Movimento (Frente/Tr√°s/Lateral)</div>
            <div style="margin-bottom: 5px;">üïπÔ∏è <strong>Direito</strong> - Rota√ß√£o (Yaw)</div>
            <div style="margin-bottom: 5px;">üîò <strong>X</strong> - Subir | <strong>Y</strong> - Descer</div>

            <div style="color: #00ffff; font-weight: bold; margin: 10px 0 5px 0;">üñ•Ô∏è HUD:</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">H</strong> - Alternar HUD</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">J</strong> - Ajustar Opacidade</div>
            <div style="margin-bottom: 5px;"><strong style="color: #00ff88;">+/-</strong> - Aumentar/Diminuir</div>

            <div style="color: #00ffff; font-weight: bold; margin: 10px 0 5px 0;">üìä Dados em Tempo Real:</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Velocidade com barra de progresso</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Altitude com marcador visual</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Bateria com indicador de cor</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Coordenadas GPS precisas</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Dist√¢ncia para checkpoint</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Modo de voo ativo</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Tempo de miss√£o</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì B√∫ssola com heading</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Horizonte artificial</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Indicador de roll</div>
            <div style="margin-bottom: 3px; font-size: 11px;">‚úì Status de sistemas (GPS/IMU/Motor/Link)</div>

            <div
                style="margin-top: 10px; padding-top: 8px; border-top: 1px solid #00ffff; font-size: 10px; opacity: 0.8;">
                üéØ Design futur√≠stico de drone racing<br>
                ü•Ω Compat√≠vel com Desktop e VR<br>
                üåê Integrado ao mundo 3D<br>
                ‚ö° Paralaxe din√¢mico suave<br>
                ‚ö†Ô∏è Sistema de avisos inteligente
            </div>
        </div>

        <script>

            // Componente Limitador de Fronteira do Sky
            AFRAME.registerComponent('boundary-limiter', {
                schema: {
                    radius: { type: 'number', default: 9900 }
                },

                init: function () {
                    console.log('üöß Limitador de Fronteira ativado - Raio:', this.data.radius);
                    this.drone = null;
                },

                tick: function () {
                    if (!this.drone) {
                        this.drone = document.querySelector('#drone');
                        if (!this.drone) return;
                    }

                    const dronePos = this.drone.object3D.position;
                    const distance = Math.sqrt(dronePos.x * dronePos.x + dronePos.z * dronePos.z);

                    // Se o drone ultrapassar o limite, empurr√°-lo de volta
                    if (distance > this.data.radius) {
                        const angle = Math.atan2(dronePos.z, dronePos.x);
                        dronePos.x = Math.cos(angle) * this.data.radius;
                        dronePos.z = Math.sin(angle) * this.data.radius;

                        console.log('‚ö†Ô∏è Drone atingiu o limite! Reposicionando...');
                    }
                }
            });

            // Componente de Diagn√≥stico do Solo
            AFRAME.registerComponent('ground-diagnostics', {
                init: function () {
                    console.log('üîç Diagn√≥stico do Solo Iniciado');

                    setTimeout(() => {
                        const ground = document.querySelector('#ground-main');
                        if (ground) {
                            const material = ground.getAttribute('material');
                            const position = ground.getAttribute('position');
                            const visible = ground.getAttribute('visible');
                            const geometry = ground.getAttribute('geometry');

                            console.log('üìä Estado do Solo:', {
                                visible: visible,
                                position: position,
                                material: material,
                                geometry: geometry,
                                object3D: ground.object3D ? 'OK' : 'ERRO'
                            });

                            // For√ßar renderiza√ß√£o
                            if (ground.object3D) {
                                ground.object3D.visible = true;
                                ground.object3D.renderOrder = -1; // Renderizar primeiro
                                console.log('‚úÖ Solo for√ßado a renderizar');
                            }

                            // Monitorar mudan√ßas
                            setInterval(() => {
                                if (ground.object3D && !ground.object3D.visible) {
                                    console.warn('‚ö†Ô∏è Solo ficou invis√≠vel! Reativando...');
                                    ground.object3D.visible = true;
                                }
                            }, 1000);
                        } else {
                            console.error('‚ùå Solo n√£o encontrado!');
                        }
                    }, 2000);
                }
            });

            // Componente de Otimiza√ß√£o VR Avan√ßada
            AFRAME.registerComponent('vr-performance-optimizer', {
                init: function () {
                    console.log('üöÄ Otimizador VR ativado');

                    // Configura√ß√µes agressivas de performance
                    const renderer = this.el.renderer;
                    if (renderer) {
                        // Reduzir qualidade de renderiza√ß√£o para VR
                        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
                        renderer.shadowMap.enabled = false;
                        renderer.shadowMap.autoUpdate = false;

                        // Configura√ß√µes de performance
                        renderer.powerPreference = "high-performance";
                        renderer.antialias = false;
                        renderer.stencil = false;
                        renderer.depth = true;
                        renderer.logarithmicDepthBuffer = false;
                    }

                    // Otimiza√ß√µes espec√≠ficas para Quest
                    this.optimizeForQuest();

                    // Monitorar performance e ajustar dinamicamente
                    this.startPerformanceMonitoring();
                },

                optimizeForQuest: function () {
                    // Detectar se est√° rodando no Quest
                    const isQuest = navigator.userAgent.includes('Quest') ||
                        navigator.userAgent.includes('Oculus');

                    if (isQuest) {
                        console.log('ü•Ω Quest detectado - aplicando otimiza√ß√µes espec√≠ficas');

                        // Reduzir ainda mais a qualidade para Quest
                        const scene = this.el;
                        scene.setAttribute('renderer', {
                            antialias: false,
                            colorManagement: false,
                            sortObjects: false,
                            physicallyCorrectLights: false,
                            gammaFactor: 2.2,
                            highRefreshRate: true,
                            foveationLevel: 0, // Desativado para evitar desfoque
                            multiview: true
                        });

                        // Reduzir fog distance para Quest
                        scene.setAttribute('fog', {
                            type: 'linear',
                            color: '#87CEEB',
                            near: 500,
                            far: 1000
                        });
                    }
                },

                startPerformanceMonitoring: function () {
                    let frameCount = 0;
                    let lastTime = performance.now();
                    let lowFPSCount = 0;

                    const monitor = () => {
                        frameCount++;
                        const currentTime = performance.now();

                        if (currentTime - lastTime >= 1000) {
                            const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));

                            // Se FPS baixo, aplicar otimiza√ß√µes emergenciais
                            if (fps < 60) {
                                lowFPSCount++;
                                if (lowFPSCount >= 3) {
                                    this.applyEmergencyOptimizations();
                                    lowFPSCount = 0;
                                }
                            } else {
                                lowFPSCount = 0;
                            }

                            frameCount = 0;
                            lastTime = currentTime;
                        }

                        requestAnimationFrame(monitor);
                    };

                    monitor();
                },

                applyEmergencyOptimizations: function () {
                    console.log('‚ö° Aplicando otimiza√ß√µes emergenciais');

                    // Cen√°rio j√° est√° limpo - sem elementos para ocultar
                    console.log('‚ö° Cen√°rio limpo - sem elementos adicionais para otimizar');

                    // Desabilitar anima√ß√µes n√£o essenciais
                    const props = document.querySelectorAll('[id^="prop"]');
                    props.forEach(prop => {
                        const anim = prop.getAttribute('animation');
                        if (anim) {
                            prop.setAttribute('animation', {
                                ...anim,
                                dur: 1000 // Anima√ß√£o mais lenta
                            });
                        }
                    });

                    // Reduzir fog distance no cen√°rio limpo
                    this.el.setAttribute('fog', {
                        type: 'linear',
                        color: '#87CEEB',
                        near: 500,
                        far: 1000
                    });
                }
            });

            // Componente simples para sincronizar c√¢mera VR
            AFRAME.registerComponent('vr-camera-sync', {
                init: function () {
                    console.log('ü•Ω Sincroniza√ß√£o VR ativada');

                    this.browserState = {
                        position: this.el.getAttribute('position'),
                        rotation: this.el.getAttribute('rotation')
                    };

                    // Posi√ß√£o da c√¢mera para VR (embaixo do drone)
                    this.vrCameraPosition = { x: 0, y: -2.0, z: -0.5 }; // MUITO embaixo do drone
                    this.vrCameraRotation = { x: 10, y: 0, z: 0 }; // Olhando para baixo

                    // Capturar estado da c√¢mera antes de entrar no VR
                    this.el.sceneEl.addEventListener('enter-vr', () => {
                        console.log('üì± Entrando no VR - Posicionando c√¢mera embaixo do drone...');
                        this.positionCameraForVR();
                    });

                    // M√©todo para posicionar c√¢mera no VR
                    this.positionCameraForVR = () => {
                        // Aplicar posi√ß√£o espec√≠fica para VR (embaixo do drone) m√∫ltiplas vezes
                        for (let i = 0; i < 5; i++) {
                            setTimeout(() => {
                                this.el.setAttribute('position', this.vrCameraPosition);
                                this.el.setAttribute('rotation', this.vrCameraRotation);
                                console.log(`‚úÖ Tentativa ${i + 1}: C√¢mera VR posicionada embaixo do drone`);
                            }, 100 * (i + 1));
                        }
                    };

                    // Restaurar posi√ß√£o original ao sair do VR
                    this.el.sceneEl.addEventListener('exit-vr', () => {
                        console.log('üñ•Ô∏è Saindo do VR - Restaurando posi√ß√£o original...');
                        setTimeout(() => {
                            this.el.setAttribute('position', this.browserState.position);
                            this.el.setAttribute('rotation', this.browserState.rotation);
                        }, 100);
                    });

                    // Monitoramento cont√≠nuo
                    setInterval(() => {
                        if (this.el.sceneEl.is('vr-mode')) {
                            // Se estiver em VR, for√ßar posi√ß√£o embaixo do drone
                            const currentPos = this.el.getAttribute('position');
                            if (currentPos.y > -1.5) { // Se n√£o estiver embaixo suficiente
                                this.el.setAttribute('position', this.vrCameraPosition);
                                this.el.setAttribute('rotation', this.vrCameraRotation);
                                console.log('üîÑ For√ßando c√¢mera para baixo do drone');
                            }
                        } else {
                            // Se n√£o estiver em VR, atualizar estado do navegador
                            this.browserState.position = this.el.getAttribute('position');
                            this.browserState.rotation = this.el.getAttribute('rotation');
                        }
                    }, 200);
                }
            });

            // Inicializar o jogo quando a cena estiver carregada
            document.addEventListener('DOMContentLoaded', function () {
                console.log('üéÆ Jogo carregado - Drone pronto!');

                // Esconder loading ap√≥s 2 segundos (fallback)
                setTimeout(function () {
                    const loading = document.getElementById('loading');
                    if (loading) {
                        loading.style.display = 'none';
                        console.log('‚úÖ Tela de loading escondida');
                    }
                }, 2000);

                const scene = document.querySelector('a-scene');
                scene.addEventListener('loaded', function () {
                    console.log('‚úÖ Cena carregada com sucesso!');

                    // Esconder tela de carregamento imediatamente
                    const loading = document.getElementById('loading');
                    if (loading) {
                        loading.style.display = 'none';
                    }

                    // Iniciar o jogo ap√≥s 1 segundo
                    setTimeout(function () {
                        const gameManager = document.querySelector('[game-manager]');
                        if (gameManager && gameManager.components['game-manager']) {
                            gameManager.components['game-manager'].startGame();
                            console.log('‚úÖ Jogo iniciado!');
                        } else {
                            console.log('‚ö†Ô∏è Game manager n√£o encontrado (opcional)');
                        }

                        console.log('‚úÖ Jogo inicializado com sucesso!');

                        // Verificar sky 360
                        const mainSky = document.querySelector('#main-sky');
                        console.log('üåÜ Sky 360 bg-6 carregado:', mainSky?.getAttribute('src'));

                        // Verificar se o HUD Controller foi carregado
                        setTimeout(() => {
                            const camera = document.querySelector('#drone-camera');
                            const hudComponent = camera?.components?.['hud-controller'];

                            if (hudComponent) {
                                console.log('üéØ HUD Controller carregado com sucesso!');
                                console.log('üìä Configura√ß√µes do HUD:', {
                                    width: hudComponent.data.hudWidth,
                                    height: hudComponent.data.hudHeight,
                                    transparency: hudComponent.data.transparency,
                                    distance: hudComponent.data.hudDistance
                                });
                            } else {
                                console.warn('‚ö†Ô∏è HUD Controller n√£o foi carregado!');
                            }
                        }, 1000);

                        // Ocultar painel de ajuda do HUD ap√≥s 8 segundos
                        setTimeout(() => {
                            const hudHelp = document.getElementById('hud-help');
                            if (hudHelp) {
                                hudHelp.style.opacity = '0.3';
                                hudHelp.style.transition = 'opacity 1s ease-out';
                            }
                        }, 8000);

                        // Ocultar completamente ap√≥s 15 segundos
                        setTimeout(() => {
                            const hudHelp = document.getElementById('hud-help');
                            if (hudHelp) {
                                hudHelp.style.display = 'none';
                            }
                        }, 15000);
                    }, 2000);
                });
            });
        </script>
    </body>

</html>