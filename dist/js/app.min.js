AFRAME.registerComponent("audio-system",{schema:{masterVolume:{type:"number",default:.7},musicVolume:{type:"number",default:.4},sfxVolume:{type:"number",default:.8},ambientVolume:{type:"number",default:.3},enableAudio:{type:"boolean",default:!0},enable3D:{type:"boolean",default:!0}},init:function(){console.log("üéµ Inicializando sistema de √°udio..."),this.audioContext=null,this.audioSources={},this.audioBuffers={},this.currentMusic=null,this.ambientSounds=[],this.isInitialized=!1,this.isMuted=!1,this.setupAudioSystem(),this.createAudioSources(),this.setupEventListeners(),console.log("‚úÖ Sistema de √°udio inicializado!"),console.log("üîä √Åudio iniciado ativo - Pressione M para mutar"),this.showAudioActiveIndicator()},setupAudioSystem:function(){if(this.data.enableAudio)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.musicGain=this.audioContext.createGain(),this.sfxGain=this.audioContext.createGain(),this.ambientGain=this.audioContext.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain.connect(this.masterGain),this.ambientGain.connect(this.masterGain),this.masterGain.connect(this.audioContext.destination),this.updateVolumes(),this.isInitialized=!0,console.log("üéõÔ∏è Contexto de √°udio configurado"),this.isMuted&&(this.isMuted=!1,console.log("üîä For√ßando √°udio ativo na inicializa√ß√£o"),this.updateVolumes())}catch(t){console.warn("‚ö†Ô∏è Erro ao inicializar contexto de √°udio:",t)}else console.log("‚ÑπÔ∏è √Åudio desabilitado")},createAudioSources:function(){console.log("üéº Criando fontes de √°udio..."),this.createBackgroundMusic(),this.createDroneSounds(),this.createAmbientSounds(),this.createUISounds()},createBackgroundMusic:function(){this.backgroundMusic={isPlaying:!1,oscillators:[],gainNodes:[]},this.startBackgroundMusic()},startBackgroundMusic:function(){if(!this.isInitialized||this.backgroundMusic.isPlaying)return;console.log("üéµ Iniciando m√∫sica ambiente...");[[220,277,330],[196,247,294],[262,330,392],[233,294,349]].forEach((t,e)=>{setTimeout(()=>{this.playChord(t,4e3)},4e3*e)}),this.musicInterval=setInterval(()=>{this.startBackgroundMusic()},16e3),this.backgroundMusic.isPlaying=!0},playChord:function(t,e){if(!this.isInitialized)return;const i=[],o=[];t.forEach((t,n)=>{const s=this.audioContext.createOscillator(),a=this.audioContext.createGain();s.type="sine",s.frequency.setValueAtTime(t,this.audioContext.currentTime),a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(.1,this.audioContext.currentTime+.5),a.gain.setValueAtTime(.1,this.audioContext.currentTime+e/1e3-.5),a.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+e/1e3),s.connect(a),a.connect(this.musicGain),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+e/1e3),i.push(s),o.push(a)})},createDroneSounds:function(){console.log("üöÅ Configurando sons do drone..."),this.droneSounds={propellers:null,engine:null,boost:null,landing:null},this.createPropellerSound()},createPropellerSound:function(){if(!this.isInitialized)return;const t=2*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);for(let e=0;e<t;e++)i[e]=2*Math.random()-1;this.propellerBuffer=e},playPropellerSound:function(t=1){if(!this.isInitialized||!this.propellerBuffer)return;this.droneSounds.propellers&&this.droneSounds.propellers.source.stop();const e=this.audioContext.createBufferSource(),i=this.audioContext.createGain(),o=this.audioContext.createBiquadFilter();e.buffer=this.propellerBuffer,e.loop=!0,o.type="lowpass",o.frequency.setValueAtTime(800+400*t,this.audioContext.currentTime);const n=this.isMuted?0:.3*t;i.gain.setValueAtTime(n,this.audioContext.currentTime),e.connect(o),o.connect(i),i.connect(this.sfxGain),e.start(),this.droneSounds.propellers={source:e,gain:i,filter:o,intensity:t}},stopPropellerSound:function(){this.droneSounds.propellers&&(this.droneSounds.propellers.source.stop(),this.droneSounds.propellers=null)},createAmbientSounds:function(){console.log("üèôÔ∏è Configurando sons ambiente urbanos..."),this.ambientSounds=[],this.createWindSound(),this.createTrafficSound()},createWindSound:function(){if(!this.isInitialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.type="sawtooth",t.frequency.setValueAtTime(60,this.audioContext.currentTime),i.type="lowpass",i.frequency.setValueAtTime(200,this.audioContext.currentTime),i.Q.setValueAtTime(.5,this.audioContext.currentTime),e.gain.setValueAtTime(.1,this.audioContext.currentTime);const o=this.audioContext.createOscillator(),n=this.audioContext.createGain();o.type="sine",o.frequency.setValueAtTime(.1,this.audioContext.currentTime),n.gain.setValueAtTime(.05,this.audioContext.currentTime),o.connect(n),n.connect(e.gain),t.connect(i),i.connect(e),e.connect(this.ambientGain),t.start(),o.start(),this.ambientSounds.push({oscillator:t,gainNode:e,lfo:o})},createTrafficSound:function(){if(!this.isInitialized)return;const t=5*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);let o=0,n=0,s=0,a=0,r=0,l=0,c=0;for(let e=0;e<t;e++){const t=2*Math.random()-1;o=.99886*o+.0555179*t,n=.99332*n+.0750759*t,s=.969*s+.153852*t,a=.8665*a+.3104856*t,r=.55*r+.5329522*t,l=-.7616*l-.016898*t,i[e]=.11*(o+n+s+a+r+l+c+.5362*t),c=.115926*t}const d=this.audioContext.createBufferSource(),h=this.audioContext.createGain(),u=this.audioContext.createBiquadFilter();d.buffer=e,d.loop=!0,u.type="lowpass",u.frequency.setValueAtTime(300,this.audioContext.currentTime),h.gain.setValueAtTime(.05,this.audioContext.currentTime),d.connect(u),u.connect(h),h.connect(this.ambientGain),d.start(),this.ambientSounds.push({source:d,gainNode:h})},createUISounds:function(){console.log("üîä Configurando sons de interface..."),this.uiSounds={checkpoint:this.createBeepSound(800,.1,.2),finish:this.createBeepSound(1200,.3,.5),error:this.createBeepSound(300,.2,.3)}},createBeepSound:function(t,e,i){return()=>{if(!this.isInitialized)return;const o=this.audioContext.createOscillator(),n=this.audioContext.createGain();o.type="sine",o.frequency.setValueAtTime(t,this.audioContext.currentTime),n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.01),n.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+e),o.connect(n),n.connect(this.sfxGain),o.start(),o.stop(this.audioContext.currentTime+e)}},setupEventListeners:function(){this.el.addEventListener("checkpoint-reached",()=>{this.playCheckpointSound()}),this.el.addEventListener("race-finished",()=>{this.playFinishSound()}),this.el.addEventListener("drone-crash",()=>{this.playErrorSound()}),this.el.addEventListener("drone-throttle-change",t=>{this.updatePropellerSound(t.detail.intensity)}),this.setupUserInteractionHandler()},setupUserInteractionHandler:function(){const t=()=>{this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then(()=>{console.log("üîä Contexto de √°udio ativado pela intera√ß√£o do usu√°rio")})};["click","keydown","touchstart"].forEach(e=>{document.addEventListener(e,t,{once:!0})}),this.el.sceneEl.addEventListener("enter-vr",t,{once:!0})},playCheckpointSound:function(){this.uiSounds&&this.uiSounds.checkpoint&&this.uiSounds.checkpoint()},playFinishSound:function(){this.uiSounds&&this.uiSounds.finish&&this.uiSounds.finish()},playErrorSound:function(){this.uiSounds&&this.uiSounds.error&&this.uiSounds.error()},updatePropellerSound:function(t){t>.1?this.playPropellerSound(t):this.stopPropellerSound()},updateVolumes:function(){if(!this.isInitialized)return;console.log(`üîç Estado do √°udio: isMuted=${this.isMuted}, masterVolume=${this.data.masterVolume}`);const t=this.isMuted?0:this.data.masterVolume;console.log(`üéõÔ∏è Atualizando volumes - Master: ${t.toFixed(2)}, SFX: ${this.data.sfxVolume.toFixed(2)}, Muted: ${this.isMuted}`),this.masterGain.gain.setValueAtTime(t,this.audioContext.currentTime),this.musicGain.gain.setValueAtTime(this.data.musicVolume,this.audioContext.currentTime),this.sfxGain.gain.setValueAtTime(this.data.sfxVolume,this.audioContext.currentTime),this.ambientGain.gain.setValueAtTime(this.data.ambientVolume,this.audioContext.currentTime),this.updateDroneVolume()},toggleMute:function(){this.isMuted=!this.isMuted,this.updateVolumes(),console.log(this.isMuted?"üîá √Åudio mutado":"üîä √Åudio ativado"),this.updateDroneVolume(),this.isMuted?this.showMuteIndicator():this.hideMuteIndicator()},updateDroneVolume:function(){if(this.droneSounds.propellers){const t=this.droneSounds.propellers.intensity,e=this.isMuted?0:.3*t;console.log(`üöÅ Atualizando volume do drone - Intensidade: ${t.toFixed(2)}, Volume efetivo: ${e.toFixed(2)}`),this.droneSounds.propellers.gain.gain.setValueAtTime(e,this.audioContext.currentTime)}},showMuteIndicator:function(){this.hideMuteIndicator();const t=document.createElement("div");t.id="mute-indicator",t.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: rgba(255, 0, 0, 0.8);\n            color: white;\n            padding: 10px 15px;\n            border-radius: 5px;\n            font-family: Arial, sans-serif;\n            font-size: 14px;\n            font-weight: bold;\n            z-index: 1000;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.3);\n            animation: pulse 2s infinite;\n        ",t.innerHTML="üîá √ÅUDIO MUDO<br><small>Pressione M para ativar</small>";const e=document.createElement("style");e.textContent="\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n        ",document.head.appendChild(e),document.body.appendChild(t),this.muteIndicatorElement=t},hideMuteIndicator:function(){this.muteIndicatorElement&&this.muteIndicatorElement.parentNode&&(this.muteIndicatorElement.parentNode.removeChild(this.muteIndicatorElement),this.muteIndicatorElement=null)},showAudioActiveIndicator:function(){const t=document.createElement("div");t.style.cssText="\n\t\t\tposition: fixed;\n\t\t\ttop: 20px;\n\t\t\tright: 20px;\n\t\t\tbackground: rgba(0, 255, 0, 0.8);\n\t\t\tcolor: white;\n\t\t\tpadding: 10px 15px;\n\t\t\tborder-radius: 5px;\n\t\t\tfont-family: Arial, sans-serif;\n\t\t\tfont-size: 14px;\n\t\t\tfont-weight: bold;\n\t\t\tz-index: 1000;\n\t\t\tpointer-events: none;\n\t\t\tbox-shadow: 0 2px 10px rgba(0,0,0,0.3);\n\t\t",t.innerHTML="üîä √ÅUDIO ATIVO<br><small>Pressione M para mutar</small>",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)},setMasterVolume:function(t){this.data.masterVolume=Math.max(0,Math.min(1,t)),console.log(`üîä Master volume ajustado para: ${this.data.masterVolume.toFixed(2)}`),this.updateVolumes()},setMusicVolume:function(t){this.data.musicVolume=Math.max(0,Math.min(1,t)),this.updateVolumes()},setSFXVolume:function(t){this.data.sfxVolume=Math.max(0,Math.min(1,t)),this.updateVolumes()},setAmbientVolume:function(t){this.data.ambientVolume=Math.max(0,Math.min(1,t)),this.updateVolumes()},remove:function(){console.log("üßπ Limpando sistema de √°udio..."),this.musicInterval&&clearInterval(this.musicInterval),this.stopPropellerSound(),this.ambientSounds.forEach(t=>{t.oscillator&&t.oscillator.stop(),t.source&&t.source.stop(),t.lfo&&t.lfo.stop()}),this.hideMuteIndicator(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close()},createTone:function(t,e,i){if(this.isInitialized){i=i||.3;try{const o=this.audioContext.createOscillator(),n=this.audioContext.createGain();o.type="sine",o.frequency.setValueAtTime(t,this.audioContext.currentTime),n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.01),n.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+e/1e3),o.connect(n),n.connect(this.sfxGain),o.start(this.audioContext.currentTime),o.stop(this.audioContext.currentTime+e/1e3)}catch(t){console.warn("‚ö†Ô∏è Erro ao criar tom:",t)}}}}),window.AudioUtils={dbToGain:function(t){return Math.pow(10,t/20)},gainToDb:function(t){return 20*Math.log10(t)},smoothStep:function(t,e,i){const o=Math.max(0,Math.min(1,(i-t)/(e-t)));return o*o*(3-2*o)}},console.log("üì¶ M√≥dulo audio-system.js carregado com sucesso!"),AFRAME.components.checkpoint||AFRAME.registerComponent("checkpoint",{schema:{id:{type:"number",default:1},activated:{type:"boolean",default:!1},required:{type:"boolean",default:!0},points:{type:"number",default:100},timeBonus:{type:"number",default:5}},init:function(){console.log(`üéØ Inicializando checkpoint ${this.data.id}...`),this.isActivated=!1,this.glowEffect=null,this.particleSystem=null,this.proximityThreshold=4,this.activationRadius=2,this.lastDronePosition=null,this.hasEnteredZone=!1,this.setupCollisionDetection(),this.setupVisualEffects(),this.setupAudio(),console.log(`‚úÖ Checkpoint ${this.data.id} configurado!`)},setupCollisionDetection:function(){this.proximityCheck=setInterval(()=>{this.checkProximity()},100)},setupVisualEffects:function(){this.el.setAttribute("animation__pulse",{property:"scale",to:"1.1 1.1 1.1",dur:2e3,dir:"alternate",loop:!0,easing:"easeInOutSine"}),this.el.setAttribute("animation__rotate",{property:"rotation",to:"0 360 0",dur:6e3,loop:!0,easing:"linear"}),this.createParticleEffect()},createParticleEffect:function(){for(let t=0;t<8;t++){const e=document.createElement("a-sphere"),i=t/8*Math.PI*2,o=5;e.setAttribute("geometry",{radius:.1}),e.setAttribute("material",{color:"#00ff00",emissive:"#004400",transparent:!0,opacity:.6}),e.setAttribute("position",{x:Math.cos(i)*o,y:2*Math.sin(2*i),z:Math.sin(i)*o}),e.setAttribute("animation",{property:"position",to:`${Math.cos(i+Math.PI)*o} ${2*Math.sin(2*(i+Math.PI))} ${Math.sin(i+Math.PI)*o}`,dur:4e3,dir:"alternate",loop:!0,easing:"easeInOutSine"}),this.el.appendChild(e)}},setupAudio:function(){this.audioSystem=null},onCollision:function(t){const e=t.detail.target;e&&"drone"===e.id&&!this.isActivated&&this.activateCheckpoint()},checkProximity:function(){if(this.isActivated)return;const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=this.el.getAttribute("position"),o=this.calculateDistance(e,i);if(o<this.activationRadius){if(this.hasEnteredZone||(this.hasEnteredZone=!0,console.log(`üéØ Drone entrou na zona do checkpoint ${this.data.id}`)),this.lastDronePosition&&this.hasEnteredZone){this.checkPassageThrough(this.lastDronePosition,e,i)&&this.activateCheckpoint()}}else o>this.proximityThreshold&&(this.hasEnteredZone=!1);this.lastDronePosition={x:e.x,y:e.y,z:e.z},this.updateProximityEffect(o)},checkPassageThrough:function(t,e,i){this.calculateDistance(t,i);const o=this.calculateDistance(e,i),n=e.x-t.x,s=e.y-t.y,a=e.z-t.z;return Math.sqrt(n*n+s*s+a*a)>.5&&o<1.5},calculateDistance:function(t,e){const i=t.x-e.x,o=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+o*o+n*n)},updateProximityEffect:function(t){const e=Math.max(0,1-t/15);this.el.setAttribute("material",{emissiveIntensity:.5*e})},activateCheckpoint:function(){this.isActivated||(console.log(`üéØ Checkpoint ${this.data.id} ativado!`),this.isActivated=!0,this.data.activated=!0,this.proximityCheck&&clearInterval(this.proximityCheck),this.playActivationEffects(),this.playActivationSound(),this.addPoints(),this.notifyGameManager(),this.triggerHapticFeedback())},playActivationEffects:function(){this.el.setAttribute("material",{color:"#ffd700",emissive:"#ffaa00",emissiveIntensity:.8}),this.el.setAttribute("animation__activation",{property:"scale",from:"1 1 1",to:"1.5 1.5 1.5",dur:300,dir:"alternate",loop:2,easing:"easeOutElastic"}),this.createCelebrationParticles(),this.createFloatingText()},createCelebrationParticles:function(){const t=this.el.getAttribute("position");for(let e=0;e<20;e++){const e=document.createElement("a-sphere");e.setAttribute("geometry",{radius:.05}),e.setAttribute("material",{color:"#ffd700",emissive:"#ffaa00"});const i=10*(Math.random()-.5),o=8*Math.random()+2,n=10*(Math.random()-.5);e.setAttribute("position",{x:t.x,y:t.y,z:t.z}),e.setAttribute("animation",{property:"position",to:`${t.x+i} ${t.y+o} ${t.z+n}`,dur:2e3,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:2e3,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2100)}},createFloatingText:function(){const t=this.el.getAttribute("position"),e=document.createElement("a-text");e.setAttribute("value",`CHECKPOINT ${this.data.id}\n+${this.data.points} PONTOS`),e.setAttribute("color","#ffd700"),e.setAttribute("scale","4 4 4"),e.setAttribute("align","center"),e.setAttribute("position",{x:t.x,y:t.y+2,z:t.z}),e.setAttribute("animation__grow",{property:"scale",from:"0.1 0.1 0.1",to:"4 4 4",dur:500,easing:"easeOutBack"}),e.setAttribute("animation__move",{property:"position",to:`${t.x} ${t.y+6} ${t.z}`,dur:3e3,delay:500,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:2e3,delay:1500,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),this.createPointExplosion(t),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},4e3)},createPointExplosion:function(t){for(let e=0;e<8;e++){const i=document.createElement("a-text");i.setAttribute("value",`+${Math.floor(this.data.points/8)}`),i.setAttribute("color","#00ff00"),i.setAttribute("scale","2 2 2"),i.setAttribute("align","center");const o=e/8*Math.PI*2,n=3,s=t.x+Math.cos(o)*n,a=t.z+Math.sin(o)*n;i.setAttribute("position",{x:t.x,y:t.y+1,z:t.z}),i.setAttribute("animation",{property:"position",to:`${s} ${t.y+4} ${a}`,dur:1500,easing:"easeOutQuad"}),i.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:1500,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},1600)}},playActivationSound:function(){this.audioSystem||(this.audioSystem=this.el.sceneEl.components["audio-system"]),this.audioSystem&&this.audioSystem.createTone?this.audioSystem.createTone(800,300,.3):this.playSyntheticSound()},playSyntheticSound:function(){if("undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext){const t=new(AudioContext||webkitAudioContext),e=t.createOscillator(),i=t.createGain();e.connect(i),i.connect(t.destination),e.frequency.setValueAtTime(800,t.currentTime),e.frequency.exponentialRampToValueAtTime(1200,t.currentTime+.1),e.frequency.exponentialRampToValueAtTime(600,t.currentTime+.3),i.gain.setValueAtTime(.3,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.start(t.currentTime),e.stop(t.currentTime+.5)}},notifyGameManager:function(){this.el.sceneEl.emit("checkpoint-reached",{id:this.data.id,points:this.data.points,timeBonus:this.data.timeBonus,position:this.el.getAttribute("position")}),this.el.emit("checkpoint-reached",{id:this.data.id,points:this.data.points,timeBonus:this.data.timeBonus,position:this.el.getAttribute("position")})},triggerHapticFeedback:function(){const t=document.querySelector("#leftHand"),e=document.querySelector("#rightHand");t&&t.components.haptics&&t.components.haptics.pulse(.8,200),e&&e.components.haptics&&e.components.haptics.pulse(.8,200)},reset:function(){console.log(`üîÑ Resetando checkpoint ${this.data.id}...`),this.isActivated=!1,this.data.activated=!1,this.el.setAttribute("material",{color:"#00ff00",emissive:"#002200",emissiveIntensity:.3}),this.proximityCheck&&clearInterval(this.proximityCheck),this.proximityCheck=setInterval(()=>{this.checkProximity()},100)},remove:function(){this.proximityCheck&&clearInterval(this.proximityCheck)}}),AFRAME.components["finish-line"]||AFRAME.registerComponent("finish-line",{init:function(){console.log("üèÅ Configurando linha de chegada..."),this.proximityCheck=setInterval(()=>{this.checkFinishProximity()},100),this.el.setAttribute("animation",{property:"material.opacity",from:.7,to:.3,dur:1e3,dir:"alternate",loop:!0})},checkFinishProximity:function(){const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=this.el.getAttribute("position"),o=e.x-i.x,n=e.y-i.y,s=e.z-i.z;Math.sqrt(o*o+n*n+s*s)<5&&this.onFinish()},onFinish:function(){console.log("üèÅ Drone cruzou a linha de chegada!"),this.proximityCheck&&clearInterval(this.proximityCheck),this.el.sceneEl.emit("race-finished",{position:this.el.getAttribute("position"),time:Date.now()})},addPoints:function(){let t=this.data.points;const e=document.querySelector("[game-manager]");if(e&&e.components["game-manager"]){const i=e.components["game-manager"];i.addScore&&i.addScore(t),this.showPointsDisplay(t)}console.log(`üí∞ +${t} pontos pelo checkpoint ${this.data.id}!`)},showPointsDisplay:function(t){const e=document.createElement("a-text"),i=this.el.getAttribute("position");e.setAttribute("value",`+${t} pts`),e.setAttribute("position",{x:i.x,y:i.y+2,z:i.z}),e.setAttribute("align","center"),e.setAttribute("color","#00ff00"),e.setAttribute("scale","3 3 3"),e.setAttribute("animation",{property:"position",to:`${i.x} ${i.y+8} ${i.z}`,dur:2e3,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:2e3,delay:500,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2500)},reset:function(){console.log(`üîÑ Resetando checkpoint ${this.data.id}...`),this.isActivated=!1,this.data.activated=!1,this.el.setAttribute("material",{color:"#00ff00",emissive:"#004400",emissiveIntensity:.3}),this.el.removeAttribute("animation__activation"),this.proximityCheck&&clearInterval(this.proximityCheck),this.setupCollisionDetection(),console.log(`‚úÖ Checkpoint ${this.data.id} resetado!`)},remove:function(){this.proximityCheck&&clearInterval(this.proximityCheck)}}),console.log("üì¶ M√≥dulo checkpoint-system.js carregado com sucesso!"),AFRAME.components["collision-system"]||AFRAME.registerComponent("collision-system",{schema:{enabled:{type:"boolean",default:!0},bounceForce:{type:"number",default:.5},damageOnCollision:{type:"boolean",default:!1},showEffects:{type:"boolean",default:!0},soundEnabled:{type:"boolean",default:!0}},init:function(){console.log("üí• Inicializando sistema de colis√£o..."),this.isColliding=!1,this.lastCollisionTime=0,this.collisionCooldown=500,this.drone=null,this.droneController=null,this.setupCollisionDetection(),this.setupCollisionEffects(),console.log("‚úÖ Sistema de colis√£o configurado!"),setTimeout(()=>{this.activateCollisionDetection()},1e3)},activateCollisionDetection:function(){console.log("üí• Sistema de colis√£o ativado"),this.isActive=!0},setupCollisionDetection:function(){this.drone=document.querySelector("#drone"),this.drone&&(this.droneController=this.drone.components["drone-controller"]),this.collisionCheck=setInterval(()=>{this.checkCollisions()},50)},setupCollisionEffects:function(){this.setupCollisionSounds()},setupCollisionSounds:function(){this.createSyntheticSounds()},createSyntheticSounds:function(){console.log("üîä Sons de colis√£o configurados via Web Audio API")},checkCollisions:function(){if(!this.data.enabled||!this.drone)return;const t=this.drone.getAttribute("position");if(!t)return;const e=this.detectCollision(t);e&&this.handleSolidCollision(e,t)},detectCollision:function(t){const e=this.checkBuildingCollisions(t);if(e)return e;const i=this.checkObstacleCollisions(t);if(i)return i;const o=this.checkTreeCollisions(t);if(o)return o;const n=this.checkBoundaryCollisions(t);return n||null},checkBuildingCollisions:function(t){const e=document.querySelectorAll(".building");for(let i of e){const e=i.getAttribute("position"),o=i.getAttribute("geometry");if(this.isInsideBuilding(t,e,o))return{type:"building",object:i,position:e,geometry:o,normal:this.calculateBuildingNormal(t,e,o)}}return null},checkObstacleCollisions:function(t){const e=document.querySelectorAll(".tower, .crane, .billboard, .antenna");for(let i of e){const e=i.getAttribute("position"),o=this.calculateDistance(t,e);let n=3;if(i.classList.contains("tower")&&(n=2),i.classList.contains("crane")&&(n=4),i.classList.contains("billboard")&&(n=3),i.classList.contains("antenna")&&(n=1.5),o<n)return{type:"obstacle",object:i,position:e,radius:n,normal:this.calculateObstacleNormal(t,e)}}return null},checkTreeCollisions:function(t){const e=document.querySelectorAll(".tree");for(let i of e){const e=i.getAttribute("position"),o=2.5;if(this.calculateDistance(t,e)<o)return{type:"tree",object:i,position:e,radius:o,normal:this.calculateObstacleNormal(t,e)}}return null},checkBoundaryCollisions:function(t){return Math.abs(t.x)>200||Math.abs(t.z)>200?{type:"boundary",object:null,position:t,normal:this.calculateBoundaryNormal(t,200)}:t.y>100?{type:"ceiling",object:null,position:t,normal:{x:0,y:-1,z:0}}:t.y<.3?{type:"ground",object:null,position:t,normal:{x:0,y:1,z:0}}:null},isInsideBuilding:function(t,e,i){if(!i)return!1;const o=i.width||10,n=i.height||20,s=i.depth||10,a=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y),l=Math.abs(t.z-e.z);return a<o/2&&r<n/2&&l<s/2},calculateDistance:function(t,e){const i=t.x-e.x,o=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+o*o+n*n)},calculateBuildingNormal:function(t,e,i){const o=i.width||10,n=i.height||20,s=i.depth||10,a=t.x-e.x,r=t.y-e.y,l=t.z-e.z,c=Math.abs(a)/(o/2),d=Math.abs(r)/(n/2),h=Math.abs(l)/(s/2);return c>d&&c>h?{x:a>0?1:-1,y:0,z:0}:d>h?{x:0,y:r>0?1:-1,z:0}:{x:0,y:0,z:l>0?1:-1}},calculateObstacleNormal:function(t,e){const i=t.x-e.x,o=t.z-e.z,n=Math.sqrt(i*i+o*o);return 0===n?{x:1,y:0,z:0}:{x:i/n,y:0,z:o/n}},calculateBoundaryNormal:function(t,e){return Math.abs(t.x)>e?{x:t.x>0?-1:1,y:0,z:0}:Math.abs(t.z)>e?{x:0,y:0,z:t.z>0?-1:1}:{x:0,y:0,z:0}},handleSolidCollision:function(t,e){const i=Date.now();i-this.lastCollisionTime<100||(console.log(`üí• Colis√£o s√≥lida detectada: ${t.type}`),this.isColliding=!0,this.lastCollisionTime=i,this.repositionDrone(t,e),this.applySolidBounce(t),this.data.showEffects&&this.createCollisionEffect(e,t.type),this.data.soundEnabled&&this.playCollisionSound(t.type),this.notifyCollision(t.type,t.object),setTimeout(()=>{this.isColliding=!1},200))},repositionDrone:function(t,e){if(!this.droneController)return;const i=t.normal,o={x:e.x+1.5*i.x,y:e.y+1.5*i.y,z:e.z+1.5*i.z};this.drone.setAttribute("position",o),console.log(`üîÑ Drone reposicionado para: ${o.x.toFixed(2)}, ${o.y.toFixed(2)}, ${o.z.toFixed(2)}`)},applySolidBounce:function(t){if(!this.droneController||!this.droneController.velocity)return;const e=this.droneController.velocity,i=t.normal,o=1.5*this.data.bounceForce,n=e.x*i.x+e.y*i.y+e.z*i.z;e.x-=2*n*i.x*o,e.y-=2*n*i.y*o,e.z-=2*n*i.z*o,e.x*=.7,e.y*=.7,e.z*=.7;const s=.1;Math.abs(e.x)<s&&Math.abs(e.y)<s&&Math.abs(e.z)<s&&(e.x=i.x*s,e.y=i.y*s,e.z=i.z*s),console.log(`‚ö° Ricochete aplicado: vx=${e.x.toFixed(2)}, vy=${e.y.toFixed(2)}, vz=${e.z.toFixed(2)}`)},handleCollision:function(t,e,i){const o={type:t,object:e,position:i,normal:{x:0,y:1,z:0}};this.handleSolidCollision(o,i)},applyBounceEffect:function(t,e){if(!this.droneController)return;const i=this.data.bounceForce;let o={x:0,y:0,z:0};switch(t){case"building":case"obstacle":const t=this.droneController.velocity||{x:0,y:0,z:0};o.x=-t.x*i,o.y=Math.abs(t.y)*i,o.z=-t.z*i;break;case"boundary":o.x=e.x>0?2*-i:2*i,o.z=e.z>0?2*-i:2*i;break;case"ceiling":o.y=3*-i;break;case"ground":o.y=3*i}this.droneController.velocity&&(this.droneController.velocity.x+=o.x,this.droneController.velocity.y+=o.y,this.droneController.velocity.z+=o.z)},createCollisionEffect:function(t,e){const i="building"===e?15:8,o=this.getCollisionColor(e);for(let e=0;e<i;e++){const e=document.createElement("a-sphere");e.setAttribute("geometry",{radius:.05+.1*Math.random()}),e.setAttribute("material",{color:o,emissive:o,emissiveIntensity:.8});const i=4*(Math.random()-.5),n=3*Math.random(),s=4*(Math.random()-.5);e.setAttribute("position",{x:t.x,y:t.y,z:t.z}),e.setAttribute("animation",{property:"position",to:`${t.x+i} ${t.y+n} ${t.z+s}`,dur:1e3,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:1e3,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1100)}this.createScreenFlash(e)},getCollisionColor:function(t){switch(t){case"building":return"#ff6600";case"obstacle":return"#ff3300";case"boundary":return"#ffff00";case"ceiling":return"#00ffff";case"ground":return"#ff0066";default:return"#ffffff"}},createScreenFlash:function(t){const e=document.createElement("a-plane"),i=document.querySelector("[camera]");i&&(e.setAttribute("geometry",{width:10,height:10}),e.setAttribute("material",{color:this.getCollisionColor(t),transparent:!0,opacity:.3}),e.setAttribute("position","0 0 -2"),i.appendChild(e),e.setAttribute("animation",{property:"material.opacity",from:.3,to:0,dur:200,easing:"easeOutQuad"}),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},250))},playCollisionSound:function(t){if(this.data.soundEnabled)try{const e=this.el.sceneEl.systems["audio-system"];if(e&&e.isInitialized){"building"===t||"obstacle"===t?e.createTone(150,200,.3):e.createTone(400,100,.2)}}catch(t){console.warn("‚ö†Ô∏è Erro ao tocar som de colis√£o:",t)}},notifyCollision:function(t,e){this.el.sceneEl.emit("drone-collision",{type:t,object:e,timestamp:Date.now()});const i=document.querySelector("[game-manager]");i&&i.components["game-manager"]&&i.components["game-manager"].onCollision(t,e)},remove:function(){this.collisionCheck&&clearInterval(this.collisionCheck)}}),console.log("üì¶ M√≥dulo collision-system.js carregado com sucesso!"),AFRAME.components["drone-controller"]||AFRAME.registerComponent("drone-controller",{schema:{maxSpeed:{type:"number",default:8.3},acceleration:{type:"number",default:4},rotationSpeed:{type:"number",default:.6},mass:{type:"number",default:.5},drag:{type:"number",default:.95},angularDrag:{type:"number",default:.92},stabilization:{type:"number",default:.25},autoLevel:{type:"boolean",default:!0},minAltitude:{type:"number",default:.5},targetAltitude:{type:"number",default:.5},altitudeStabilization:{type:"boolean",default:!0},altitudeStabilizationForce:{type:"number",default:1},groundStabilization:{type:"boolean",default:!0},groundDetectionHeight:{type:"number",default:.6},stabilizationLift:{type:"number",default:2},stabilizationSmoothing:{type:"number",default:.5},deadzone:{type:"number",default:.1},sensitivity:{type:"number",default:1},hoverThrust:{type:"number",default:6},hoverStability:{type:"number",default:.4},windResistance:{type:"number",default:.02}},init:function(){console.log("üöÅ Inicializando controlador do drone..."),this.velocity=new THREE.Vector3,this.angularVelocity=new THREE.Vector3,this.targetRotation=new THREE.Euler,this.isActive=!1,this.isFlying=!1,this.currentSpeed=0,this.batteryLevel=100,this.isLanding=!1,this.isLanded=!1,this.landingSpeed=2,this.landingHeight=.5,this.cinematicMode={enabled:!0,speedMultiplier:.4,rotationMultiplier:.4,smoothingFactor:.8,lastToggleTime:0,activationDelay:500,stabilizationTolerance:.1},this.fpvMode={enabled:!1,maxSpeed:27.8,speedMultiplier:1,rotationMultiplier:2,smoothingFactor:.2,bankingEnabled:!0,maxBankAngle:45,stabilizationDisabled:!0,acceleration:8,agility:1.5,responsiveness:.1},this.thrustPower=0,this.targetThrust=0,this.hoverHeight=3,this.isHovering=!1,this.isGrounded=!1,this.lastGroundCheck=0,this.stabilizationActive=!1,this.stabilizationStartTime=0,this.autoStabilizationActive=!0,this.stabilizationTolerance=.1,this.lastStabilizationCheck=0,this.lastToleranceChangeLog=0,this.wasManuallyControllingAltitude=!1,this.altitudeThreshold=20,this.lowAltitudeMinThrust=.4,this.lowAltitudeMaxThrust=1.23,this.normalThrust=.6,this.isInLowAltitudeMode=!1,this.lastAltitudeCheck=0,setTimeout(()=>{console.log("üöÅ Ativando drone automaticamente..."),this.activateDrone(),setTimeout(()=>{this.isFlying||(console.log("üöÅ For√ßando ativa√ß√£o do voo..."),this.isFlying=!0,this.isActive=!0)},500)},1e3),setTimeout(()=>{this.initPropellerAnimations()},100),this.leftController=null,this.rightController=null,this.leftStick={x:0,y:0},this.rightStick={x:0,y:0},this.leftTriggerPressed=!1,this.rightTriggerPressed=!1,this.VR_SIMULATOR={leftStick:{x:0,y:0},rightStick:{x:0,y:0},leftTrigger:!1,rightTrigger:!1},this.targetForwardSpeed=0,this.targetStrafeSpeed=0,this.targetAltitudeChange=0,this.targetYawRotation=0,this.targetPitchRotation=0,this.flightSimulation={enabled:!0,naturalHover:!0,oscillationAmplitude:.08,oscillationSpeed:.0012,baseAltitude:3,lastOscillationUpdate:0,stabilizationStrength:.15,windEffect:!0,windStrength:.03,windSpeed:5e-4,microAdjustments:!0,microAmplitude:.02,microSpeed:.003},this.keys={},this.setupKeyboardControls(),this.el.sceneEl.addEventListener("loaded",()=>{this.setupVRControls()}),this.setupPhysics(),this.setupVisualEffects(),this.setupAudioSystem(),this.stabilizeInitialPosition(),console.log("‚úÖ Controlador do drone inicializado com sucesso!"),console.log(`üéØ Estabiliza√ß√£o autom√°tica: ${this.autoStabilizationActive?"ATIVA":"INATIVA"} por padr√£o (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm - oscila√ß√µes naturais)`),console.log(`üî∫ Sistema de altitude: Empuxo aumentado abaixo de ${this.altitudeThreshold}m`),console.log(`‚ö° Empuxo baixa altitude: ${100*this.lowAltitudeMinThrust}% - ${100*this.lowAltitudeMaxThrust}%`),console.log(`‚ö° Empuxo normal: ${100*this.normalThrust}% (acima de ${this.altitudeThreshold}m)`)},setupVRControls:function(){console.log("üéÆ Configurando controles VR...");const t=this;setTimeout(function(){t.leftController=document.querySelector("#leftHand"),t.rightController=document.querySelector("#rightHand"),t.leftController&&(console.log("üîç Debug: Verificando fun√ß√µes do controle esquerdo..."),console.log("onLeftStickMove:",typeof t.onLeftStickMove,t.onLeftStickMove),console.log("onLeftTriggerDown:",typeof t.onLeftTriggerDown,t.onLeftTriggerDown),console.log("onLeftTriggerUp:",typeof t.onLeftTriggerUp,t.onLeftTriggerUp),console.log("onLeftGripDown:",typeof t.onLeftGripDown,t.onLeftGripDown),console.log("onLeftGripUp:",typeof t.onLeftGripUp,t.onLeftGripUp),"function"==typeof t.onLeftStickMove?t.leftController.addEventListener("thumbstickmoved",t.onLeftStickMove.bind(t)):console.warn("‚ö†Ô∏è onLeftStickMove n√£o √© uma fun√ß√£o:",typeof t.onLeftStickMove),"function"==typeof t.onLeftTriggerDown?t.leftController.addEventListener("triggerdown",t.onLeftTriggerDown.bind(t)):console.warn("‚ö†Ô∏è onLeftTriggerDown n√£o √© uma fun√ß√£o:",typeof t.onLeftTriggerDown),"function"==typeof t.onLeftTriggerUp?t.leftController.addEventListener("triggerup",t.onLeftTriggerUp.bind(t)):console.warn("‚ö†Ô∏è onLeftTriggerUp n√£o √© uma fun√ß√£o:",typeof t.onLeftTriggerUp),"function"==typeof t.onLeftGripDown?t.leftController.addEventListener("gripdown",t.onLeftGripDown.bind(t)):console.warn("‚ö†Ô∏è onLeftGripDown n√£o √© uma fun√ß√£o:",typeof t.onLeftGripDown),"function"==typeof t.onLeftGripUp?t.leftController.addEventListener("gripup",t.onLeftGripUp.bind(t)):console.warn("‚ö†Ô∏è onLeftGripUp n√£o √© uma fun√ß√£o:",typeof t.onLeftGripUp),console.log("‚úÖ Controle esquerdo configurado")),t.rightController&&("function"==typeof t.onRightStickMove&&t.rightController.addEventListener("thumbstickmoved",t.onRightStickMove.bind(t)),"function"==typeof t.onRightTriggerDown&&t.rightController.addEventListener("triggerdown",t.onRightTriggerDown.bind(t)),"function"==typeof t.onRightTriggerUp&&t.rightController.addEventListener("triggerup",t.onRightTriggerUp.bind(t)),"function"==typeof t.onRightButtonDown&&t.rightController.addEventListener("buttondown",t.onRightButtonDown.bind(t)),console.log("‚úÖ Controle direito configurado")),t.leftController||t.rightController||console.log("‚ÑπÔ∏è Controladores VR n√£o encontrados, usando apenas teclado")},1e3)},setupKeyboardControls:function(){window.addEventListener("keydown",t=>{this.keys[t.code]=!0,this.handleKeyboardSpecialActions(t.code,!0)}),window.addEventListener("keyup",t=>{this.keys[t.code]=!1,this.handleKeyboardSpecialActions(t.code,!1)}),this.showKeyboardHelp()},showKeyboardHelp:function(){const t=document.createElement("div");t.id="keyboard-help",t.style.cssText="\n            position: fixed;\n            bottom: 10px;\n            left: 10px;\n            background: rgba(0, 0, 0, 0.8);\n            color: #ffffff;\n            padding: 10px;\n            border-radius: 5px;\n            font-family: Arial, sans-serif;\n            font-size: 12px;\n            z-index: 1000;\n            max-width: 300px;\n        ",t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">üéÆ Controles:</div>\n            <div style="color: #ffff00; font-weight: bold; margin-bottom: 3px;">‚å®Ô∏è Controles Principais:</div>\n            <div>WASD - Altitude e giro (W=subir, S=descer, A=giro esq, D=giro dir)</div>\n            <div>‚Üë‚Üì‚Üê‚Üí - Movimento (frente/tr√°s/esquerda/direita)</div>\n            <div style="color: #00ff00; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">ü•Ω VR Simulado (Alternativo):</div>\n            <div>Z/X - Descer/Subir (Alavanca Esquerda Y) ‚ö†Ô∏è INVERTIDO</div>\n            <div>Q/E - Giro esquerda/direita (Alavanca Esquerda X)</div>\n            <div>I/K - Frente/Tr√°s (Alavanca Direita Y)</div>\n            <div>J/L - Esquerda/Direita (Alavanca Direita X)</div>\n            <div style="color: #ff8800; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">üîß Comandos Gerais:</div>\n            <div>Space - Ligar/Desligar drone</div>\n            <div>Shift - Modo boost</div>\n            <div>R - Reset posi√ß√£o</div>\n            <div>T - Toggle auto-nivelamento</div>\n            <div>G - Toggle estabiliza√ß√£o de solo</div>\n            <div>F - Toggle estat√≠sticas</div>\n            <div>M - Mutar/Desmutar √°udio</div>\n            <div>+/- - Aumentar/Diminuir volume</div>\n            <div>1/2/3 - Qualidade baixa/m√©dia/alta</div>\n            <div>H - Redefinir altitude base (estabiliza√ß√£o ¬±8cm SEMPRE ativa)</div>\n            <div style="color: #ff8800; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">üé¨ Modos de Voo:</div>\n            <div>C - Alternar CINEMATOGR√ÅFICO ‚áÑ FPV/SPORT</div>\n            <div>‚Ä¢ üé¨ Cinematogr√°fico: 40% velocidade, ¬±8cm estabiliza√ß√£o SEMPRE</div>\n            <div>‚Ä¢ üöÅ FPV/Sport: 100km/h m√°x, drone FPV, ultra responsivo</div>\n            <div>Grip Esquerdo (VR) - Alternar modos de voo</div>\n            <div style="color: #00ff88; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">üõ¨ Sistema de Pouso:</div>\n            <div>Y - Pousar/Decolar (teclado)</div>\n            <div>Bot√£o Y (VR) - Pousar/Decolar em superf√≠cies s√≥lidas</div>\n        ',document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.opacity="0.3")},1e4)},setQuality:function(t){const e=this.el.sceneEl;e.components["performance-monitor"]&&(e.components["performance-monitor"].setQuality(t),console.log(`üéÆ Qualidade definida para: ${t}`))},setNewBaseAltitude:function(){const t=this.el.getAttribute("position").y;this.flightSimulation.baseAltitude=t,this.hoverHeight=t,this.data.targetAltitude=t,console.log(`üéØ Nova altitude base definida: ${t.toFixed(2)}m (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm)`);const e=document.createElement("div");e.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(0, 120, 255, 0.9);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tz-index: 1000;\n\t\t\t\tpointer-events: none;\n\t\t\t",e.innerHTML=`üéØ NOVA ALTITUDE BASE<br>Altitude: ${t.toFixed(1)}m<br>üìè Toler√¢ncia: ¬±${(100*this.stabilizationTolerance).toFixed(0)}cm<br><small>Estabiliza√ß√£o sempre ativa</small>`,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},3e3)},toggleFlightMode:function(){const t=Date.now();t-this.cinematicMode.lastToggleTime<this.cinematicMode.activationDelay||(this.cinematicMode.enabled?(this.cinematicMode.enabled=!1,this.fpvMode.enabled=!0,this.stabilizationTolerance=999,this.autoStabilizationActive=!1,console.log("üèéÔ∏è Modo FPV/SPORT ativado - Controle manual total!")):(this.cinematicMode.enabled=!0,this.fpvMode.enabled=!1,this.stabilizationTolerance=.08,this.autoStabilizationActive=!0,console.log("üé¨ Modo CINEMATOGR√ÅFICO ativado - Estabilidade ¬±8cm!")),this.cinematicMode.lastToggleTime=t,this.showFlightModeIndicator())},toggleCinematicMode:function(){this.toggleFlightMode()},showFlightModeIndicator:function(){const t=document.createElement("div"),e=this.cinematicMode.enabled,i=this.fpvMode.enabled;t.style.cssText=`\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: ${e?"rgba(255, 140, 0, 0.95)":"rgba(255, 50, 50, 0.95)"};\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 25px;\n\t\t\t\tborder-radius: 15px;\n\t\t\t\tfont-size: 20px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t\tpointer-events: none;\n\t\t\t\ttext-align: center;\n\t\t\t\tbox-shadow: 0 4px 20px rgba(0,0,0,0.3);\n\t\t\t`,e?t.innerHTML=`\n\t\t\t\t\tüé¨ MODO CINEMATOGR√ÅFICO<br>\n\t\t\t\t\t<div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">\n\t\t\t\t\t\t‚Ä¢ Velocidade: ${Math.round(100*this.cinematicMode.speedMultiplier)}% (suave)<br>\n\t\t\t\t\t\t‚Ä¢ Estabiliza√ß√£o: ¬±${Math.round(100*this.stabilizationTolerance)}cm<br>\n\t\t\t\t\t\t‚Ä¢ Inclina√ß√£o: Suave nas curvas<br>\n\t\t\t\t\t\t‚Ä¢ Controles: Cinematogr√°ficos\n\t\t\t\t\t</div>\n\t\t\t\t`:i&&(t.innerHTML=`\n\t\t\t\t\tüöÅ MODO FPV/SPORT<br>\n\t\t\t\t\t<div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">\n\t\t\t\t\t\t‚Ä¢ Velocidade: ${Math.round(3.6*this.fpvMode.maxSpeed)}km/h (m√°xima)<br>\n\t\t\t\t\t\t‚Ä¢ F√≠sica: Drone FPV de alta performance<br>\n\t\t\t\t\t\t‚Ä¢ Acelera√ß√£o: ${this.fpvMode.acceleration}m/s¬≤ (2x mais r√°pida)<br>\n\t\t\t\t\t\t‚Ä¢ Inclina√ß√£o: At√© ${this.fpvMode.maxBankAngle}¬∞ nas curvas<br>\n\t\t\t\t\t\t‚Ä¢ Controles: Ultra responsivos\n\t\t\t\t\t</div>\n\t\t\t\t`),document.body.appendChild(t),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},4e3)},showCinematicModeIndicator:function(t){this.showFlightModeIndicator()},adjustMasterVolume:function(t){const e=this.el.sceneEl.components["audio-system"];if(e){const i=e.data.masterVolume,o=Math.max(0,Math.min(1,i+t));e.setMasterVolume(o),this.showVolumeIndicator(o)}},showVolumeIndicator:function(t){const e=Math.round(100*t),i=document.createElement("div");i.style.cssText="\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            font-size: 24px;\n            z-index: 1000;\n            pointer-events: none;\n        ",i.textContent=`üîä Volume: ${e}%`,document.body.appendChild(i),setTimeout(()=>{document.body.removeChild(i)},1500)},setupPhysics:function(){this.el.getAttribute("physics-body")&&this.el.setAttribute("physics-body",{type:"dynamic",mass:this.data.mass,linearDamping:.1,angularDamping:.1,shape:"box"})},setupVisualEffects:function(){this.propellers=[this.el.querySelector("#prop1"),this.el.querySelector("#prop2"),this.el.querySelector("#prop3"),this.el.querySelector("#prop4")],this.setupDroneLights()},setupDroneLights:function(){this.ledElements=this.el.querySelectorAll('[material*="emissive"]')},setupAudioSystem:function(){this.lastMovementIntensity=0,this.audioSystem=this.el.sceneEl.components["audio-system"]},setupMotorSound:function(){},stabilizeInitialPosition:function(){setTimeout(()=>{this.el.setAttribute("position",{x:0,y:0,z:0}),this.hoverHeight=0,this.flightSimulation.baseAltitude=0,this.data.targetAltitude=0,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.thrustPower=.6,this.targetThrust=.6,this.isHovering=!0,console.log(`üéØ Drone posicionado no CH√ÉO: ${this.hoverHeight.toFixed(2)}m - Modo CINEMATOGR√ÅFICO ativo por padr√£o (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm)`)},100)},updateAudioFeedback:function(t){const e=t.length();this.lastMovementIntensity=e;const i=this.el.sceneEl.components["audio-system"];i&&i.updatePropellerSound(e),this.el.sceneEl&&this.el.sceneEl.emit("drone-throttle-change",{intensity:e})},onLeftStickMove:function(t){const e=this.applyDeadzone(t.detail.x),i=this.applyDeadzone(t.detail.y);if(this.leftStick.x=e,this.leftStick.y=i,Math.abs(e)<.01&&Math.abs(i)<.01)return this.targetAltitudeChange=0,void(this.targetYawRotation=0);let o,n,s;this.cinematicMode.enabled?(o=this.cinematicMode.speedMultiplier,n=this.cinematicMode.rotationMultiplier,s=this.data.maxSpeed):this.fpvMode.enabled?(o=this.fpvMode.speedMultiplier,n=this.fpvMode.rotationMultiplier,s=this.fpvMode.maxSpeed):(o=1,n=1,s=this.data.maxSpeed),this.targetAltitudeChange=-i*s*1*o,this.targetYawRotation=-e*this.data.rotationSpeed*n;const a=this.cinematicMode.enabled?"üé¨":this.fpvMode.enabled?"üèéÔ∏è":"üöÅ",r=this.cinematicMode.enabled?"CINEMATOGR√ÅFICO":this.fpvMode.enabled?"FPV/SPORT":"NORMAL";console.log(`${a} Alavanca Esquerda (${r}): x=${e.toFixed(2)}, y=${i.toFixed(2)} | Altitude=${this.targetAltitudeChange.toFixed(2)}, Yaw=${this.targetYawRotation.toFixed(2)}`)},onRightStickMove:function(t){const e=this.applyDeadzone(t.detail.x),i=this.applyDeadzone(t.detail.y);if(this.rightStick.x=e,this.rightStick.y=i,Math.abs(e)<.01&&Math.abs(i)<.01)return this.targetForwardSpeed=0,void(this.targetStrafeSpeed=0);let o,n;this.cinematicMode.enabled?(o=this.cinematicMode.speedMultiplier,n=this.data.maxSpeed):this.fpvMode.enabled?(o=this.fpvMode.speedMultiplier,n=this.fpvMode.maxSpeed):(o=1,n=this.data.maxSpeed),this.targetForwardSpeed=-i*n*o,this.targetStrafeSpeed=e*n*o;const s=this.cinematicMode.enabled?"üé¨":this.fpvMode.enabled?"üèéÔ∏è":"üöÅ",a=this.cinematicMode.enabled?"CINEMATOGR√ÅFICO":this.fpvMode.enabled?"FPV/SPORT":"NORMAL";console.log(`${s} Alavanca Direita (${a}): x=${e.toFixed(2)}, y=${i.toFixed(2)} | Forward=${this.targetForwardSpeed.toFixed(2)}, Strafe=${this.targetStrafeSpeed.toFixed(2)}`)},onLeftTriggerDown:function(){this.leftTriggerPressed=!0,this.activateDrone(),console.log("üéÆ Trigger esquerdo pressionado")},onLeftTriggerUp:function(){this.leftTriggerPressed=!1,console.log("üéÆ Trigger esquerdo solto")},activateDrone:function(){if(this.isActive)console.log("üöÅ Drone desativado"),this.isActive=!1,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.el.emit("drone-deactivated");else{console.log("üöÅ Drone ativado"),this.isActive=!0,this.isFlying=!0,this.el.emit("drone-activated");const t=document.querySelector("[game-manager]");if(t&&t.components["game-manager"]){const e=t.components["game-manager"];e.gameState.isPlaying||e.startGame()}}},onLeftGripDown:function(){this.toggleFlightMode()},onLeftGripUp:function(){console.log("üéØ Grip esquerdo solto")},onRightTriggerDown:function(){this.rightTriggerPressed=!0,this.boostMode=!0,console.log("‚ö° Modo boost ativado!")},onRightTriggerUp:function(){this.rightTriggerPressed=!1,this.boostMode=!1,console.log("‚ö° Modo boost desativado")},onRightButtonDown:function(t){0===t.detail.id?this.resetDronePosition():1===t.detail.id?this.emergencyStop():3===t.detail.id&&this.toggleLandingMode()},handleKeyboardSpecialActions:function(t,e){if(e)switch(t){case"Space":this.isFlying=!this.isFlying,this.updatePropellerEffects(this.isFlying),console.log("üöÅ Drone "+(this.isFlying?"ativado":"desativado"));break;case"KeyT":this.data.autoLevel=!this.data.autoLevel,console.log("üéØ Auto-nivelamento: "+(this.data.autoLevel?"ON":"OFF"));break;case"KeyG":this.data.groundStabilization=!this.data.groundStabilization,console.log("üåç Estabiliza√ß√£o de solo: "+(this.data.groundStabilization?"ON":"OFF"));break;case"ShiftLeft":this.boostMode=!0,console.log("‚ö° Modo boost ativado!");break;case"KeyP":this.el.emit("toggle-pause");break;case"KeyF":const t=this.el.sceneEl;t.components["performance-monitor"]&&t.components["performance-monitor"].toggleStats();break;case"KeyM":const e=this.el.sceneEl.components["audio-system"];e&&e.toggleMute();break;case"Minus":case"NumpadSubtract":this.adjustMasterVolume(-.1);break;case"Equal":case"Plus":case"NumpadAdd":this.adjustMasterVolume(.1);break;case"Digit1":this.setQuality("low");break;case"Digit2":this.setQuality("medium");break;case"Digit3":this.setQuality("high");break;case"KeyH":this.setNewBaseAltitude();break;case"KeyC":this.toggleFlightMode();break;case"KeyY":this.toggleLandingMode();break;case"KeyZ":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.y=-.8,this.targetAltitudeChange=-.8*this.data.maxSpeed*1);break;case"KeyX":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.y=.8,this.targetAltitudeChange=.8*this.data.maxSpeed*1);break;case"KeyQ":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.x=-.8,this.targetYawRotation=.8*this.data.rotationSpeed);break;case"KeyE":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.x=.8,this.targetYawRotation=-.8*this.data.rotationSpeed);break;case"KeyI":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.y=.8,this.targetForwardSpeed=.8*this.data.maxSpeed);break;case"KeyK":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.y=-.8,this.targetForwardSpeed=-.8*this.data.maxSpeed);break;case"KeyJ":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.x=-.8,this.targetStrafeSpeed=-.8*this.data.maxSpeed);break;case"KeyL":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.x=.8,this.targetStrafeSpeed=.8*this.data.maxSpeed)}else if("ShiftLeft"===t&&(this.boostMode=!1,console.log("‚ö° Modo boost desativado")),this.VR_SIMULATOR)switch(t){case"KeyZ":case"KeyX":this.VR_SIMULATOR.leftStick.y=0,this.targetAltitudeChange=0;break;case"KeyQ":case"KeyE":this.VR_SIMULATOR.leftStick.x=0,this.targetYawRotation=0;break;case"KeyI":case"KeyK":this.VR_SIMULATOR.rightStick.y=0,this.targetForwardSpeed=0;break;case"KeyJ":case"KeyL":this.VR_SIMULATOR.rightStick.x=0,this.targetStrafeSpeed=0}},simulateRealisticFlight:function(t){if(!this.flightSimulation.enabled||!this.isActive||!this.isFlying)return;const e=this.hasKeyboardInput()||this.hasVRInput(),i=Math.abs(this.targetAltitudeChange)>.1;if(!e&&!i&&this.flightSimulation.naturalHover){const e=t,i=this.el.getAttribute("position"),o=e*this.flightSimulation.oscillationSpeed,n=Math.sin(o)*this.flightSimulation.oscillationAmplitude,s=1.3*o+.5,a=Math.sin(s)*(.3*this.flightSimulation.oscillationAmplitude);let r=0;if(this.flightSimulation.windEffect){const t=e*this.flightSimulation.windSpeed;r=Math.sin(t)*this.flightSimulation.windStrength+Math.sin(2.1*t+1.2)*(.5*this.flightSimulation.windStrength)}let l=0;if(this.flightSimulation.microAdjustments){const t=e*this.flightSimulation.microSpeed;l=Math.sin(t)*this.flightSimulation.microAmplitude+Math.sin(3.7*t+.8)*(.6*this.flightSimulation.microAmplitude)}let c=1;c=this.isInLowAltitudeMode?1.3:.8;const d=(n+a+r+l)*c,h=this.flightSimulation.baseAltitude+d,u=(h-i.y)*this.flightSimulation.stabilizationStrength,m=.06,p=Math.max(-m,Math.min(m,u));if(this.targetAltitudeChange+=p,e-(this.flightSimulation.lastOscillationUpdate||0)>4e3){const t=Math.abs(100*d);console.log(`üåä Voo natural: altitude=${i.y.toFixed(2)}m, alvo=${h.toFixed(2)}m, oscila√ß√£o=${t.toFixed(1)}cm, for√ßa=${p.toFixed(3)}`),this.flightSimulation.lastOscillationUpdate=e}}},checkAltitudeAndAdjustThrust:function(){const t=this.el.getAttribute("position").y,e=Date.now(),i=this.isInLowAltitudeMode;if(this.isInLowAltitudeMode=t<this.altitudeThreshold,i!==this.isInLowAltitudeMode&&e-this.lastAltitudeCheck>2e3&&(this.isInLowAltitudeMode?(console.log(`üî∫ ALTITUDE BAIXA DETECTADA: ${t.toFixed(2)}m < ${this.altitudeThreshold}m`),console.log(`‚ö° Empuxo aumentado: ${100*this.lowAltitudeMinThrust}% - ${100*this.lowAltitudeMaxThrust}%`),console.log("üìè Estabiliza√ß√£o ¬±8cm ATIVA")):(console.log(`üîª ALTITUDE NORMAL: ${t.toFixed(2)}m >= ${this.altitudeThreshold}m`),console.log(`‚ö° Empuxo normal: ${100*this.normalThrust}%`)),this.lastAltitudeCheck=e),this.isInLowAltitudeMode){const e=Math.max(0,Math.min(1,t/this.altitudeThreshold)),i=this.lowAltitudeMaxThrust-this.lowAltitudeMinThrust;this.targetThrust=this.lowAltitudeMaxThrust-e*i,this.targetThrust=Math.max(this.lowAltitudeMinThrust,Math.min(this.lowAltitudeMaxThrust,this.targetThrust))}else this.targetThrust=this.normalThrust;const o=this.targetThrust-this.thrustPower;this.thrustPower+=.1*o},tick:function(t,e){this.simulateRealisticFlight(t),this.checkAltitudeAndAdjustThrust(),this.isDroneStopped(),this.processLanding(e),this.isLanded||this.processControlInput(),this.applyMovement(e),this.applyRotation(e),this.applyRealisticPhysics(e),this.updateAdvancedPropellerEffects(),this.updateVisualEffects(),this.updateHUD()},processControlInput:function(){this.hasVRInput()||(this.targetForwardSpeed=0,this.targetStrafeSpeed=0,this.targetAltitudeChange=0,this.targetYawRotation=0),this.targetPitchRotation=0,this.processKeyboardInput(),this.boostMode&&(this.targetForwardSpeed*=1.5,this.targetStrafeSpeed*=1.5,this.targetAltitudeChange*=1.5)},hasVRInput:function(){const t=.05;return Math.abs(this.leftStick.x)>t||Math.abs(this.leftStick.y)>t||Math.abs(this.rightStick.x)>t||Math.abs(this.rightStick.y)>t},processKeyboardInput:function(){const t=this.data.maxSpeed*this.data.sensitivity;this.keys.KeyW&&(this.targetAltitudeChange=1*t),this.keys.KeyS&&(this.targetAltitudeChange=1*-t),this.keys.KeyA&&(this.targetYawRotation=this.data.rotationSpeed),this.keys.KeyD&&(this.targetYawRotation=-this.data.rotationSpeed),this.keys.ArrowUp&&(this.targetForwardSpeed=t),this.keys.ArrowDown&&(this.targetForwardSpeed=-t),this.keys.ArrowLeft&&(this.targetStrafeSpeed=-t),this.keys.ArrowRight&&(this.targetStrafeSpeed=t)},applyMovement:function(t){const e=this.el.getAttribute("position"),i=this.el.getAttribute("rotation"),o=new THREE.Quaternion;o.setFromEuler(new THREE.Euler(THREE.MathUtils.degToRad(i.x),THREE.MathUtils.degToRad(i.y),THREE.MathUtils.degToRad(i.z)));const n=new THREE.Vector3(0,0,-1).applyQuaternion(o),s=new THREE.Vector3(1,0,0).applyQuaternion(o),a=new THREE.Vector3(0,1,0),r=t/1e3;let l=this.data.acceleration*r;this.cinematicMode.enabled?l*=this.cinematicMode.smoothingFactor:this.fpvMode.enabled&&(l*=this.fpvMode.acceleration/this.data.acceleration,l*=this.fpvMode.responsiveness/this.cinematicMode.smoothingFactor),this.velocity.add(n.multiplyScalar(this.targetForwardSpeed*l)),this.velocity.add(s.multiplyScalar(this.targetStrafeSpeed*l));let c=this.targetAltitudeChange;if(this.autoStabilizationActive){const t=Math.abs(this.targetAltitudeChange)>.05;if(!t&&this.wasManuallyControllingAltitude&&(this.flightSimulation.baseAltitude=e.y,this.data.targetAltitude=e.y,this.hoverHeight=e.y,console.log(`üéØ Controle solto - Estabilizando na altitude atual: ${e.y.toFixed(2)}m (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm - oscila√ß√µes naturais permitidas)`)),this.wasManuallyControllingAltitude=t,!t){const t=this.flightSimulation.baseAltitude||this.data.targetAltitude,i=t-e.y;if(Math.abs(i)>this.stabilizationTolerance){let o=.15;this.isInLowAltitudeMode&&(o=.25);const n=i*o;if(c+=n,Date.now()-(this.lastStabilizationCheck||0)>2e3){const s=this.isInLowAltitudeMode?"BAIXA ALTITUDE":"NORMAL";console.log(`üéØ Estabiliza√ß√£o ${s}: atual=${e.y.toFixed(2)}m, alvo=${t.toFixed(2)}m, diferen√ßa=${i.toFixed(2)}m, for√ßa=${n.toFixed(2)} (mult: ${o})`),this.lastStabilizationCheck=Date.now()}}else{let t=.05;this.isInLowAltitudeMode&&(t=.08);c+=i*t}}}else if(this.data.altitudeStabilization){if(!(Math.abs(this.targetAltitudeChange)>.15)&&!this.stabilizationActive){const t=this.flightSimulation.baseAltitude||this.data.targetAltitude,i=(t-e.y)*this.data.altitudeStabilizationForce*.1;c+=i,Date.now()-(this.lastAltitudeStabilizationLog||0)>4e3&&(console.log(`üìè Estabiliza√ß√£o altitude: atual=${e.y.toFixed(2)}m, alvo=${t.toFixed(2)}m, for√ßa=${i.toFixed(3)}`),this.lastAltitudeStabilizationLog=Date.now())}}this.velocity.add(a.multiplyScalar(c*l));if(!(Math.abs(this.targetAltitudeChange)>.05)){const t=this.isInLowAltitudeMode?.85:.9;this.velocity.y*=t;const e=this.isInLowAltitudeMode?1.5:2;this.velocity.y=Math.max(-e,Math.min(e,this.velocity.y))}this.velocity.length()>this.data.maxSpeed&&this.velocity.normalize().multiplyScalar(this.data.maxSpeed);const d={x:e.x+this.velocity.x*r,y:Math.max(this.data.minAltitude,e.y+this.velocity.y*r),z:e.z+this.velocity.z*r};d.y<=this.data.minAltitude&&this.velocity.y<0&&(this.velocity.y=0,d.y=this.data.minAltitude),this.el.setAttribute("position",d),this.updateAudioFeedback(this.velocity),this.currentSpeed=this.velocity.length()},applyRotation:function(t){const e=this.el.getAttribute("rotation");let i=t/1e3;if(this.cinematicMode.enabled&&(i*=this.cinematicMode.smoothingFactor),this.targetYawRotation?this.angularVelocity.y+=this.targetYawRotation*i:this.angularVelocity.y*=.85,this.targetPitchRotation&&(this.angularVelocity.x+=this.targetPitchRotation*i),this.data.autoLevel){const t=2;Math.abs(e.x)>t?this.angularVelocity.x-=e.x*this.data.stabilization*i:this.angularVelocity.x*=.95,Math.abs(e.z)>t?this.angularVelocity.z-=e.z*this.data.stabilization*i:this.angularVelocity.z*=.95}const o={x:e.x+THREE.MathUtils.radToDeg(this.angularVelocity.x*i),y:e.y+THREE.MathUtils.radToDeg(this.angularVelocity.y*i),z:e.z+THREE.MathUtils.radToDeg(this.angularVelocity.z*i)};this.el.setAttribute("rotation",o),this.applyBankingEffect(i)},applyBankingEffect:function(t){if(!this.fpvMode.enabled||!this.fpvMode.bankingEnabled)return;const e=this.el.getAttribute("rotation");let i=0;if(0!==this.targetYawRotation||0!==this.targetStrafeSpeed){const t=Math.abs(this.targetYawRotation)/this.data.rotationSpeed,e=Math.abs(this.targetStrafeSpeed)/(this.fpvMode.enabled?this.fpvMode.maxSpeed:this.data.maxSpeed);i=Math.max(t,e)*(this.fpvMode.enabled?this.fpvMode.maxBankAngle:15),(this.targetYawRotation<0||this.targetStrafeSpeed<0)&&(i=-i)}const o=this.fpvMode.enabled?3:1.5,n=e.z,s=(i-n)*o*t,a={x:e.x,y:e.y,z:n+s};if(this.el.setAttribute("rotation",a),Math.abs(i)>1){const t=this.fpvMode.enabled?"üèéÔ∏è":"üé¨";console.log(`${t} Inclina√ß√£o: ${i.toFixed(1)}¬∞ (atual: ${n.toFixed(1)}¬∞)`)}},applyRealisticPhysics:function(t){const e=t/1e3,i=this.el.getAttribute("position");if(this.isFlying){const t=9.8*this.data.mass;if(Math.abs(this.targetAltitudeChange)<.1){this.isHovering=!0;const e=(this.flightSimulation.baseAltitude||this.hoverHeight)-i.y;let o=.3;this.autoStabilizationActive&&(o=Math.abs(e)>this.stabilizationTolerance?1.2:.6);const n=e*this.data.hoverStability*o;this.targetThrust=(t+n)/this.data.hoverThrust}else this.isHovering=!1,this.targetThrust=(t+this.targetAltitudeChange*this.data.mass)/this.data.hoverThrust;let o=1.5;if(this.autoStabilizationActive&&this.isHovering){const t=this.flightSimulation.baseAltitude||this.hoverHeight;o=Math.abs(t-i.y)>this.stabilizationTolerance?3:2}this.thrustPower+=(this.targetThrust-this.thrustPower)*o*e,this.isFlying&&this.isActive?this.isInLowAltitudeMode?this.thrustPower=Math.max(this.lowAltitudeMinThrust,Math.min(this.lowAltitudeMaxThrust,this.thrustPower)):this.thrustPower=Math.max(.5,Math.min(.7,this.thrustPower)):this.thrustPower=Math.max(0,Math.min(1.5,this.thrustPower));const n=this.thrustPower*this.data.hoverThrust;this.velocity.y+=(n-t)*e/this.data.mass,Math.abs(this.targetForwardSpeed)<.1&&Math.abs(this.targetStrafeSpeed)<.1&&(this.velocity.x*=Math.pow(this.data.windResistance,e),this.velocity.z*=Math.pow(this.data.windResistance,e))}else this.thrustPower=0,this.targetThrust=0,this.isHovering=!1,this.velocity.y-=9.8*e;this.velocity.multiplyScalar(Math.pow(this.data.drag,e)),this.angularVelocity.multiplyScalar(Math.pow(this.data.angularDrag,e));const o=this.el.getAttribute("position");this.isFlying&&!this.isHovering&&(this.hoverHeight=o.y)},applyDrag:function(){this.velocity.multiplyScalar(this.data.drag),this.angularVelocity.multiplyScalar(this.data.angularDrag)},applyDeadzone:function(t){return Math.abs(t)<this.data.deadzone?0:t},hasKeyboardInput:function(){return this.keys.KeyW||this.keys.KeyS||this.keys.KeyA||this.keys.KeyD||this.keys.KeyQ||this.keys.KeyE||this.keys.ArrowUp||this.keys.ArrowDown||this.keys.ArrowLeft||this.keys.ArrowRight},isDroneStopped:function(){const t=this.hasKeyboardInput()||this.hasVRInput(),e=Math.abs(this.targetAltitudeChange)>.1,i=this.velocity.length()<.5,o=!t&&!e&&i;if(this.autoStabilizationActive){const t=.08;if(Math.abs(this.stabilizationTolerance-t)>.001){const e=.002;this.stabilizationTolerance>t?this.stabilizationTolerance=Math.max(t,this.stabilizationTolerance-e):this.stabilizationTolerance=Math.min(t,this.stabilizationTolerance+e),Date.now()-(this.lastToleranceChangeLog||0)>1e3&&(console.log(`üéØ Auto estabilidade: mantendo ¬±${(100*this.stabilizationTolerance).toFixed(1)}cm em qualquer altitude`),this.lastToleranceChangeLog=Date.now())}}return o},checkGroundContact:function(){const t=this.el.getAttribute("position"),e=Date.now();return this.isGrounded=t.y<=this.data.groundDetectionHeight,e-this.lastGroundCheck>2e3&&(console.log(`üåç Verifica√ß√£o do solo: altura=${t.y.toFixed(2)}m, tocando=${this.isGrounded?"SIM":"N√ÉO"}`),this.lastGroundCheck=e),this.isGrounded},applyGroundStabilization:function(t){const e={groundStabilization:this.data.groundStabilization,isActive:this.isActive,isFlying:this.isFlying,position:this.el.getAttribute("position")};if(Date.now()-(this.lastDebugLog||0)>3e3&&(console.log("üîç Debug estabiliza√ß√£o:",e),this.lastDebugLog=Date.now()),!this.data.groundStabilization||!this.isActive||!this.isFlying)return this.stabilizationActive=!1,0;const i=this.el.getAttribute("position"),o=Date.now();if(Math.abs(this.targetAltitudeChange)>.1)return this.stabilizationActive=!1,0;if(this.checkGroundContact(),this.isGrounded)return this.stabilizationActive&&(this.stabilizationActive=!1,console.log("üåç Estabiliza√ß√£o autom√°tica DESATIVADA - drone tocando o solo")),0;{this.stabilizationActive||(this.stabilizationActive=!0,this.stabilizationStartTime=o,console.log(`üöÅ Estabiliza√ß√£o autom√°tica ATIVADA - altura atual: ${i.y.toFixed(2)}m`));const t=this.data.stabilizationLift*this.data.stabilizationSmoothing*.2,e=.001*(o-this.stabilizationStartTime),n=.08*Math.sin(2*e),s=t+n;return o-this.lastGroundCheck>2e3&&console.log(`üîß Aplicando estabiliza√ß√£o: for√ßa=${s.toFixed(4)}, oscila√ß√£o=${n.toFixed(4)}`),s}},updatePropellerEffects:function(t){this.propellers.forEach((e,i)=>{if(e){let o,n;if(t&&this.isFlying){const t=Math.max(.1,this.thrustPower);o=Math.max(150,3e3/(t*(this.boostMode?2:1))),n=Math.min(.8,.2+.4*t),this.boostMode&&(n=Math.min(.9,1.5*n))}else o=2e3,n=.1;const s=i%2==0?"3600":"-3600";e.setAttribute("animation",{property:"rotation",to:`0 ${s} 0`,loop:!0,dur:o}),e.setAttribute("material","opacity",n)}})},initPropellerAnimations:function(){["prop1","prop2","prop3","prop4"].forEach((t,e)=>{const i=document.querySelector(`#${t}`);if(i){i.setAttribute("material",{color:"#ff4444",transparent:!0,opacity:.3,metalness:.1,roughness:.9}),i.setAttribute("geometry",{primitive:"cylinder",radius:.6,height:.03,segmentsRadial:8});const t=e%2==0?3600:-3600;i.setAttribute("animation",{property:"rotation",to:`0 ${t} 0`,loop:!0,dur:300})}})},updateAdvancedPropellerEffects:function(){["prop1","prop2","prop3","prop4"].forEach((t,e)=>{const i=document.querySelector(`#${t}`);if(i){let t=300,o=.3,n=.6,s="#ff4444",a=0;this.isFlying&&(a=this.thrustPower,t=Math.max(50,300-250*a),o=Math.min(.9,.3+.6*a),a>.7&&(n=.3+.8*(a-.7),o=Math.max(.2,o-.3*(a-.7)),s="#ff6666"),this.boostMode&&(t=Math.max(8,.4*t),o=Math.min(.95,o+.15),n+=.2,s="#ff8888"));const r=e%2==0?3600:-3600;i.setAttribute("geometry",{primitive:"cylinder",radius:n,height:.03,segmentsRadial:Math.max(6,Math.min(12,Math.round(8+4*a)))}),i.setAttribute("material",{color:s,transparent:!0,opacity:o,metalness:.1,roughness:.9}),i.setAttribute("animation",{property:"rotation",to:`0 ${r} 0`,loop:!0,dur:t,easing:"linear"})}})},updateVisualEffects:function(){const t=this.isFlying?1:.3;this.ledElements.forEach(e=>{if(e){e.getAttribute("material").emissive;e.setAttribute("material","emissiveIntensity",t)}})},updateHUD:function(){const t=document.querySelector("#speed-indicator");if(t){const e=Math.round(3.6*this.currentSpeed),i=Math.round(100*this.thrustPower),o=this.el.getAttribute("position");let n=`Velocidade: ${e} km/h | Altitude: ${Math.round(10*o.y)/10}m`;if(this.isFlying){if(n+=` | Empuxo: ${i}%`,this.isInLowAltitudeMode?n+=" | üî∫BAIXA ALT":n+=" | üîªNORMAL",this.isHovering&&(n+=" | HOVER"),this.autoStabilizationActive){const t=this.flightSimulation.baseAltitude||this.data.targetAltitude,e=Math.abs(t-o.y)<=this.stabilizationTolerance;n+=` | AUTO-ESTAB (¬±${Math.round(100*this.stabilizationTolerance)}cm)`,n+=e?" ‚úÖ":" ‚ö†Ô∏è"}else this.stabilizationActive&&(n+=" | ESTABILIZANDO");this.isGrounded&&(n+=" | SOLO"),this.boostMode&&(n+=" | BOOST"),this.cinematicMode.enabled?n+=` | üé¨ CINEMATOGR√ÅFICO (${Math.round(100*this.cinematicMode.speedMultiplier)}%)`:this.fpvMode.enabled?n+=` | üèéÔ∏è FPV/SPORT (${Math.round(3.6*this.fpvMode.maxSpeed)}km/h)`:n+=" | üöÅ NORMAL"}else n+=" | DESLIGADO";t.setAttribute("value",n)}const e=document.querySelector("#flight-mode-indicator");if(e){let t,i;this.cinematicMode.enabled?(t=`üé¨ CINEMATOGR√ÅFICO (${Math.round(100*this.cinematicMode.speedMultiplier)}%)`,i="#ff8800"):this.fpvMode.enabled?(t=`üöÅ FPV/SPORT (${Math.round(3.6*this.fpvMode.maxSpeed)}km/h)`,i="#ff5050"):(t="üöÅ NORMAL",i="#00ff00"),e.setAttribute("value",t),e.setAttribute("color",i)}this.updateStabilizationIndicator()},updateStabilizationIndicator:function(){let t=document.querySelector("#stabilization-indicator");t||(t=document.createElement("div"),t.id="stabilization-indicator",t.style.cssText="\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: 20px;\n\t\t\t\t\tright: 20px;\n\t\t\t\t\tbackground: rgba(0, 0, 0, 0.8);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tpadding: 10px 15px;\n\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\tfont-family: Arial, sans-serif;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t\tborder-left: 4px solid #00ff00;\n\t\t\t\t",document.body.appendChild(t)),this.updateCinematicIndicator();const e=this.el.getAttribute("position"),i=this.flightSimulation.baseAltitude||this.data.targetAltitude,o=i-e.y,n=Math.abs(o),s=n<=this.stabilizationTolerance,a=s?"#00ff00":"#ffaa00";t.style.borderLeftColor=a;const r=Math.round(100*this.stabilizationTolerance),l=Math.round(100*n),c=s?"‚úÖ EST√ÅVEL":"‚ö†Ô∏è AJUSTANDO";t.innerHTML=`\n\t\t\t\t<div style="font-weight: bold; color: ${a};">üéØ ESTABILIZA√á√ÉO ATIVA</div>\n\t\t\t\t<div>Alvo: ${i.toFixed(1)}m (¬±${r}cm)</div>\n\t\t\t\t<div>Atual: ${e.y.toFixed(1)}m</div>\n\t\t\t\t<div>Diferen√ßa: ${l}cm</div>\n\t\t\t\t<div style="color: ${a}; font-weight: bold;">${c}</div>\n\t\t\t`},updateCinematicIndicator:function(){let t=document.querySelector("#cinematic-indicator");this.cinematicMode.enabled?(t||(t=document.createElement("div"),t.id="cinematic-indicator",t.style.cssText="\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\ttop: 20px;\n\t\t\t\t\t\tleft: 20px;\n\t\t\t\t\t\tbackground: rgba(255, 140, 0, 0.9);\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\tpadding: 10px 15px;\n\t\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\t\tfont-family: Arial, sans-serif;\n\t\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tz-index: 1000;\n\t\t\t\t\t\tborder-left: 4px solid #ff8c00;\n\t\t\t\t\t\tbox-shadow: 0 2px 10px rgba(255, 140, 0, 0.3);\n\t\t\t\t\t",document.body.appendChild(t)),t.innerHTML=`\n\t\t\t\t\t<div style="color: #fff; font-weight: bold;">üé¨ MODO CINEMATOGR√ÅFICO</div>\n\t\t\t\t\t<div style="font-size: 12px; margin-top: 3px; opacity: 0.9;">\n\t\t\t\t\t\tVelocidade: ${Math.round(100*this.cinematicMode.speedMultiplier)}% | \n\t\t\t\t\t\tRota√ß√£o: ${Math.round(100*this.cinematicMode.rotationMultiplier)}%\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="font-size: 11px; margin-top: 2px; opacity: 0.8;">\n\t\t\t\t\t\tGrip Esquerdo (VR) ou C (Teclado) para desativar\n\t\t\t\t\t</div>\n\t\t\t\t`):t&&t.parentNode&&t.parentNode.removeChild(t)},resetDronePosition:function(){console.log("üîÑ Resetando posi√ß√£o do drone..."),this.el.setAttribute("position","0 3 0"),this.el.setAttribute("rotation","0 0 0"),this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},emergencyStop:function(){console.log("üö® Parada de emerg√™ncia!"),this.isFlying=!1,this.isLanding=!1,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.updatePropellerEffects(!1),this.updateAudioFeedback(new THREE.Vector3(0,0,0))},toggleLandingMode:function(){this.isLanded?this.takeOff():this.isLanding?this.cancelLanding():this.startLanding()},startLanding:function(){if(this.isActive&&this.isFlying){if(!this.canLandHere())return console.log("‚ö†Ô∏è N√£o √© poss√≠vel pousar aqui - procure uma superf√≠cie adequada"),void this.showLandingWarning("Superf√≠cie inadequada para pouso!");this.isLanding=!0,console.log("üõ¨ Iniciando sequ√™ncia de pouso autom√°tico..."),this.showLandingIndicator(!0),this.el.sceneEl.emit("drone-landing-start")}else console.log("‚ö†Ô∏è Drone deve estar ativo e voando para pousar")},cancelLanding:function(){this.isLanding=!1,console.log("‚ùå Pouso cancelado"),this.showLandingIndicator(!1)},takeOff:function(){this.isLanded&&(this.isLanded=!1,this.isLanding=!1,this.isActive=!0,this.isFlying=!0,this.velocity.y=3,console.log("üöÅ Decolando..."),this.showTakeOffIndicator())},canLandHere:function(){const t=this.el.getAttribute("position");return null!==this.detectSurfaceBelow(t)},detectSurfaceBelow:function(t){if(t.y<=this.landingHeight+.5)return{type:"ground",height:0};const e=document.querySelectorAll(".building");for(let i of e){const e=i.getAttribute("position"),o=i.getAttribute("geometry");if(!e||!o)continue;const n=o.width||10,s=o.depth||10,a=o.height||20,r=Math.abs(t.x-e.x),l=Math.abs(t.z-e.z);if(r<n/2&&l<s/2){const o=e.y+a/2;if(t.y>o&&t.y-o<10)return{type:"building",height:o,object:i}}}return null},processLanding:function(t){if(!this.isLanding)return;const e=this.el.getAttribute("position"),i=this.detectSurfaceBelow(e);if(!i)return console.log("‚ö†Ô∏è Nenhuma superf√≠cie detectada para pouso"),void this.cancelLanding();const o=i.height+this.landingHeight;e.y>o?(this.velocity.y=-this.landingSpeed,this.velocity.x*=.9,this.velocity.z*=.9):this.completeLanding(i)},completeLanding:function(t){this.isLanding=!1,this.isLanded=!0,this.isFlying=!1,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0);const e=this.el.getAttribute("position");e.y=t.height+this.landingHeight,this.el.setAttribute("position",e),console.log(`‚úÖ Pouso conclu√≠do em ${t.type} na altura ${t.height.toFixed(2)}m`),this.showLandedIndicator(),this.showLandingIndicator(!1)},showLandingWarning:function(t){const e=document.createElement("div");e.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 30%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(255, 100, 100, 0.95);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t\tpointer-events: none;\n\t\t\t\ttext-align: center;\n\t\t\t",e.innerHTML=`‚ö†Ô∏è ${t}`,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},3e3)},showLandingIndicator:function(t){let e=document.getElementById("landing-indicator");t&&!e?(e=document.createElement("div"),e.id="landing-indicator",e.style.cssText="\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: 20px;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\ttransform: translateX(-50%);\n\t\t\t\t\tbackground: rgba(255, 165, 0, 0.9);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tpadding: 10px 20px;\n\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t\tanimation: pulse 1s infinite;\n\t\t\t\t",e.innerHTML="üõ¨ MODO POUSO ATIVO<br><small>Descendo suavemente...</small>",document.body.appendChild(e)):!t&&e&&e.remove()},showTakeOffIndicator:function(){const t=document.createElement("div");t.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(0, 255, 0, 0.9);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t",t.innerHTML="üöÅ DECOLANDO!",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},2e3)},showLandedIndicator:function(){const t=document.createElement("div");t.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(0, 150, 0, 0.9);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t",t.innerHTML="‚úÖ POUSADO COM SUCESSO!<br><small>Pressione Y novamente para decolar</small>",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},3e3)}}),console.log("üì¶ M√≥dulo drone-controller.js carregado com sucesso!"),AFRAME.components["game-manager"]||(AFRAME.registerComponent("game-manager",{schema:{totalCheckpoints:{type:"number",default:5},timeLimit:{type:"number",default:120},bestTime:{type:"number",default:0}},init:function(){console.log("üéÆ Inicializando Game Manager..."),this.gameState={isPlaying:!1,isPaused:!1,isFinished:!1,startTime:0,currentTime:0,elapsedTime:0,remainingTime:1e3*this.data.timeLimit,score:0,checkpointsReached:0,currentLap:1,totalLaps:3,bestLapTime:0,currentLapStartTime:0,timeWarningShown:!1,timeCriticalShown:!1},this.uiElements={},this.setupEventListeners(),this.setupUI(),this.setupDebugControls(),this.setupPersistence(),console.log("‚úÖ Game Manager inicializado!")},setupEventListeners:function(){this.el.addEventListener("checkpoint-reached",this.onCheckpointReached.bind(this)),this.el.addEventListener("race-finished",this.onRaceFinished.bind(this)),this.el.addEventListener("game-start",this.startGame.bind(this)),this.el.addEventListener("game-pause",this.pauseGame.bind(this)),this.el.addEventListener("enter-vr",this.onEnterVR.bind(this)),this.el.addEventListener("exit-vr",this.onExitVR.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this))},setupUI:function(){console.log("üñ•Ô∏è Configurando interface do usu√°rio..."),this.uiElements={timer:document.querySelector("#timer"),checkpointCounter:document.querySelector("#checkpoint-counter"),speedometer:document.querySelector("#speedometer"),score:document.querySelector("#score"),lapCounter:document.querySelector("#lap-counter"),bestTime:document.querySelector("#best-time")},this.createMissingUIElements(),this.updateUI(),this.createMainMenu()},createMissingUIElements:function(){const t=document.querySelector("#hud-container")||this.createHUDContainer();this.uiElements.score||(this.uiElements.score=this.createElement("a-text",{id:"score",value:"PONTOS: 0",position:"-2 1.5 -3",color:"#00ff00",scale:"0.8 0.8 0.8"}),t.appendChild(this.uiElements.score)),this.uiElements.lapCounter||(this.uiElements.lapCounter=this.createElement("a-text",{id:"lap-counter",value:"VOLTA: 1/3",position:"2 1.5 -3",color:"#ffff00",scale:"0.8 0.8 0.8"}),t.appendChild(this.uiElements.lapCounter)),this.uiElements.bestTime||(this.uiElements.bestTime=this.createElement("a-text",{id:"best-time",value:"MELHOR: --:--",position:"0 -1.5 -3",color:"#ff6600",scale:"0.6 0.6 0.6"}),t.appendChild(this.uiElements.bestTime))},createHUDContainer:function(){const t=document.querySelector("#drone-camera");if(!t)return console.error("‚ùå C√¢mera n√£o encontrada! Verificando seletor..."),null;const e=this.createElement("a-entity",{id:"hud-container"});return t.appendChild(e),e},createElement:function(t,e){const i=document.createElement(t);for(const[t,o]of Object.entries(e))i.setAttribute(t,o);return i},createMainMenu:function(){const t=this.createElement("a-entity",{id:"main-menu",position:"0 2 -4",visible:!0}),e=this.createElement("a-text",{value:"DRONE RACING VR",position:"0 1 0",color:"#00ffff",scale:"2 2 2",align:"center"}),i=this.createElement("a-box",{id:"start-button",position:"0 0 0",width:"2",height:"0.5",depth:"0.1",color:"#00ff00",class:"clickable"}),o=this.createElement("a-text",{value:"INICIAR CORRIDA",position:"0 0 0.06",color:"#000000",scale:"0.8 0.8 0.8",align:"center"}),n=this.createElement("a-box",{id:"settings-button",position:"0 -0.8 0",width:"2",height:"0.5",depth:"0.1",color:"#ffaa00",class:"clickable"}),s=this.createElement("a-text",{value:"CONFIGURA√á√ïES",position:"0 0 0.06",color:"#000000",scale:"0.8 0.8 0.8",align:"center"});i.appendChild(o),n.appendChild(s),t.appendChild(e),t.appendChild(i),t.appendChild(n),i.addEventListener("click",()=>{this.hideMainMenu(),this.startGame()}),this.el.appendChild(t),this.mainMenu=t},setupDebugControls:function(){this.debugMode=!1,this.debugPanel=null},setupPersistence:function(){this.loadGameData()},startGame:function(){console.log("üöÄ Iniciando corrida..."),this.gameState.isPlaying||(this.gameState.isPlaying=!0,this.gameState.isPaused=!1,this.gameState.isFinished=!1,this.gameState.startTime=Date.now(),this.gameState.currentLapStartTime=Date.now(),this.gameState.elapsedTime=0,this.gameState.score=0,this.gameState.checkpointsReached=0,this.gameState.currentLap=1,this.resetAllCheckpoints(),this.startTimer(),this.enableDroneControls(),this.updateUI(),this.el.emit("game-started"),console.log("‚úÖ Corrida iniciada!"))},pauseGame:function(){this.gameState.isPlaying&&!this.gameState.isPaused&&(console.log("‚è∏Ô∏è Pausando jogo..."),this.gameState.isPaused=!0,this.stopTimer(),this.disableDroneControls(),this.showPauseMenu(),this.el.emit("game-paused"))},showPauseMenu:function(){console.log("Exibindo menu de pausa");const t=document.querySelector("#pause-menu");t?t.style.display="flex":(console.warn("Menu de pausa n√£o encontrado no DOM"),this.createPauseMenu())},hidePauseMenu:function(){console.log("Ocultando menu de pausa");const t=document.querySelector("#pause-menu");t&&(t.style.display="none")},createPauseMenu:function(){console.log("Criando menu de pausa");const t=document.createElement("div");t.id="pause-menu",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="9999";const e=document.createElement("h1");e.textContent="JOGO PAUSADO",e.style.color="white",e.style.marginBottom="20px";const i=document.createElement("button");i.textContent="CONTINUAR",i.style.padding="10px 20px",i.style.fontSize="18px",i.style.margin="10px",i.style.cursor="pointer",i.onclick=()=>{document.querySelector("[game-manager]").components["game-manager"].resumeGame()},t.appendChild(e),t.appendChild(i),document.body.appendChild(t)},resumeGame:function(){this.gameState.isPaused&&(console.log("‚ñ∂Ô∏è Retomando jogo..."),this.gameState.isPaused=!1,this.gameState.startTime=Date.now()-this.gameState.elapsedTime,this.startTimer(),this.enableDroneControls(),this.hidePauseMenu(),this.el.emit("game-resumed"))},resetGame:function(){console.log("üîÑ Resetando jogo..."),console.trace("üîç Stack trace do resetGame:"),this.gameOverScreen&&this.gameOverScreen.parentNode&&(this.gameOverScreen.parentNode.removeChild(this.gameOverScreen),this.gameOverScreen=null),this.gameState.isPlaying=!1,this.gameState.isPaused=!1,this.gameState.isFinished=!1,this.gameState.elapsedTime=0,this.gameState.remainingTime=1e3*this.data.timeLimit,this.gameState.score=0,this.gameState.checkpointsReached=0,this.gameState.currentLap=1,this.gameState.timeWarningShown=!1,this.gameState.timeCriticalShown=!1,this.stopTimer(),this.resetAllCheckpoints(),this.resetDrone(),this.updateUI(),this.showMainMenu()},finishGame:function(){console.log("üèÅ Finalizando corrida..."),this.gameState.isPlaying=!1,this.gameState.isFinished=!0,this.stopTimer(),this.disableDroneControls(),this.calculateFinalScore(),this.saveBestTime();const t=this.isNewHighScore();this.saveHighScore(),t&&console.log("üéâ NOVO RECORDE! Parab√©ns!"),this.showHighScores(),this.showResultsScreen(),this.el.emit("game-finished",{finalScore:this.gameState.score,finalTime:this.gameState.elapsedTime,checkpointsReached:this.gameState.checkpointsReached})},onCheckpointReached:function(t){const e=t.detail;console.log(`üéØ Checkpoint ${e.id} alcan√ßado!`),this.gameState.checkpointsReached++,this.gameState.score+=e.points,e.timeBonus&&(this.gameState.elapsedTime-=1e3*e.timeBonus),this.gameState.checkpointsReached>=this.data.totalCheckpoints&&this.completeLap(),this.updateUI(),this.saveGameData()},onCollision:function(t,e){console.log(`üí• Colis√£o registrada: ${t}`),this.gameState.collisions||(this.gameState.collisions=0),this.gameState.collisions++;const i=this.getCollisionPenalty(t);i>0&&(this.gameState.score=Math.max(0,this.gameState.score-i),console.log(`‚ö†Ô∏è Penalidade de ${i} pontos por colis√£o!`)),this.updateUI(),this.el.emit("collision-registered",{type:t,object:e,totalCollisions:this.gameState.collisions,penalty:i})},getCollisionPenalty:function(t){switch(t){case"building":return 50;case"obstacle":return 30;case"boundary":return 20;case"ceiling":return 10;case"ground":return 15;default:return 0}},onRaceFinished:function(t){this.el.sceneEl.emit("race-finished",{result:"victory"}),this.finishGame()},finishRace:function(t){"timeout"===t&&(console.log("‚è∞ Tempo esgotado!"),this.el.sceneEl.emit("race-finished",{result:"timeout"})),this.finishGame()},completeLap:function(){const t=Date.now()-this.gameState.currentLapStartTime;console.log(`üèÅ Volta ${this.gameState.currentLap} completada em ${this.formatTime(t)}!`),(0===this.gameState.bestLapTime||t<this.gameState.bestLapTime)&&(this.gameState.bestLapTime=t,console.log("üèÜ Novo recorde de volta!")),this.gameState.currentLap<this.gameState.totalLaps?(this.gameState.currentLap++,this.gameState.currentLapStartTime=Date.now(),this.gameState.checkpointsReached=0,this.resetAllCheckpoints(),this.showLapNotification()):this.finishGame()},startTimer:function(){this.timerInterval=setInterval(()=>{this.gameState.isPaused||(this.gameState.currentTime=Date.now(),this.gameState.elapsedTime=this.gameState.currentTime-this.gameState.startTime,this.updateTimer())},100)},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)},updateTimer:function(){if(this.gameState.remainingTime=1e3*this.data.timeLimit-this.gameState.elapsedTime,this.uiElements.timer){const t=Math.max(0,this.gameState.remainingTime);this.uiElements.timer.setAttribute("value",`TEMPO: ${this.formatTime(t)}`);const e=t/1e3;e<=10?(this.uiElements.timer.setAttribute("color","#ff0000"),this.uiElements.timer.setAttribute("scale","1.2 1.2 1.2"),this.gameState.timeCriticalShown||(this.showTimeWarning("TEMPO CR√çTICO!","#ff0000"),this.gameState.timeCriticalShown=!0)):e<=30?(this.uiElements.timer.setAttribute("color","#ff8800"),this.uiElements.timer.setAttribute("scale","1.1 1.1 1.1"),this.gameState.timeWarningShown||(this.showTimeWarning("ATEN√á√ÉO: Tempo acabando!","#ff8800"),this.gameState.timeWarningShown=!0)):(this.uiElements.timer.setAttribute("color","#00ff00"),this.uiElements.timer.setAttribute("scale","1.0 1.0 1.0"))}this.gameState.remainingTime<=0&&this.gameState.isPlaying&&this.onTimeUp()},formatTime:function(t){const e=Math.floor(t/1e3),i=Math.floor(e/60),o=e%60,n=Math.floor(t%1e3/10);return`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${n.toString().padStart(2,"0")}`},showTimeWarning:function(t,e){const i=document.createElement("a-text");i.setAttribute("value",t),i.setAttribute("color",e),i.setAttribute("position","0 2 -3"),i.setAttribute("align","center"),i.setAttribute("scale","2 2 2"),i.setAttribute("animation","property: scale; to: 2.5 2.5 2.5; dur: 500; dir: alternate; loop: 3"),this.el.sceneEl.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},3e3),console.log(`‚è∞ ${t}`)},onTimeUp:function(){console.log("‚è∞ Tempo esgotado! Game Over"),this.gameState.isPlaying=!1,this.gameState.isFinished=!0,this.stopTimer(),this.disableDroneControls(),this.showGameOverScreen("TEMPO ESGOTADO!"),this.el.emit("game-over",{reason:"timeout",score:this.gameState.score,checkpoints:this.gameState.checkpointsReached,timeElapsed:this.gameState.elapsedTime})},showGameOverScreen:function(t){const e=document.createElement("a-entity");e.setAttribute("id","game-over-screen"),e.setAttribute("position","0 0 -5");const i=document.createElement("a-plane");i.setAttribute("width","10"),i.setAttribute("height","6"),i.setAttribute("color","#000000"),i.setAttribute("opacity","0.8"),e.appendChild(i);const o=document.createElement("a-text");o.setAttribute("value",t),o.setAttribute("color","#ff0000"),o.setAttribute("position","0 1.5 0.1"),o.setAttribute("align","center"),o.setAttribute("scale","3 3 3"),e.appendChild(o);const n=document.createElement("a-text"),s=[`PONTUA√á√ÉO FINAL: ${this.gameState.score}`,`CHECKPOINTS: ${this.gameState.checkpointsReached}/${this.data.totalCheckpoints}`,`TEMPO DECORRIDO: ${this.formatTime(this.gameState.elapsedTime)}`,"","Pressione R para reiniciar"].join("\n");n.setAttribute("value",s),n.setAttribute("color","#ffffff"),n.setAttribute("position","0 -0.5 0.1"),n.setAttribute("align","center"),n.setAttribute("scale","1.5 1.5 1.5"),e.appendChild(n),this.el.sceneEl.appendChild(e),this.gameOverScreen=e},updateUI:function(){this.updateTimer(),this.uiElements.checkpointCounter&&this.uiElements.checkpointCounter.setAttribute("value",`CHECKPOINT: ${this.gameState.checkpointsReached}/${this.data.totalCheckpoints}`),this.uiElements.score&&this.uiElements.score.setAttribute("value",`PONTOS: ${this.gameState.score}`),this.uiElements.lapCounter&&this.uiElements.lapCounter.setAttribute("value",`VOLTA: ${this.gameState.currentLap}/${this.gameState.totalLaps}`),this.uiElements.bestTime&&this.data.bestTime>0&&this.uiElements.bestTime.setAttribute("value",`MELHOR: ${this.formatTime(this.data.bestTime)}`)},hideMainMenu:function(){this.mainMenu&&this.mainMenu.setAttribute("visible",!1)},showMainMenu:function(){this.mainMenu&&this.mainMenu.setAttribute("visible",!0)},onKeyDown:function(t){switch(t.key.toLowerCase()){case" ":this.gameState.isPlaying&&!this.gameState.isPaused?this.pauseGame():this.gameState.isPaused&&this.resumeGame();break;case"r":this.resetGame();break;case"enter":this.gameState.isPlaying||this.startGame()}},resetAllCheckpoints:function(){document.querySelectorAll("[checkpoint]").forEach(t=>{t.components&&t.components.checkpoint&&"function"==typeof t.components.checkpoint.reset&&t.components.checkpoint.reset()})},enableDroneControls:function(){const t=document.querySelector("#drone");t&&t.components["drone-controller"]&&(t.components["drone-controller"].enabled=!0)},disableDroneControls:function(){const t=document.querySelector("#drone");t&&t.components["drone-controller"]&&(t.components["drone-controller"].enabled=!1)},resetDrone:function(){const t=document.querySelector("#drone");t&&t.components["drone-controller"]&&t.components["drone-controller"].resetDronePosition()},addScore:function(t){this.gameState.score+=t,this.updateUI(),console.log(`üí∞ Score atualizado: ${this.gameState.score} pontos`)},calculateFinalScore:function(){const t=Math.max(0,(1e3*this.data.timeLimit-this.gameState.elapsedTime)/1e3);this.gameState.score+=Math.floor(10*t),this.gameState.score+=1e3*(this.gameState.currentLap-1)},saveBestTime:function(){this.gameState.currentLap>=this.gameState.totalLaps&&(0===this.data.bestTime||this.gameState.elapsedTime<this.data.bestTime)&&(this.data.bestTime=this.gameState.elapsedTime,this.saveGameData(),console.log("üèÜ Novo recorde geral!"))},saveGameData:function(){const t={bestTime:this.data.bestTime,bestLapTime:this.gameState.bestLapTime,totalGames:(this.loadedData?.totalGames||0)+(this.gameState.isFinished?1:0)};localStorage.setItem("droneRacingVR",JSON.stringify(t))},loadGameData:function(){try{const t=localStorage.getItem("droneRacingVR");t&&(this.loadedData=JSON.parse(t),this.data.bestTime=this.loadedData.bestTime||0,this.gameState.bestLapTime=this.loadedData.bestLapTime||0)}catch(t){console.warn("Erro ao carregar dados salvos:",t)}},saveHighScore:function(){try{let t=JSON.parse(localStorage.getItem("droneRacingHighScores")||"[]");const e={score:this.gameState.score,time:this.gameState.elapsedTime,date:(new Date).toISOString(),checkpoints:this.gameState.checkpointsReached,laps:this.gameState.currentLap-1};return t.push(e),t.sort((t,e)=>e.score-t.score),t=t.slice(0,10),localStorage.setItem("droneRacingHighScores",JSON.stringify(t)),console.log("üèÜ Pontua√ß√£o salva no ranking!"),t}catch(t){return console.warn("Erro ao salvar ranking:",t),[]}},getHighScores:function(){try{return JSON.parse(localStorage.getItem("droneRacingHighScores")||"[]")}catch(t){return console.warn("Erro ao carregar ranking:",t),[]}},showHighScores:function(){const t=this.getHighScores();return console.log("üèÜ === RANKING DE MAIORES PONTUA√á√ïES ==="),t.forEach((t,e)=>{const i=this.formatTime(t.time),o=new Date(t.date).toLocaleDateString("pt-BR");console.log(`${e+1}¬∫ - ${t.score} pts | ${i} | ${o}`)}),t},isNewHighScore:function(){const t=this.getHighScores();return t.length<10||this.gameState.score>t[t.length-1].score},onEnterVR:function(){console.log("ü•Ω Entrando no modo VR...")},onExitVR:function(){console.log("üñ•Ô∏è Saindo do modo VR...")}}),console.log("üì¶ M√≥dulo game-manager.js carregado com sucesso!")),AFRAME.registerComponent("navigation-arrow",{schema:{targetCheckpoint:{type:"number",default:1},distance:{type:"number",default:2},size:{type:"number",default:.4},color:{type:"color",default:"#00ff00"},showDistance:{type:"boolean",default:!0},showPhase:{type:"boolean",default:!0},showPath:{type:"boolean",default:!0},pathArrows:{type:"number",default:3}},init:function(){this.currentTarget=null,this.checkpoints=[],this.dronePosition=new THREE.Vector3,this.targetPosition=new THREE.Vector3,this.totalCheckpoints=0,this.pathArrows=[],this.createArrowElements(),this.setupEventListeners(),setTimeout(()=>{this.findCheckpoints(),this.updateTarget(),this.startNavigation()},1e3)},createArrowElements:function(){this.arrowContainer=document.createElement("a-entity"),this.arrowContainer.setAttribute("id","navigation-arrow-container"),this.arrowContainer.setAttribute("data-arrow-container","true"),this.el.appendChild(this.arrowContainer),this.arrowMesh=document.createElement("a-entity"),this.arrowMesh.setAttribute("data-arrow-mesh","true"),this.arrowMesh.setAttribute("geometry",{primitive:"cone",radiusBottom:.4*this.data.size,radiusTop:0,height:2*this.data.size}),this.arrowMesh.setAttribute("material",{color:this.data.color,emissive:this.data.color,emissiveIntensity:.5,transparent:!0,opacity:.9}),this.arrowMesh.setAttribute("position",`0 0.2 -${this.data.distance+1}`),this.arrowMesh.setAttribute("rotation","90 0 0"),this.arrowMesh.setAttribute("animation__pulse",{property:"scale",to:"1.3 1.3 1.3",dur:800,direction:"alternate",loop:!0,easing:"easeInOutSine"}),this.arrowMesh.setAttribute("animation__spin",{property:"rotation",to:"90 360 0",dur:3e3,loop:!0,easing:"linear"}),this.arrowContainer.appendChild(this.arrowMesh),this.highlightRing=document.createElement("a-entity"),this.highlightRing.setAttribute("geometry",{primitive:"torus",radius:.8*this.data.size,radiusTubular:.05}),this.highlightRing.setAttribute("material",{color:this.data.color,emissive:this.data.color,emissiveIntensity:.3,transparent:!0,opacity:.6}),this.highlightRing.setAttribute("position",`0 0.5 -${this.data.distance}`),this.highlightRing.setAttribute("rotation","0 0 0"),this.highlightRing.setAttribute("animation__ring",{property:"rotation",to:"0 0 360",dur:2e3,loop:!0,easing:"linear"}),this.arrowContainer.appendChild(this.highlightRing),this.data.showDistance&&(this.distanceText=document.createElement("a-text"),this.distanceText.setAttribute("data-distance-text","true"),this.distanceText.setAttribute("value","0m"),this.distanceText.setAttribute("position",`0 -0.5 -${this.data.distance}`),this.distanceText.setAttribute("align","center"),this.distanceText.setAttribute("color",this.data.color),this.distanceText.setAttribute("scale","1.2 1.2 1.2"),this.distanceText.setAttribute("font","dejavu"),this.arrowContainer.appendChild(this.distanceText)),this.data.showPhase&&(this.phaseText=document.createElement("a-text"),this.phaseText.setAttribute("data-phase-text","true"),this.phaseText.setAttribute("value","FASE 1"),this.phaseText.setAttribute("position",`0 1.7 -${this.data.distance}`),this.phaseText.setAttribute("align","center"),this.phaseText.setAttribute("color","#ffffff"),this.phaseText.setAttribute("scale","1.0 1.0 1.0"),this.phaseText.setAttribute("font","dejavu"),this.phaseBackground=document.createElement("a-entity"),this.phaseBackground.setAttribute("geometry",{primitive:"plane",width:2,height:.5}),this.phaseBackground.setAttribute("material",{color:"#000000",transparent:!0,opacity:.7}),this.phaseBackground.setAttribute("position",`0 1.7 -${this.data.distance+.01}`),this.arrowContainer.appendChild(this.phaseBackground),this.arrowContainer.appendChild(this.phaseText)),this.connectionLine=document.createElement("a-entity"),this.connectionLine.setAttribute("geometry",{primitive:"cylinder",radius:.03,height:1}),this.connectionLine.setAttribute("material",{color:this.data.color,emissive:this.data.color,emissiveIntensity:.3,transparent:!0,opacity:.6}),this.connectionLine.setAttribute("position","0 0.25 -"+.5*this.data.distance),this.connectionLine.setAttribute("rotation","90 0 0"),this.connectionLine.setAttribute("animation__glow",{property:"material.emissiveIntensity",to:"0.8",dur:1500,direction:"alternate",loop:!0,easing:"easeInOutSine"}),this.arrowContainer.appendChild(this.connectionLine),this.data.showPath&&this.createPathArrows()},createPathArrows:function(){this.clearPathArrows();this.checkpoints.filter(t=>!t.reached).slice(0,this.data.pathArrows).forEach((t,e)=>{if(0===e)return;const i=document.createElement("a-cone");i.setAttribute("geometry",{radiusBottom:.6*this.data.size,radiusTop:0,height:1.5*this.data.size});const o=["#ffff00","#ff8800","#ff0088"][e-1]||"#888888";i.setAttribute("material",{color:o,emissive:o,emissiveIntensity:.3,transparent:!0,opacity:.6}),i.setAttribute("rotation","90 0 0"),i.setAttribute("scale","0.8 0.8 0.8"),i.setAttribute("animation__pulse",{property:"scale",to:"1.0 1.0 1.0",dur:1500,direction:"alternate",loop:!0,easing:"easeInOutSine"}),this.pathArrows.push({element:i,checkpoint:t,index:e}),this.arrowContainer.appendChild(i)})},clearPathArrows:function(){this.pathArrows.forEach(t=>{t.element.parentNode&&t.element.parentNode.removeChild(t.element)}),this.pathArrows=[]},setupEventListeners:function(){this.el.sceneEl.addEventListener("checkpoint-reached",this.onCheckpointReached.bind(this)),this.el.sceneEl.addEventListener("game-reset",this.onGameReset.bind(this))},findCheckpoints:function(){const t=document.querySelectorAll("[checkpoint]");this.checkpoints=[],t.forEach((t,e)=>{const i=t.getAttribute("checkpoint"),o=t.getAttribute("position");i&&o&&this.checkpoints.push({id:i.id,element:t,position:new THREE.Vector3(o.x,o.y,o.z),reached:!1})}),this.checkpoints.sort((t,e)=>t.id-e.id)},updateTarget:function(){if(this.currentTarget=this.checkpoints.find(t=>!t.reached),this.currentTarget){if(this.arrowContainer.setAttribute("visible",!0),this.phaseText){const t=this.currentTarget.id,e=this.checkpoints.length;this.phaseText.setAttribute("value",`FASE ${t}/${e}`)}this.data.showPath&&this.createPathArrows()}else this.arrowContainer.setAttribute("visible",!1),this.clearPathArrows()},startNavigation:function(){console.log("üß≠ Sistema de navega√ß√£o iniciado"),this.updateArrowVisibility(!0),this.data.showPath&&0===this.pathArrows.length&&this.createPathArrows()},updateArrowVisibility:function(t){this.arrowContainer&&this.arrowContainer.setAttribute("visible",t)},tick:function(t,e){if(!this.currentTarget)return;const i=document.querySelector("#drone");if(!i)return;const o=i.getAttribute("position");this.dronePosition.set(o.x,o.y,o.z),this.targetPosition.copy(this.currentTarget.position);const n=this.targetPosition.clone().sub(this.dronePosition),s=n.length();n.normalize();const a=Math.atan2(n.x,n.z);this.arrowContainer.setAttribute("rotation",`0 ${THREE.MathUtils.radToDeg(a)} 0`),this.distanceText&&this.distanceText.setAttribute("value",`${s.toFixed(0)}m`);const r=Math.max(.3,Math.min(1,50/s));this.arrowMesh.setAttribute("material","emissiveIntensity",r);const l=Math.min(this.data.distance,.1*s);this.connectionLine.setAttribute("geometry","height",l),this.connectionLine.setAttribute("position","0 0 -"+.5*l),this.updatePathArrows()},updatePathArrows:function(){if(!this.data.showPath||0===this.pathArrows.length)return;const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position");this.pathArrows.forEach((t,i)=>{const o=t.checkpoint;if(!o)return;const n=o.position.clone().sub(new THREE.Vector3(e.x,e.y,e.z)),s=n.length();n.normalize();const a=this.data.distance+1.5*i,r=n.multiplyScalar(a);t.element.setAttribute("position",`${r.x} ${r.y+.2} ${r.z}`);const l=Math.atan2(n.x,n.z);t.element.setAttribute("rotation",`90 ${THREE.MathUtils.radToDeg(l)} 0`);const c=Math.max(.3,Math.min(.8,100/s));t.element.setAttribute("material","opacity",c)})},onCheckpointReached:function(t){const e=t.detail.id,i=this.checkpoints.find(t=>t.id===e);i&&(i.reached=!0,console.log(`‚úÖ Checkpoint ${e} marcado como alcan√ßado`)),this.updateTarget()},onGameReset:function(){this.checkpoints.forEach(t=>{t.reached=!1}),this.updateTarget()},remove:function(){this.arrowContainer&&this.arrowContainer.remove()}}),AFRAME.registerComponent("performance-monitor",{schema:{targetFPS:{type:"number",default:60},minFPS:{type:"number",default:45},maxFPS:{type:"number",default:90},monitorInterval:{type:"number",default:1e3},autoOptimize:{type:"boolean",default:!0},showStats:{type:"boolean",default:!0}},init(){console.log("üìä Inicializando monitor de performance..."),this.performanceData={fps:0,frameTime:0,memory:0,drawCalls:0,triangles:0,lastFrameTime:performance.now(),frameCount:0,fpsHistory:[],qualityLevel:"high"},this.optimizationSettings={high:{shadowMapSize:2048,fogFar:200,lodDistance:80,particleCount:100},medium:{shadowMapSize:1024,fogFar:150,lodDistance:60,particleCount:50},low:{shadowMapSize:512,fogFar:100,lodDistance:40,particleCount:25}},this.setupPerformanceMonitoring(),this.createStatsDisplay(),this.startMonitoring()},setupPerformanceMonitoring(){this.fpsCounter={startTime:performance.now(),frameCount:0},this.originalRender=this.el.sceneEl.renderer.render,this.el.sceneEl.renderer.render=(t,e)=>{this.updatePerformanceMetrics(),this.originalRender.call(this.el.sceneEl.renderer,t,e)}},updatePerformanceMetrics(){const t=performance.now(),e=t-this.performanceData.lastFrameTime;this.performanceData.frameTime=e,this.performanceData.lastFrameTime=t,this.fpsCounter.frameCount++,t-this.fpsCounter.startTime>=1e3&&(this.performanceData.fps=Math.round(1e3*this.fpsCounter.frameCount/(t-this.fpsCounter.startTime)),this.performanceData.fpsHistory.push(this.performanceData.fps),this.performanceData.fpsHistory.length>10&&this.performanceData.fpsHistory.shift(),this.fpsCounter.frameCount=0,this.fpsCounter.startTime=t);const i=this.el.sceneEl.renderer;i.info&&(this.performanceData.drawCalls=i.info.render.calls,this.performanceData.triangles=i.info.render.triangles),performance.memory&&(this.performanceData.memory=Math.round(performance.memory.usedJSHeapSize/1024/1024))},createStatsDisplay(){this.data.showStats&&(this.statsPanel=document.createElement("div"),this.statsPanel.id="performance-stats",this.statsPanel.style.cssText="\n            position: fixed;\n            top: 10px;\n            right: 10px;\n            background: rgba(0, 0, 0, 0.8);\n            color: #00ff00;\n            padding: 10px;\n            border-radius: 5px;\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            z-index: 1000;\n            min-width: 200px;\n        ",document.body.appendChild(this.statsPanel))},updateStatsDisplay(){if(!this.statsPanel)return;const t=this.performanceData.fpsHistory.length>0?Math.round(this.performanceData.fpsHistory.reduce((t,e)=>t+e,0)/this.performanceData.fpsHistory.length):0,e=this.performanceData.fps>=this.data.targetFPS?"#00ff00":this.performanceData.fps>=this.data.minFPS?"#ffff00":"#ff0000";this.statsPanel.innerHTML=`\n            <div style="color: ${e}; font-weight: bold;">\n                FPS: ${this.performanceData.fps} (avg: ${t})\n            </div>\n            <div>Frame Time: ${this.performanceData.frameTime.toFixed(2)}ms</div>\n            <div>Memory: ${this.performanceData.memory}MB</div>\n            <div>Draw Calls: ${this.performanceData.drawCalls}</div>\n            <div>Triangles: ${this.performanceData.triangles}</div>\n            <div>Quality: ${this.performanceData.qualityLevel.toUpperCase()}</div>\n            <div style="margin-top: 5px; font-size: 10px;">\n                Target: ${this.data.targetFPS} FPS\n            </div>\n        `},startMonitoring(){this.monitorInterval=setInterval(()=>{this.updateStatsDisplay(),this.data.autoOptimize&&this.autoOptimizePerformance()},this.data.monitorInterval)},autoOptimizePerformance(){const t=this.performanceData.fpsHistory.length>0?this.performanceData.fpsHistory.reduce((t,e)=>t+e,0)/this.performanceData.fpsHistory.length:this.performanceData.fps;let e=this.performanceData.qualityLevel;t<this.data.minFPS?"high"===this.performanceData.qualityLevel?e="medium":"medium"===this.performanceData.qualityLevel&&(e="low"):t>this.data.targetFPS+10&&("low"===this.performanceData.qualityLevel?e="medium":"medium"===this.performanceData.qualityLevel&&(e="high")),e!==this.performanceData.qualityLevel&&(this.applyQualitySettings(e),this.performanceData.qualityLevel=e,console.log(`üéÆ Qualidade ajustada para: ${e} (FPS: ${t})`))},applyQualitySettings(t){const e=this.optimizationSettings[t],i=this.el.sceneEl;i.getAttribute("fog")&&i.setAttribute("fog",`far: ${e.fogFar}`);const o=i.components["urban-environment"];o&&o.lodSystem&&(o.lodSystem.maxDistance=e.lodDistance),this.el.emit("quality-changed",{level:t,settings:e})},setQuality(t){this.optimizationSettings[t]&&(this.applyQualitySettings(t),this.performanceData.qualityLevel=t)},getPerformanceData(){return{...this.performanceData}},toggleStats(){this.statsPanel&&(this.statsPanel.style.display="none"===this.statsPanel.style.display?"block":"none")},remove(){this.monitorInterval&&clearInterval(this.monitorInterval),this.statsPanel&&document.body.removeChild(this.statsPanel),this.originalRender&&(this.el.sceneEl.renderer.render=this.originalRender)}}),window.PerformanceUtils={throttle(t,e){let i;return function(){const o=arguments,n=this;i||(t.apply(n,o),i=!0,setTimeout(()=>i=!1,e))}},debounce(t,e){let i;return function(...o){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),t(...o)},e)}},createObjectPool(t,e,i=10){const o=[];for(let e=0;e<i;e++)o.push(t());return{get:()=>o.length>0?o.pop():t(),release(t){e&&e(t),o.push(t)},size:()=>o.length}}},console.log("üì¶ M√≥dulo performance-monitor.js carregado com sucesso!"),AFRAME.registerComponent("urban-environment",{schema:{citySize:{type:"number",default:200},buildingCount:{type:"number",default:50},obstacleCount:{type:"number",default:30},treeCount:{type:"number",default:20},streetWidth:{type:"number",default:8},seed:{type:"number",default:12345},vrOptimized:{type:"boolean",default:!1}},init:function(){console.log("üèôÔ∏è Inicializando ambiente urbano..."),this.random=this.createSeededRandom(this.data.seed),this.urbanContainer=document.createElement("a-entity"),this.urbanContainer.setAttribute("id","urban-container"),this.el.appendChild(this.urbanContainer),this.generateStreets(),this.generateBuildings(),this.generateObstacles(),this.generateVegetation(),this.generateLighting(),this.generateSkybox(),console.log("‚úÖ Ambiente urbano criado com sucesso!")},setupLODSystem(){console.log("üîß Configurando sistema de LOD..."),this.lodSystem={camera:null,buildings:[],updateInterval:null,lastUpdate:0,updateFrequency:100},setTimeout(()=>{this.lodSystem.camera=document.querySelector("#drone-camera"),this.lodSystem.camera&&(this.collectBuildingsForLOD(),this.startLODUpdates())},1e3)},collectBuildingsForLOD(){const t=this.el.querySelectorAll('[data-building="true"]');this.lodSystem.buildings=Array.from(t).map(t=>({element:t,position:t.getAttribute("position"),highDetail:t.querySelector(".building-details"),lowDetail:t.querySelector(".building-simple")}))},startLODUpdates(){this.lodSystem.updateInterval=setInterval(()=>{this.updateLOD()},this.lodSystem.updateFrequency)},updateLOD(){if(!this.lodSystem.camera)return;const t=Date.now();if(t-this.lodSystem.lastUpdate<this.lodSystem.updateFrequency)return;const e=this.lodSystem.camera.getAttribute("position");e&&(this.lodSystem.buildings.forEach(t=>{const i=this.calculateDistance(e,t.position);i>80?t.element.setAttribute("visible",!1):i>50?(t.element.setAttribute("visible",!0),t.highDetail&&t.highDetail.setAttribute("visible",!1),t.lowDetail&&t.lowDetail.setAttribute("visible",!0)):(t.element.setAttribute("visible",!0),t.highDetail&&t.highDetail.setAttribute("visible",!0),t.lowDetail&&t.lowDetail.setAttribute("visible",!1))}),this.lodSystem.lastUpdate=t)},calculateDistance(t,e){const i=t.x-e.x,o=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+o*o+n*n)},remove(){this.lodSystem&&this.lodSystem.updateInterval&&clearInterval(this.lodSystem.updateInterval)},createSeededRandom:function(t){let e=2147483648,i=t||Math.floor(Math.random()*(e-1));return function(){return i=(1103515245*i+12345)%e,i/(e-1)}},generateStreets:function(){console.log("üõ£Ô∏è Gerando sistema de ruas..."),console.log(`üìè Configura√ß√µes: citySize=${this.data.citySize}, streetWidth=${this.data.streetWidth}`);const t=document.createElement("a-entity");t.setAttribute("id","streets");const e=this.data.citySize,i=this.data.streetWidth;for(let o=-e;o<=e;o+=40){const n=document.createElement("a-plane");n.setAttribute("geometry",{primitive:"plane",width:i,height:2*e}),n.setAttribute("material",{color:"#333333",roughness:.9,metalness:.1}),n.setAttribute("position",`${o} 0.05 0`),n.setAttribute("rotation","-90 0 0"),t.appendChild(n);const s=document.createElement("a-plane");s.setAttribute("geometry",{primitive:"plane",width:.5,height:2*e}),s.setAttribute("material",{color:"#ffff00",emissive:"#ffff00",emissiveIntensity:.3}),s.setAttribute("position",`${o} 0.06 0`),s.setAttribute("rotation","-90 0 0"),t.appendChild(s)}for(let o=-e;o<=e;o+=50){const n=document.createElement("a-plane");n.setAttribute("geometry",{primitive:"plane",width:2*e,height:i}),n.setAttribute("material",{color:"#333333",roughness:.9,metalness:.1}),n.setAttribute("position",`0 0.05 ${o}`),n.setAttribute("rotation","-90 0 0"),t.appendChild(n)}this.generateCityBlocks(t),this.urbanContainer.appendChild(t),console.log("‚úÖ Sistema de ruas e quadras criado!")},generateCityBlocks:function(t){console.log("üèòÔ∏è Gerando quadras urbanas...");const e=this.data.citySize;for(let i=20-e;i<e;i+=40)for(let o=25-e;o<e;o+=50){const e=document.createElement("a-plane");e.setAttribute("geometry",{primitive:"plane",width:35,height:35}),e.setAttribute("material",{color:"#4a4a4a",roughness:.8,metalness:.2}),e.setAttribute("position",`${i} 0.02 ${o}`),e.setAttribute("rotation","-90 0 0"),t.appendChild(e);const n=document.createElement("a-plane");n.setAttribute("geometry",{primitive:"plane",width:37,height:37}),n.setAttribute("material",{color:"#666666",roughness:.9,metalness:.1}),n.setAttribute("position",`${i} 0.01 ${o}`),n.setAttribute("rotation","-90 0 0"),t.appendChild(n)}},generateBuildings:function(){console.log("üè¢ Gerando pr√©dios...");const t=document.createElement("a-entity");t.setAttribute("id","buildings");const e=this.data.citySize,i=this.data.buildingCount;for(let o=0;o<i;o++){const i=this.createBuilding();let o,n;do{o=(this.random()-.5)*e*1.8,n=(this.random()-.5)*e*1.8}while(this.isOnStreet(o,n));i.setAttribute("position",`${o} 0 ${n}`),t.appendChild(i)}this.urbanContainer.appendChild(t),this.setupLODSystem()},createBuilding:function(){const t=document.createElement("a-entity");t.classList.add("building"),t.setAttribute("data-building","true");const e=this.data.vrOptimized?6:8,i=this.data.vrOptimized?6:8,o=this.data.vrOptimized?12:15,n=this.data.vrOptimized?8:12,s=this.data.vrOptimized?8:12,a=this.data.vrOptimized?25:40,r=e+this.random()*n,l=i+this.random()*s,c=o+this.random()*a,d=document.createElement("a-box");d.setAttribute("geometry",{width:r,height:c,depth:l});const h=["#666666","#888888","#555555","#777777","#999999"],u={color:h[Math.floor(this.random()*h.length)],roughness:this.data.vrOptimized?1:.8,metalness:this.data.vrOptimized?0:.2};return d.setAttribute("material",u),d.setAttribute("position",`0 ${c/2} 0`),t.appendChild(d),this.data.vrOptimized||(this.addWindows(t,r,c,l),this.random()>.7&&this.addRoof(t,r,c,l),this.random()>.6&&this.addRooftopEquipment(t,r,c,l)),t},addWindows:function(t,e,i,o){const n=1.5;for(let s=3;s<i-3;s+=3)for(let i=-e/2+3;i<e/2-3;i+=3){const e=document.createElement("a-plane");e.setAttribute("geometry",{width:n,height:n}),e.setAttribute("material",{color:this.random()>.8?"#ffff88":"#4488ff",emissive:this.random()>.8?"#ffff88":"#4488ff",emissiveIntensity:this.random()>.8?.3:.1,transparent:!0,opacity:.8}),e.setAttribute("position",`${i} ${s} ${o/2+.01}`),t.appendChild(e);const a=e.cloneNode(!0);a.setAttribute("position",`${i} ${s} ${-o/2-.01}`),a.setAttribute("rotation","0 180 0"),t.appendChild(a)}for(let s=3;s<i-3;s+=3)for(let i=-o/2+3;i<o/2-3;i+=3){const o=document.createElement("a-plane");o.setAttribute("geometry",{width:n,height:n}),o.setAttribute("material",{color:this.random()>.8?"#ffff88":"#4488ff",emissive:this.random()>.8?"#ffff88":"#4488ff",emissiveIntensity:this.random()>.8?.3:.1,transparent:!0,opacity:.8}),o.setAttribute("position",`${e/2+.01} ${s} ${i}`),o.setAttribute("rotation","0 90 0"),t.appendChild(o);const a=o.cloneNode(!0);a.setAttribute("position",`${-e/2-.01} ${s} ${i}`),a.setAttribute("rotation","0 -90 0"),t.appendChild(a)}},addRoof:function(t,e,i,o){const n=document.createElement("a-box");n.setAttribute("geometry",{width:e+1,height:2,depth:o+1}),n.setAttribute("material",{color:"#444444",roughness:.9,metalness:.1}),n.setAttribute("position",`0 ${i+1} 0`),t.appendChild(n)},addRooftopEquipment:function(t,e,i,o){const n=1+Math.floor(3*this.random());for(let s=0;s<n;s++){const n=document.createElement("a-cylinder");n.setAttribute("geometry",{radius:.5+1*this.random(),height:2+4*this.random()}),n.setAttribute("material",{color:"#333333",metalness:.8,roughness:.2});const s=(this.random()-.5)*e*.6,a=(this.random()-.5)*o*.6;n.setAttribute("position",`${s} ${i+3} ${a}`),t.appendChild(n)}},isOnStreet:function(t,e){const i=this.data.streetWidth;for(let e=-this.data.citySize;e<=this.data.citySize;e+=40)if(Math.abs(t-e)<i)return!0;for(let t=-this.data.citySize;t<=this.data.citySize;t+=50)if(Math.abs(e-t)<i)return!0;return!1},generateObstacles:function(){console.log("üöß Gerando obst√°culos...");const t=document.createElement("a-entity");t.setAttribute("id","obstacles");const e=this.data.vrOptimized?Math.min(this.data.obstacleCount,5):this.data.obstacleCount;for(let i=0;i<e;i++){const e=this.createObstacle(),i=(this.random()-.5)*this.data.citySize*1.5,o=(this.random()-.5)*this.data.citySize*1.5;e.setAttribute("position",`${i} 0 ${o}`),t.appendChild(e)}this.urbanContainer.appendChild(t)},createObstacle:function(){if(this.data.vrOptimized){const t=document.createElement("a-entity");t.setAttribute("class","obstacle");const e=document.createElement("a-box");return e.setAttribute("geometry",{width:1,height:2,depth:1}),e.setAttribute("material",{color:"#666666"}),t.appendChild(e),t}{const t=["tower","crane","billboard","antenna"];switch(t[Math.floor(this.random()*t.length)]){case"tower":default:return this.createTower();case"crane":return this.createCrane();case"billboard":return this.createBillboard();case"antenna":return this.createAntenna()}}},createTower:function(){const t=document.createElement("a-entity");t.classList.add("tower");const e=30+50*this.random(),i=document.createElement("a-cylinder");i.setAttribute("geometry",{radius:2,height:5}),i.setAttribute("material",{color:"#666666",metalness:.8,roughness:.2}),i.setAttribute("position","0 2.5 0"),t.appendChild(i);const o=document.createElement("a-cylinder");o.setAttribute("geometry",{radius:.5,height:e}),o.setAttribute("material",{color:"#ff4444",metalness:.7,roughness:.3}),o.setAttribute("position",`0 ${e/2+5} 0`),t.appendChild(o);for(let i=0;i<3;i++){const o=document.createElement("a-sphere");o.setAttribute("geometry",{radius:.3}),o.setAttribute("material",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:.5}),o.setAttribute("position",`0 ${.3*e+i*e*.3} 0`),o.setAttribute("animation",{property:"material.emissiveIntensity",from:.5,to:1,dur:1e3,dir:"alternate",loop:!0}),t.appendChild(o)}return t},createCrane:function(){const t=document.createElement("a-entity");t.classList.add("crane");const e=40+30*this.random(),i=document.createElement("a-box");i.setAttribute("geometry",{width:4,height:3,depth:4}),i.setAttribute("material",{color:"#ffff00",metalness:.6,roughness:.4}),i.setAttribute("position","0 1.5 0"),t.appendChild(i);const o=document.createElement("a-cylinder");o.setAttribute("geometry",{radius:.8,height:e}),o.setAttribute("material",{color:"#ffff00",metalness:.6,roughness:.4}),o.setAttribute("position",`0 ${e/2+3} 0`),t.appendChild(o);const n=document.createElement("a-box");return n.setAttribute("geometry",{width:25,height:1,depth:1}),n.setAttribute("material",{color:"#ffff00",metalness:.6,roughness:.4}),n.setAttribute("position",`12.5 ${e+3} 0`),t.appendChild(n),t},createBillboard:function(){const t=document.createElement("a-entity");t.classList.add("billboard");const e=document.createElement("a-cylinder");e.setAttribute("geometry",{radius:.3,height:15}),e.setAttribute("material",{color:"#333333",metalness:.8,roughness:.2}),e.setAttribute("position","0 7.5 0"),t.appendChild(e);const i=document.createElement("a-plane");i.setAttribute("geometry",{width:12,height:6}),i.setAttribute("material",{color:"#ffffff",emissive:"#4488ff",emissiveIntensity:.2}),i.setAttribute("position","0 18 0"),t.appendChild(i);const o=document.createElement("a-text");return o.setAttribute("value","DRONE RACING"),o.setAttribute("position","0 18 0.01"),o.setAttribute("color","#000000"),o.setAttribute("scale","8 8 8"),o.setAttribute("align","center"),t.appendChild(o),t},createAntenna:function(){const t=document.createElement("a-entity");t.classList.add("antenna");const e=20+25*this.random(),i=document.createElement("a-cylinder");i.setAttribute("geometry",{radius:1.5,height:3}),i.setAttribute("material",{color:"#888888",metalness:.7,roughness:.3}),i.setAttribute("position","0 1.5 0"),t.appendChild(i);const o=document.createElement("a-cylinder");o.setAttribute("geometry",{radius:.2,height:e}),o.setAttribute("material",{color:"#cccccc",metalness:.9,roughness:.1}),o.setAttribute("position",`0 ${e/2+3} 0`),t.appendChild(o);for(let i=0;i<2;i++){const o=document.createElement("a-cylinder");o.setAttribute("geometry",{radius:2,height:.2}),o.setAttribute("material",{color:"#ffffff",metalness:.8,roughness:.2}),o.setAttribute("position",`0 ${.7*e+5*i} 2`),o.setAttribute("rotation","90 0 0"),t.appendChild(o)}return t},generateVegetation:function(){console.log("üå≥ Gerando vegeta√ß√£o...");const t=document.createElement("a-entity");t.setAttribute("id","vegetation");const e=this.data.vrOptimized?Math.min(this.data.treeCount,3):this.data.treeCount;for(let i=0;i<e;i++){const e=this.createTree(),i=(this.random()-.5)*this.data.citySize*1.5,o=(this.random()-.5)*this.data.citySize*1.5;e.setAttribute("position",`${i} 0 ${o}`),t.appendChild(e)}this.urbanContainer.appendChild(t)},createTree:function(){const t=document.createElement("a-entity");if(t.classList.add("tree"),this.data.vrOptimized){const e=document.createElement("a-cylinder");e.setAttribute("geometry",{radius:1,height:4}),e.setAttribute("material",{color:"#228B22"}),e.setAttribute("position","0 2 0"),t.appendChild(e)}else{const e=document.createElement("a-cylinder"),i=3+2*this.random();e.setAttribute("geometry",{radius:.3,height:i}),e.setAttribute("material",{color:"#8B4513"}),e.setAttribute("position",`0 ${i/2} 0`);const o=document.createElement("a-sphere"),n=2+1.5*this.random();o.setAttribute("geometry",{radius:n}),o.setAttribute("material",{color:"#228B22"}),o.setAttribute("position",`0 ${i+.7*n} 0`),t.appendChild(e),t.appendChild(o)}return t},generateLighting:function(){console.log("üí° Configurando ilumina√ß√£o urbana...");const t=document.createElement("a-entity");t.setAttribute("id","urban-lighting");for(let e=-this.data.citySize;e<=this.data.citySize;e+=20)for(let i=-this.data.citySize;i<=this.data.citySize;i+=25)if(this.isOnStreet(e,i)){const o=this.createStreetLight();o.setAttribute("position",`${e+4*(this.random()-.2)} 0 ${i+4*(this.random()-.2)}`),t.appendChild(o)}this.urbanContainer.appendChild(t)},createStreetLight:function(){const t=document.createElement("a-entity");t.classList.add("street-light");const e=document.createElement("a-cylinder");e.setAttribute("geometry",{radius:.2,height:8}),e.setAttribute("material",{color:"#333333",metalness:.8,roughness:.2}),e.setAttribute("position","0 4 0"),t.appendChild(e);const i=document.createElement("a-sphere");i.setAttribute("geometry",{radius:.8}),i.setAttribute("material",{color:"#ffff88",emissive:"#ffff88",emissiveIntensity:.3,transparent:!0,opacity:.8}),i.setAttribute("position","0 8.5 0"),t.appendChild(i);const o=document.createElement("a-light");return o.setAttribute("type","point"),o.setAttribute("color","#ffff88"),o.setAttribute("intensity",.5),o.setAttribute("distance",15),o.setAttribute("position","0 8.5 0"),t.appendChild(o),t},generateSkybox:function(){console.log("üåÜ Configurando skybox urbano...");const t=document.createElement("a-sky");t.setAttribute("color","#87CEEB"),this.el.sceneEl.appendChild(t);for(let t=0;t<10;t++){const t=document.createElement("a-sphere");t.setAttribute("geometry",{radius:20+30*this.random()}),t.setAttribute("material",{color:"#ffffff",transparent:!0,opacity:.6});const e=800*(this.random()-.5),i=100+50*this.random(),o=800*(this.random()-.5);t.setAttribute("position",`${e} ${i} ${o}`),t.setAttribute("animation",{property:"position",to:`${e+50} ${i} ${o}`,dur:6e4+3e4*this.random(),loop:!0}),this.el.sceneEl.appendChild(t)}}}),console.log("üì¶ M√≥dulo urban-environment.js carregado com sucesso!"),void 0===window.GAME_CONSTANTS&&(window.GAME_CONSTANTS={GRAVITY:-9.81,AIR_DENSITY:1.225,DRAG_COEFFICIENT:.47,DRONE_MASS:1.5,MAX_THRUST:18,MAX_ANGULAR_VELOCITY:5,DEADZONE:.1,SENSITIVITY:1,TARGET_FPS:90,MAX_PARTICLES:100,MASTER_VOLUME:.7,SFX_VOLUME:.5,IPD:.064,COMFORT_SETTINGS:{VIGNETTE:!0,SNAP_TURN:!1,TELEPORT:!1}},console.log("‚úÖ GAME_CONSTANTS definidas com sucesso!"));const MathUtils={degToRad:function(t){return t*(Math.PI/180)},radToDeg:function(t){return t*(180/Math.PI)},lerp:function(t,e,i){return t+(e-t)*Math.max(0,Math.min(1,i))},smoothStep:function(t,e,i){const o=Math.max(0,Math.min(1,(i-t)/(e-t)));return o*o*(3-2*o)},applyDeadzone:function(t,e=GAME_CONSTANTS.DEADZONE){const i=Math.abs(t);if(i<e)return 0;return Math.sign(t)*((i-e)/(1-e))},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},map:function(t,e,i,o,n){return(t-e)*(n-o)/(i-e)+o},distance3D:function(t,e){const i=t.x-e.x,o=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+o*o+n*n)},normalize3D:function(t){const e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0===e?{x:0,y:0,z:0}:{x:t.x/e,y:t.y/e,z:t.z/e}},dot3D:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},cross3D:function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},random:function(t,e){return Math.random()*(e-t)+t},randomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t}},PerformanceUtils={fpsMonitor:{frames:0,lastTime:0,fps:0,update:function(){this.frames++;const t=performance.now();return t-this.lastTime>=1e3&&(this.fps=Math.round(1e3*this.frames/(t-this.lastTime)),this.frames=0,this.lastTime=t),this.fps}},throttle:function(t,e){let i,o=0;return function(...n){const s=Date.now();s-o>e?(t.apply(this,n),o=s):(clearTimeout(i),i=setTimeout(()=>{t.apply(this,n),o=Date.now()},e-(s-o)))}},debounce:function(t,e){let i;return function(...o){clearTimeout(i),i=setTimeout(()=>t.apply(this,o),e)}},ObjectPool:function(t,e,i=10){this.createFn=t,this.resetFn=e,this.pool=[];for(let t=0;t<i;t++)this.pool.push(this.createFn());this.get=function(){return this.pool.length>0?this.pool.pop():this.createFn()},this.release=function(t){this.resetFn(t),this.pool.push(t)}}},AudioUtils={audioContext:null,init:function(){return this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext},createSyntheticSound:function(t,e,i="sine",o=.3){const n=this.init(),s=n.createOscillator(),a=n.createGain();return s.connect(a),a.connect(n.destination),s.frequency.setValueAtTime(t,n.currentTime),s.type=i,a.gain.setValueAtTime(o,n.currentTime),a.gain.exponentialRampToValueAtTime(.01,n.currentTime+e),s.start(n.currentTime),s.stop(n.currentTime+e),s},playDroneSound:function(t=.5){const e=MathUtils.lerp(100,400,t);return this.createSyntheticSound(e,.1,"sawtooth",.2)},playCheckpointSound:function(){const t=this.init(),e=t.createOscillator(),i=t.createGain();return e.connect(i),i.connect(t.destination),e.frequency.setValueAtTime(800,t.currentTime),e.frequency.exponentialRampToValueAtTime(1200,t.currentTime+.1),e.frequency.exponentialRampToValueAtTime(600,t.currentTime+.3),i.gain.setValueAtTime(.3,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.start(t.currentTime),e.stop(t.currentTime+.5),e}},VRUtils={isVRAvailable:function(){return"xr"in navigator&&"isSessionSupported"in navigator.xr},isInVR:function(){const t=document.querySelector("a-scene");return t&&t.is("vr-mode")},getVRControllers:function(){return{left:document.querySelector("#leftHand"),right:document.querySelector("#rightHand")}},triggerHaptic:function(t,e=.5,i=100){t&&t.components.haptics&&t.components.haptics.pulse(e,i)},getHeadsetPosition:function(){const t=document.querySelector("#camera");return t?t.getAttribute("position"):{x:0,y:0,z:0}},getHeadsetRotation:function(){const t=document.querySelector("#camera");return t?t.getAttribute("rotation"):{x:0,y:0,z:0}}},DebugUtils={log:function(t,e="info"){const i=`[${(new Date).toISOString().substr(11,12)}] [${e.toUpperCase()}]`;switch(e){case"error":console.error(i,t);break;case"warn":console.warn(i,t);break;case"debug":console.debug(i,t);break;default:console.log(i,t)}},showPerformanceInfo:function(){const t={fps:PerformanceUtils.fpsMonitor.fps,memory:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1048576)+" MB",total:Math.round(performance.memory.totalJSHeapSize/1048576)+" MB"}:"N/A",entities:document.querySelectorAll("a-entity").length,isVR:VRUtils.isInVR()};return console.table(t),t},createDebugPanel:function(){const t=document.createElement("a-entity");t.setAttribute("id","debug-panel"),t.setAttribute("position","2 2 -3");const e=document.createElement("a-plane");e.setAttribute("width","3"),e.setAttribute("height","2"),e.setAttribute("color","#000000"),e.setAttribute("opacity","0.7");const i=document.createElement("a-text");i.setAttribute("id","debug-text"),i.setAttribute("value","Debug Info"),i.setAttribute("color","#00ff00"),i.setAttribute("position","-1.4 0.8 0.01"),i.setAttribute("scale","0.5 0.5 0.5"),t.appendChild(e),t.appendChild(i);const o=document.querySelector("#camera");return o&&o.appendChild(t),t},updateDebugPanel:function(){const t=document.querySelector("#debug-text");if(!t)return;const e=this.showPerformanceInfo(),i=document.querySelector("#drone"),o=i?i.getAttribute("position"):{x:0,y:0,z:0},n=[`FPS: ${e.fps}`,`Entidades: ${e.entities}`,"VR: "+(e.isVR?"Sim":"N√£o"),`Drone: ${o.x.toFixed(1)}, ${o.y.toFixed(1)}, ${o.z.toFixed(1)}`,`Mem√≥ria: ${e.memory.used||"N/A"}`].join("\n");t.setAttribute("value",n)}},ValidationUtils={isValidNumber:function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)},isValidPosition:function(t){return t&&this.isValidNumber(t.x)&&this.isValidNumber(t.y)&&this.isValidNumber(t.z)},sanitizeInput:function(t,e="string"){switch(e){case"number":const e=parseFloat(t);return this.isValidNumber(e)?e:0;case"string":return String(t).trim();case"boolean":return Boolean(t);default:return t}}};window.GameUtils={CONSTANTS:GAME_CONSTANTS,Math:MathUtils,Performance:PerformanceUtils,Audio:AudioUtils,VR:VRUtils,Debug:DebugUtils,Validation:ValidationUtils},document.addEventListener("DOMContentLoaded",function(){console.log("üîß Utilit√°rios do jogo carregados!"),AudioUtils.init(),setInterval(()=>{PerformanceUtils.fpsMonitor.update()},100);"true"===new URLSearchParams(window.location.search).get("debug")&&(console.log("üêõ Modo debug ativado!"),setTimeout(()=>{DebugUtils.createDebugPanel(),setInterval(()=>{DebugUtils.updateDebugPanel()},1e3)},2e3),document.addEventListener("keydown",function(t){if(t.ctrlKey)switch(t.key){case"p":DebugUtils.showPerformanceInfo(),t.preventDefault();break;case"r":location.reload(!0),t.preventDefault()}}))}),console.log("üì¶ M√≥dulo utils.js carregado com sucesso!");