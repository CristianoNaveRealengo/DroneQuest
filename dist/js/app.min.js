AFRAME.registerComponent("audio-system",{schema:{masterVolume:{type:"number",default:.7},musicVolume:{type:"number",default:.4},sfxVolume:{type:"number",default:.8},ambientVolume:{type:"number",default:.3},enableAudio:{type:"boolean",default:!0},enable3D:{type:"boolean",default:!0}},init:function(){console.log("üéµ Inicializando sistema de √°udio..."),this.audioContext=null,this.audioSources={},this.audioBuffers={},this.currentMusic=null,this.ambientSounds=[],this.isInitialized=!1,this.isMuted=!1,this.setupAudioSystem(),this.createAudioSources(),this.setupEventListeners(),console.log("‚úÖ Sistema de √°udio inicializado!"),console.log("üîä √Åudio iniciado ativo - Pressione M para mutar"),this.showAudioActiveIndicator()},setupAudioSystem:function(){if(this.data.enableAudio)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.musicGain=this.audioContext.createGain(),this.sfxGain=this.audioContext.createGain(),this.ambientGain=this.audioContext.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain.connect(this.masterGain),this.ambientGain.connect(this.masterGain),this.masterGain.connect(this.audioContext.destination),this.updateVolumes(),this.isInitialized=!0,console.log("üéõÔ∏è Contexto de √°udio configurado"),this.isMuted&&(this.isMuted=!1,console.log("üîä For√ßando √°udio ativo na inicializa√ß√£o"),this.updateVolumes())}catch(t){console.warn("‚ö†Ô∏è Erro ao inicializar contexto de √°udio:",t)}else console.log("‚ÑπÔ∏è √Åudio desabilitado")},createAudioSources:function(){console.log("üéº Criando fontes de √°udio..."),this.createBackgroundMusic(),this.createDroneSounds(),this.createAmbientSounds(),this.createUISounds()},createBackgroundMusic:function(){this.backgroundMusic={isPlaying:!1,oscillators:[],gainNodes:[]},this.startBackgroundMusic()},startBackgroundMusic:function(){if(!this.isInitialized||this.backgroundMusic.isPlaying)return;console.log("üéµ Iniciando m√∫sica ambiente...");[[220,277,330],[196,247,294],[262,330,392],[233,294,349]].forEach((t,e)=>{setTimeout(()=>{this.playChord(t,4e3)},4e3*e)}),this.musicInterval=setInterval(()=>{this.startBackgroundMusic()},16e3),this.backgroundMusic.isPlaying=!0},playChord:function(t,e){if(!this.isInitialized)return;const i=[],o=[];t.forEach((t,a)=>{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.type="sine",s.frequency.setValueAtTime(t,this.audioContext.currentTime),n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(.1,this.audioContext.currentTime+.5),n.gain.setValueAtTime(.1,this.audioContext.currentTime+e/1e3-.5),n.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+e/1e3),s.connect(n),n.connect(this.musicGain),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+e/1e3),i.push(s),o.push(n)})},createDroneSounds:function(){console.log("üöÅ Configurando sons do drone..."),this.droneSounds={propellers:null,engine:null,boost:null,landing:null},this.createPropellerSound()},createPropellerSound:function(){if(!this.isInitialized)return;const t=2*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);for(let e=0;e<t;e++)i[e]=2*Math.random()-1;this.propellerBuffer=e},playPropellerSound:function(t=1){if(!this.isInitialized||!this.propellerBuffer)return;this.droneSounds.propellers&&this.droneSounds.propellers.source.stop();const e=this.audioContext.createBufferSource(),i=this.audioContext.createGain(),o=this.audioContext.createBiquadFilter();e.buffer=this.propellerBuffer,e.loop=!0,o.type="lowpass",o.frequency.setValueAtTime(800+400*t,this.audioContext.currentTime);const a=this.isMuted?0:.3*t;i.gain.setValueAtTime(a,this.audioContext.currentTime),e.connect(o),o.connect(i),i.connect(this.sfxGain),e.start(),this.droneSounds.propellers={source:e,gain:i,filter:o,intensity:t}},stopPropellerSound:function(){this.droneSounds.propellers&&(this.droneSounds.propellers.source.stop(),this.droneSounds.propellers=null)},createAmbientSounds:function(){console.log("üèôÔ∏è Configurando sons ambiente urbanos..."),this.ambientSounds=[],this.createWindSound(),this.createTrafficSound()},createWindSound:function(){if(!this.isInitialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.type="sawtooth",t.frequency.setValueAtTime(60,this.audioContext.currentTime),i.type="lowpass",i.frequency.setValueAtTime(200,this.audioContext.currentTime),i.Q.setValueAtTime(.5,this.audioContext.currentTime),e.gain.setValueAtTime(.1,this.audioContext.currentTime);const o=this.audioContext.createOscillator(),a=this.audioContext.createGain();o.type="sine",o.frequency.setValueAtTime(.1,this.audioContext.currentTime),a.gain.setValueAtTime(.05,this.audioContext.currentTime),o.connect(a),a.connect(e.gain),t.connect(i),i.connect(e),e.connect(this.ambientGain),t.start(),o.start(),this.ambientSounds.push({oscillator:t,gainNode:e,lfo:o})},createTrafficSound:function(){if(!this.isInitialized)return;const t=5*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);let o=0,a=0,s=0,n=0,r=0,l=0,h=0;for(let e=0;e<t;e++){const t=2*Math.random()-1;o=.99886*o+.0555179*t,a=.99332*a+.0750759*t,s=.969*s+.153852*t,n=.8665*n+.3104856*t,r=.55*r+.5329522*t,l=-.7616*l-.016898*t,i[e]=.11*(o+a+s+n+r+l+h+.5362*t),h=.115926*t}const d=this.audioContext.createBufferSource(),c=this.audioContext.createGain(),u=this.audioContext.createBiquadFilter();d.buffer=e,d.loop=!0,u.type="lowpass",u.frequency.setValueAtTime(300,this.audioContext.currentTime),c.gain.setValueAtTime(.05,this.audioContext.currentTime),d.connect(u),u.connect(c),c.connect(this.ambientGain),d.start(),this.ambientSounds.push({source:d,gainNode:c})},createUISounds:function(){console.log("üîä Configurando sons de interface..."),this.uiSounds={checkpoint:this.createBeepSound(800,.1,.2),finish:this.createBeepSound(1200,.3,.5),error:this.createBeepSound(300,.2,.3)}},createBeepSound:function(t,e,i){return()=>{if(!this.isInitialized)return;const o=this.audioContext.createOscillator(),a=this.audioContext.createGain();o.type="sine",o.frequency.setValueAtTime(t,this.audioContext.currentTime),a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.01),a.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+e),o.connect(a),a.connect(this.sfxGain),o.start(),o.stop(this.audioContext.currentTime+e)}},setupEventListeners:function(){this.el.addEventListener("checkpoint-reached",()=>{this.playCheckpointSound()}),this.el.addEventListener("race-finished",()=>{this.playFinishSound()}),this.el.addEventListener("drone-crash",()=>{this.playErrorSound()}),this.el.addEventListener("drone-throttle-change",t=>{this.updatePropellerSound(t.detail.intensity)}),this.setupUserInteractionHandler()},setupUserInteractionHandler:function(){const t=()=>{this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then(()=>{console.log("üîä Contexto de √°udio ativado pela intera√ß√£o do usu√°rio")})};["click","keydown","touchstart"].forEach(e=>{document.addEventListener(e,t,{once:!0})}),this.el.sceneEl.addEventListener("enter-vr",t,{once:!0})},playCheckpointSound:function(){this.uiSounds&&this.uiSounds.checkpoint&&this.uiSounds.checkpoint()},playFinishSound:function(){this.uiSounds&&this.uiSounds.finish&&this.uiSounds.finish()},playErrorSound:function(){this.uiSounds&&this.uiSounds.error&&this.uiSounds.error()},updatePropellerSound:function(t){t>.1?this.playPropellerSound(t):this.stopPropellerSound()},updateVolumes:function(){if(!this.isInitialized)return;console.log(`üîç Estado do √°udio: isMuted=${this.isMuted}, masterVolume=${this.data.masterVolume}`);const t=this.isMuted?0:this.data.masterVolume;console.log(`üéõÔ∏è Atualizando volumes - Master: ${t.toFixed(2)}, SFX: ${this.data.sfxVolume.toFixed(2)}, Muted: ${this.isMuted}`),this.masterGain.gain.setValueAtTime(t,this.audioContext.currentTime),this.musicGain.gain.setValueAtTime(this.data.musicVolume,this.audioContext.currentTime),this.sfxGain.gain.setValueAtTime(this.data.sfxVolume,this.audioContext.currentTime),this.ambientGain.gain.setValueAtTime(this.data.ambientVolume,this.audioContext.currentTime),this.updateDroneVolume()},toggleMute:function(){this.isMuted=!this.isMuted,this.updateVolumes(),console.log(this.isMuted?"üîá √Åudio mutado":"üîä √Åudio ativado"),this.updateDroneVolume(),this.isMuted?this.showMuteIndicator():this.hideMuteIndicator()},updateDroneVolume:function(){if(this.droneSounds.propellers){const t=this.droneSounds.propellers.intensity,e=this.isMuted?0:.3*t;console.log(`üöÅ Atualizando volume do drone - Intensidade: ${t.toFixed(2)}, Volume efetivo: ${e.toFixed(2)}`),this.droneSounds.propellers.gain.gain.setValueAtTime(e,this.audioContext.currentTime)}},showMuteIndicator:function(){this.hideMuteIndicator();const t=document.createElement("div");t.id="mute-indicator",t.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: rgba(255, 0, 0, 0.8);\n            color: white;\n            padding: 10px 15px;\n            border-radius: 5px;\n            font-family: Arial, sans-serif;\n            font-size: 14px;\n            font-weight: bold;\n            z-index: 1000;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.3);\n            animation: pulse 2s infinite;\n        ",t.innerHTML="üîá √ÅUDIO MUDO<br><small>Pressione M para ativar</small>";const e=document.createElement("style");e.textContent="\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n        ",document.head.appendChild(e),document.body.appendChild(t),this.muteIndicatorElement=t},hideMuteIndicator:function(){this.muteIndicatorElement&&this.muteIndicatorElement.parentNode&&(this.muteIndicatorElement.parentNode.removeChild(this.muteIndicatorElement),this.muteIndicatorElement=null)},showAudioActiveIndicator:function(){const t=document.createElement("div");t.style.cssText="\n\t\t\tposition: fixed;\n\t\t\ttop: 20px;\n\t\t\tright: 20px;\n\t\t\tbackground: rgba(0, 255, 0, 0.8);\n\t\t\tcolor: white;\n\t\t\tpadding: 10px 15px;\n\t\t\tborder-radius: 5px;\n\t\t\tfont-family: Arial, sans-serif;\n\t\t\tfont-size: 14px;\n\t\t\tfont-weight: bold;\n\t\t\tz-index: 1000;\n\t\t\tpointer-events: none;\n\t\t\tbox-shadow: 0 2px 10px rgba(0,0,0,0.3);\n\t\t",t.innerHTML="üîä √ÅUDIO ATIVO<br><small>Pressione M para mutar</small>",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)},setMasterVolume:function(t){this.data.masterVolume=Math.max(0,Math.min(1,t)),console.log(`üîä Master volume ajustado para: ${this.data.masterVolume.toFixed(2)}`),this.updateVolumes()},setMusicVolume:function(t){this.data.musicVolume=Math.max(0,Math.min(1,t)),this.updateVolumes()},setSFXVolume:function(t){this.data.sfxVolume=Math.max(0,Math.min(1,t)),this.updateVolumes()},setAmbientVolume:function(t){this.data.ambientVolume=Math.max(0,Math.min(1,t)),this.updateVolumes()},remove:function(){console.log("üßπ Limpando sistema de √°udio..."),this.musicInterval&&clearInterval(this.musicInterval),this.stopPropellerSound(),this.ambientSounds.forEach(t=>{t.oscillator&&t.oscillator.stop(),t.source&&t.source.stop(),t.lfo&&t.lfo.stop()}),this.hideMuteIndicator(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close()},createTone:function(t,e,i){if(this.isInitialized){i=i||.3;try{const o=this.audioContext.createOscillator(),a=this.audioContext.createGain();o.type="sine",o.frequency.setValueAtTime(t,this.audioContext.currentTime),a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.01),a.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+e/1e3),o.connect(a),a.connect(this.sfxGain),o.start(this.audioContext.currentTime),o.stop(this.audioContext.currentTime+e/1e3)}catch(t){console.warn("‚ö†Ô∏è Erro ao criar tom:",t)}}}}),window.AudioUtils={dbToGain:function(t){return Math.pow(10,t/20)},gainToDb:function(t){return 20*Math.log10(t)},smoothStep:function(t,e,i){const o=Math.max(0,Math.min(1,(i-t)/(e-t)));return o*o*(3-2*o)}},console.log("üì¶ M√≥dulo audio-system.js carregado com sucesso!"),AFRAME.components.checkpoint||AFRAME.registerComponent("checkpoint",{schema:{id:{type:"number",default:1},activated:{type:"boolean",default:!1},required:{type:"boolean",default:!0},points:{type:"number",default:100},timeBonus:{type:"number",default:5}},init:function(){console.log(`üéØ Inicializando checkpoint ${this.data.id}...`),this.isActivated=!1,this.glowEffect=null,this.particleSystem=null,this.proximityThreshold=4,this.activationRadius=2,this.lastDronePosition=null,this.hasEnteredZone=!1,this.setupCollisionDetection(),this.setupVisualEffects(),this.setupAudio(),console.log(`‚úÖ Checkpoint ${this.data.id} configurado!`)},setupCollisionDetection:function(){this.proximityCheck=setInterval(()=>{this.checkProximity()},100)},setupVisualEffects:function(){this.el.setAttribute("animation__pulse",{property:"scale",to:"1.1 1.1 1.1",dur:2e3,dir:"alternate",loop:!0,easing:"easeInOutSine"}),this.el.setAttribute("animation__rotate",{property:"rotation",to:"0 360 0",dur:6e3,loop:!0,easing:"linear"}),this.createParticleEffect()},createParticleEffect:function(){for(let t=0;t<8;t++){const e=document.createElement("a-sphere"),i=t/8*Math.PI*2,o=5;e.setAttribute("geometry",{radius:.1}),e.setAttribute("material",{color:"#00ff00",emissive:"#004400",transparent:!0,opacity:.6}),e.setAttribute("position",{x:Math.cos(i)*o,y:2*Math.sin(2*i),z:Math.sin(i)*o}),e.setAttribute("animation",{property:"position",to:`${Math.cos(i+Math.PI)*o} ${2*Math.sin(2*(i+Math.PI))} ${Math.sin(i+Math.PI)*o}`,dur:4e3,dir:"alternate",loop:!0,easing:"easeInOutSine"}),this.el.appendChild(e)}},setupAudio:function(){this.audioSystem=null},onCollision:function(t){const e=t.detail.target;e&&"drone"===e.id&&!this.isActivated&&this.activateCheckpoint()},checkProximity:function(){if(this.isActivated)return;const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=this.el.getAttribute("position"),o=this.calculateDistance(e,i);if(o<this.activationRadius){if(this.hasEnteredZone||(this.hasEnteredZone=!0,console.log(`üéØ Drone entrou na zona do checkpoint ${this.data.id}`)),this.lastDronePosition&&this.hasEnteredZone){this.checkPassageThrough(this.lastDronePosition,e,i)&&this.activateCheckpoint()}}else o>this.proximityThreshold&&(this.hasEnteredZone=!1);this.lastDronePosition={x:e.x,y:e.y,z:e.z},this.updateProximityEffect(o)},checkPassageThrough:function(t,e,i){this.calculateDistance(t,i);const o=this.calculateDistance(e,i),a=e.x-t.x,s=e.y-t.y,n=e.z-t.z;return Math.sqrt(a*a+s*s+n*n)>.5&&o<1.5},calculateDistance:function(t,e){const i=t.x-e.x,o=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+o*o+a*a)},updateProximityEffect:function(t){const e=Math.max(0,1-t/15);this.el.setAttribute("material",{emissiveIntensity:.5*e})},activateCheckpoint:function(){this.isActivated||(console.log(`üéØ Checkpoint ${this.data.id} ativado!`),this.isActivated=!0,this.data.activated=!0,this.proximityCheck&&clearInterval(this.proximityCheck),this.playActivationEffects(),this.playActivationSound(),this.addPoints(),this.notifyGameManager(),this.triggerHapticFeedback())},playActivationEffects:function(){this.el.setAttribute("material",{color:"#ffd700",emissive:"#ffaa00",emissiveIntensity:.8}),this.el.setAttribute("animation__activation",{property:"scale",from:"1 1 1",to:"1.5 1.5 1.5",dur:300,dir:"alternate",loop:2,easing:"easeOutElastic"}),this.createCelebrationParticles(),this.createFloatingText()},createCelebrationParticles:function(){const t=this.el.getAttribute("position");for(let e=0;e<20;e++){const e=document.createElement("a-sphere");e.setAttribute("geometry",{radius:.05}),e.setAttribute("material",{color:"#ffd700",emissive:"#ffaa00"});const i=10*(Math.random()-.5),o=8*Math.random()+2,a=10*(Math.random()-.5);e.setAttribute("position",{x:t.x,y:t.y,z:t.z}),e.setAttribute("animation",{property:"position",to:`${t.x+i} ${t.y+o} ${t.z+a}`,dur:2e3,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:2e3,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2100)}},createFloatingText:function(){const t=this.el.getAttribute("position"),e=document.createElement("a-text");e.setAttribute("value",`CHECKPOINT ${this.data.id}\n+${this.data.points} PONTOS`),e.setAttribute("color","#ffd700"),e.setAttribute("scale","4 4 4"),e.setAttribute("align","center"),e.setAttribute("position",{x:t.x,y:t.y+2,z:t.z}),e.setAttribute("animation__grow",{property:"scale",from:"0.1 0.1 0.1",to:"4 4 4",dur:500,easing:"easeOutBack"}),e.setAttribute("animation__move",{property:"position",to:`${t.x} ${t.y+6} ${t.z}`,dur:3e3,delay:500,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:2e3,delay:1500,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),this.createPointExplosion(t),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},4e3)},createPointExplosion:function(t){for(let e=0;e<8;e++){const i=document.createElement("a-text");i.setAttribute("value",`+${Math.floor(this.data.points/8)}`),i.setAttribute("color","#00ff00"),i.setAttribute("scale","2 2 2"),i.setAttribute("align","center");const o=e/8*Math.PI*2,a=3,s=t.x+Math.cos(o)*a,n=t.z+Math.sin(o)*a;i.setAttribute("position",{x:t.x,y:t.y+1,z:t.z}),i.setAttribute("animation",{property:"position",to:`${s} ${t.y+4} ${n}`,dur:1500,easing:"easeOutQuad"}),i.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:1500,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},1600)}},playActivationSound:function(){this.audioSystem||(this.audioSystem=this.el.sceneEl.components["audio-system"]),this.audioSystem&&this.audioSystem.createTone?this.audioSystem.createTone(800,300,.3):this.playSyntheticSound()},playSyntheticSound:function(){if("undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext){const t=new(AudioContext||webkitAudioContext),e=t.createOscillator(),i=t.createGain();e.connect(i),i.connect(t.destination),e.frequency.setValueAtTime(800,t.currentTime),e.frequency.exponentialRampToValueAtTime(1200,t.currentTime+.1),e.frequency.exponentialRampToValueAtTime(600,t.currentTime+.3),i.gain.setValueAtTime(.3,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.start(t.currentTime),e.stop(t.currentTime+.5)}},notifyGameManager:function(){this.el.sceneEl.emit("checkpoint-reached",{id:this.data.id,points:this.data.points,timeBonus:this.data.timeBonus,position:this.el.getAttribute("position")}),this.el.emit("checkpoint-reached",{id:this.data.id,points:this.data.points,timeBonus:this.data.timeBonus,position:this.el.getAttribute("position")})},triggerHapticFeedback:function(){const t=document.querySelector("#leftHand"),e=document.querySelector("#rightHand");t&&t.components.haptics&&t.components.haptics.pulse(.8,200),e&&e.components.haptics&&e.components.haptics.pulse(.8,200)},reset:function(){console.log(`üîÑ Resetando checkpoint ${this.data.id}...`),this.isActivated=!1,this.data.activated=!1,this.el.setAttribute("material",{color:"#00ff00",emissive:"#002200",emissiveIntensity:.3}),this.proximityCheck&&clearInterval(this.proximityCheck),this.proximityCheck=setInterval(()=>{this.checkProximity()},100)},remove:function(){this.proximityCheck&&clearInterval(this.proximityCheck)}}),AFRAME.components["finish-line"]||AFRAME.registerComponent("finish-line",{init:function(){console.log("üèÅ Configurando linha de chegada..."),this.proximityCheck=setInterval(()=>{this.checkFinishProximity()},100),this.el.setAttribute("animation",{property:"material.opacity",from:.7,to:.3,dur:1e3,dir:"alternate",loop:!0})},checkFinishProximity:function(){const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=this.el.getAttribute("position"),o=e.x-i.x,a=e.y-i.y,s=e.z-i.z;Math.sqrt(o*o+a*a+s*s)<5&&this.onFinish()},onFinish:function(){console.log("üèÅ Drone cruzou a linha de chegada!"),this.proximityCheck&&clearInterval(this.proximityCheck),this.el.sceneEl.emit("race-finished",{position:this.el.getAttribute("position"),time:Date.now()})},addPoints:function(){let t=this.data.points;const e=document.querySelector("[game-manager]");if(e&&e.components["game-manager"]){const i=e.components["game-manager"];i.addScore&&i.addScore(t),this.showPointsDisplay(t)}console.log(`üí∞ +${t} pontos pelo checkpoint ${this.data.id}!`)},showPointsDisplay:function(t){const e=document.createElement("a-text"),i=this.el.getAttribute("position");e.setAttribute("value",`+${t} pts`),e.setAttribute("position",{x:i.x,y:i.y+2,z:i.z}),e.setAttribute("align","center"),e.setAttribute("color","#00ff00"),e.setAttribute("scale","3 3 3"),e.setAttribute("animation",{property:"position",to:`${i.x} ${i.y+8} ${i.z}`,dur:2e3,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:2e3,delay:500,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2500)},reset:function(){console.log(`üîÑ Resetando checkpoint ${this.data.id}...`),this.isActivated=!1,this.data.activated=!1,this.el.setAttribute("material",{color:"#00ff00",emissive:"#004400",emissiveIntensity:.3}),this.el.removeAttribute("animation__activation"),this.proximityCheck&&clearInterval(this.proximityCheck),this.setupCollisionDetection(),console.log(`‚úÖ Checkpoint ${this.data.id} resetado!`)},remove:function(){this.proximityCheck&&clearInterval(this.proximityCheck)}}),console.log("üì¶ M√≥dulo checkpoint-system.js carregado com sucesso!"),AFRAME.components["collision-system"]||AFRAME.registerComponent("collision-system",{schema:{enabled:{type:"boolean",default:!0},bounceForce:{type:"number",default:.5},damageOnCollision:{type:"boolean",default:!1},showEffects:{type:"boolean",default:!0},soundEnabled:{type:"boolean",default:!0}},init:function(){console.log("üí• Inicializando sistema de colis√£o..."),this.isColliding=!1,this.lastCollisionTime=0,this.collisionCooldown=500,this.drone=null,this.droneController=null,this.setupCollisionDetection(),this.setupCollisionEffects(),console.log("‚úÖ Sistema de colis√£o configurado!"),setTimeout(()=>{this.activateCollisionDetection()},1e3)},activateCollisionDetection:function(){console.log("üí• Sistema de colis√£o ativado"),this.isActive=!0},setupCollisionDetection:function(){this.drone=document.querySelector("#drone"),this.drone&&(this.droneController=this.drone.components["drone-controller"]),this.collisionCheck=setInterval(()=>{this.checkCollisions()},50)},setupCollisionEffects:function(){this.setupCollisionSounds()},setupCollisionSounds:function(){this.createSyntheticSounds()},createSyntheticSounds:function(){console.log("üîä Sons de colis√£o configurados via Web Audio API")},checkCollisions:function(){if(!this.data.enabled||!this.drone)return;const t=this.drone.getAttribute("position");if(!t)return;const e=this.detectCollision(t);e&&this.handleSolidCollision(e,t)},detectCollision:function(t){const e=this.checkBuildingCollisions(t);if(e)return e;const i=this.checkObstacleCollisions(t);if(i)return i;const o=this.checkTreeCollisions(t);if(o)return o;const a=this.checkBoundaryCollisions(t);return a||null},checkBuildingCollisions:function(t){const e=document.querySelectorAll(".building");for(let i of e){const e=i.getAttribute("position"),o=i.getAttribute("geometry");if(this.isInsideBuilding(t,e,o))return{type:"building",object:i,position:e,geometry:o,normal:this.calculateBuildingNormal(t,e,o)}}return null},checkObstacleCollisions:function(t){const e=document.querySelectorAll(".tower, .crane, .billboard, .antenna");for(let i of e){const e=i.getAttribute("position"),o=this.calculateDistance(t,e);let a=3;if(i.classList.contains("tower")&&(a=2),i.classList.contains("crane")&&(a=4),i.classList.contains("billboard")&&(a=3),i.classList.contains("antenna")&&(a=1.5),o<a)return{type:"obstacle",object:i,position:e,radius:a,normal:this.calculateObstacleNormal(t,e)}}return null},checkTreeCollisions:function(t){const e=document.querySelectorAll(".tree");for(let i of e){const e=i.getAttribute("position"),o=2.5;if(this.calculateDistance(t,e)<o)return{type:"tree",object:i,position:e,radius:o,normal:this.calculateObstacleNormal(t,e)}}return null},checkBoundaryCollisions:function(t){return Math.abs(t.x)>200||Math.abs(t.z)>200?{type:"boundary",object:null,position:t,normal:this.calculateBoundaryNormal(t,200)}:t.y>100?{type:"ceiling",object:null,position:t,normal:{x:0,y:-1,z:0}}:t.y<.3?{type:"ground",object:null,position:t,normal:{x:0,y:1,z:0}}:null},isInsideBuilding:function(t,e,i){if(!i)return!1;const o=i.width||10,a=i.height||20,s=i.depth||10,n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y),l=Math.abs(t.z-e.z);return n<o/2&&r<a/2&&l<s/2},calculateDistance:function(t,e){const i=t.x-e.x,o=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+o*o+a*a)},calculateBuildingNormal:function(t,e,i){const o=i.width||10,a=i.height||20,s=i.depth||10,n=t.x-e.x,r=t.y-e.y,l=t.z-e.z,h=Math.abs(n)/(o/2),d=Math.abs(r)/(a/2),c=Math.abs(l)/(s/2);return h>d&&h>c?{x:n>0?1:-1,y:0,z:0}:d>c?{x:0,y:r>0?1:-1,z:0}:{x:0,y:0,z:l>0?1:-1}},calculateObstacleNormal:function(t,e){const i=t.x-e.x,o=t.z-e.z,a=Math.sqrt(i*i+o*o);return 0===a?{x:1,y:0,z:0}:{x:i/a,y:0,z:o/a}},calculateBoundaryNormal:function(t,e){return Math.abs(t.x)>e?{x:t.x>0?-1:1,y:0,z:0}:Math.abs(t.z)>e?{x:0,y:0,z:t.z>0?-1:1}:{x:0,y:0,z:0}},handleSolidCollision:function(t,e){const i=Date.now();i-this.lastCollisionTime<100||(console.log(`üí• Colis√£o s√≥lida detectada: ${t.type}`),this.isColliding=!0,this.lastCollisionTime=i,this.repositionDrone(t,e),this.applySolidBounce(t),this.data.showEffects&&this.createCollisionEffect(e,t.type),this.data.soundEnabled&&this.playCollisionSound(t.type),this.notifyCollision(t.type,t.object),setTimeout(()=>{this.isColliding=!1},200))},repositionDrone:function(t,e){if(!this.droneController)return;const i=t.normal,o={x:e.x+1.5*i.x,y:e.y+1.5*i.y,z:e.z+1.5*i.z};this.drone.setAttribute("position",o),console.log(`üîÑ Drone reposicionado para: ${o.x.toFixed(2)}, ${o.y.toFixed(2)}, ${o.z.toFixed(2)}`)},applySolidBounce:function(t){if(!this.droneController||!this.droneController.velocity)return;const e=this.droneController.velocity,i=t.normal,o=1.5*this.data.bounceForce,a=e.x*i.x+e.y*i.y+e.z*i.z;e.x-=2*a*i.x*o,e.y-=2*a*i.y*o,e.z-=2*a*i.z*o,e.x*=.7,e.y*=.7,e.z*=.7;const s=.1;Math.abs(e.x)<s&&Math.abs(e.y)<s&&Math.abs(e.z)<s&&(e.x=i.x*s,e.y=i.y*s,e.z=i.z*s),console.log(`‚ö° Ricochete aplicado: vx=${e.x.toFixed(2)}, vy=${e.y.toFixed(2)}, vz=${e.z.toFixed(2)}`)},handleCollision:function(t,e,i){const o={type:t,object:e,position:i,normal:{x:0,y:1,z:0}};this.handleSolidCollision(o,i)},applyBounceEffect:function(t,e){if(!this.droneController)return;const i=this.data.bounceForce;let o={x:0,y:0,z:0};switch(t){case"building":case"obstacle":const t=this.droneController.velocity||{x:0,y:0,z:0};o.x=-t.x*i,o.y=Math.abs(t.y)*i,o.z=-t.z*i;break;case"boundary":o.x=e.x>0?2*-i:2*i,o.z=e.z>0?2*-i:2*i;break;case"ceiling":o.y=3*-i;break;case"ground":o.y=3*i}this.droneController.velocity&&(this.droneController.velocity.x+=o.x,this.droneController.velocity.y+=o.y,this.droneController.velocity.z+=o.z)},createCollisionEffect:function(t,e){const i="building"===e?15:8,o=this.getCollisionColor(e);for(let e=0;e<i;e++){const e=document.createElement("a-sphere");e.setAttribute("geometry",{radius:.05+.1*Math.random()}),e.setAttribute("material",{color:o,emissive:o,emissiveIntensity:.8});const i=4*(Math.random()-.5),a=3*Math.random(),s=4*(Math.random()-.5);e.setAttribute("position",{x:t.x,y:t.y,z:t.z}),e.setAttribute("animation",{property:"position",to:`${t.x+i} ${t.y+a} ${t.z+s}`,dur:1e3,easing:"easeOutQuad"}),e.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:1e3,easing:"easeOutQuad"}),this.el.sceneEl.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1100)}this.createScreenFlash(e)},getCollisionColor:function(t){switch(t){case"building":return"#ff6600";case"obstacle":return"#ff3300";case"boundary":return"#ffff00";case"ceiling":return"#00ffff";case"ground":return"#ff0066";default:return"#ffffff"}},createScreenFlash:function(t){const e=document.createElement("a-plane"),i=document.querySelector("[camera]");i&&(e.setAttribute("geometry",{width:10,height:10}),e.setAttribute("material",{color:this.getCollisionColor(t),transparent:!0,opacity:.3}),e.setAttribute("position","0 0 -2"),i.appendChild(e),e.setAttribute("animation",{property:"material.opacity",from:.3,to:0,dur:200,easing:"easeOutQuad"}),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},250))},playCollisionSound:function(t){if(this.data.soundEnabled)try{const e=this.el.sceneEl.systems["audio-system"];if(e&&e.isInitialized){"building"===t||"obstacle"===t?e.createTone(150,200,.3):e.createTone(400,100,.2)}}catch(t){console.warn("‚ö†Ô∏è Erro ao tocar som de colis√£o:",t)}},notifyCollision:function(t,e){this.el.sceneEl.emit("drone-collision",{type:t,object:e,timestamp:Date.now()});const i=document.querySelector("[game-manager]");i&&i.components["game-manager"]&&i.components["game-manager"].onCollision(t,e)},remove:function(){this.collisionCheck&&clearInterval(this.collisionCheck)}}),console.log("üì¶ M√≥dulo collision-system.js carregado com sucesso!"),AFRAME.components["drone-controller"]||AFRAME.registerComponent("drone-controller",{schema:{maxSpeed:{type:"number",default:8.3},acceleration:{type:"number",default:4},rotationSpeed:{type:"number",default:.6},mass:{type:"number",default:.5},drag:{type:"number",default:.95},angularDrag:{type:"number",default:.92},stabilization:{type:"number",default:.25},autoLevel:{type:"boolean",default:!0},minAltitude:{type:"number",default:.5},targetAltitude:{type:"number",default:.5},altitudeStabilization:{type:"boolean",default:!0},altitudeStabilizationForce:{type:"number",default:1},groundStabilization:{type:"boolean",default:!0},groundDetectionHeight:{type:"number",default:.6},stabilizationLift:{type:"number",default:2},stabilizationSmoothing:{type:"number",default:.5},deadzone:{type:"number",default:.1},sensitivity:{type:"number",default:1},hoverThrust:{type:"number",default:6},hoverStability:{type:"number",default:.4},windResistance:{type:"number",default:.02}},init:function(){console.log("üöÅ Inicializando controlador do drone..."),this.velocity=new THREE.Vector3,this.angularVelocity=new THREE.Vector3,this.targetRotation=new THREE.Euler,this.isActive=!1,this.isFlying=!1,this.currentSpeed=0,this.batteryLevel=100,this.isLanding=!1,this.isLanded=!1,this.landingSpeed=2,this.landingHeight=.5,this.cinematicMode={enabled:!0,speedMultiplier:.4,rotationMultiplier:.4,smoothingFactor:.8,lastToggleTime:0,activationDelay:500,stabilizationTolerance:.1},this.fpvMode={enabled:!1,maxSpeed:27.8,speedMultiplier:1,rotationMultiplier:2,smoothingFactor:.2,bankingEnabled:!0,maxBankAngle:45,stabilizationDisabled:!0,acceleration:8,agility:1.5,responsiveness:.1},this.thrustPower=0,this.targetThrust=0,this.hoverHeight=3,this.isHovering=!1,this.isGrounded=!1,this.lastGroundCheck=0,this.stabilizationActive=!1,this.stabilizationStartTime=0,this.autoStabilizationActive=!0,this.stabilizationTolerance=.1,this.lastStabilizationCheck=0,this.lastToleranceChangeLog=0,this.wasManuallyControllingAltitude=!1,this.altitudeThreshold=20,this.lowAltitudeMinThrust=.4,this.lowAltitudeMaxThrust=1.23,this.normalThrust=.6,this.isInLowAltitudeMode=!1,this.lastAltitudeCheck=0,setTimeout(()=>{console.log("üöÅ Ativando drone automaticamente..."),this.activateDrone(),setTimeout(()=>{this.isFlying||(console.log("üöÅ For√ßando ativa√ß√£o do voo..."),this.isFlying=!0,this.isActive=!0)},500)},1e3),setTimeout(()=>{this.initPropellerAnimations()},100),this.leftController=null,this.rightController=null,this.leftStick={x:0,y:0},this.rightStick={x:0,y:0},this.leftTriggerPressed=!1,this.rightTriggerPressed=!1,this.VR_SIMULATOR={leftStick:{x:0,y:0},rightStick:{x:0,y:0},leftTrigger:!1,rightTrigger:!1},this.targetForwardSpeed=0,this.targetStrafeSpeed=0,this.targetAltitudeChange=0,this.targetYawRotation=0,this.targetPitchRotation=0,this.flightSimulation={enabled:!0,naturalHover:!0,oscillationAmplitude:.08,oscillationSpeed:.0012,baseAltitude:3,lastOscillationUpdate:0,stabilizationStrength:.15,windEffect:!0,windStrength:.03,windSpeed:5e-4,microAdjustments:!0,microAmplitude:.02,microSpeed:.003},this.keys={},this.setupKeyboardControls(),this.el.sceneEl.addEventListener("loaded",()=>{this.setupVRControls()}),this.setupPhysics(),this.setupVisualEffects(),this.setupAudioSystem(),this.stabilizeInitialPosition(),console.log("‚úÖ Controlador do drone inicializado com sucesso!"),console.log(`üéØ Estabiliza√ß√£o autom√°tica: ${this.autoStabilizationActive?"ATIVA":"INATIVA"} por padr√£o (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm - oscila√ß√µes naturais)`),console.log(`üî∫ Sistema de altitude: Empuxo aumentado abaixo de ${this.altitudeThreshold}m`),console.log(`‚ö° Empuxo baixa altitude: ${100*this.lowAltitudeMinThrust}% - ${100*this.lowAltitudeMaxThrust}%`),console.log(`‚ö° Empuxo normal: ${100*this.normalThrust}% (acima de ${this.altitudeThreshold}m)`)},setupVRControls:function(){console.log("üéÆ Configurando controles VR...");const t=this;setTimeout(function(){t.leftController=document.querySelector("#leftHand"),t.rightController=document.querySelector("#rightHand"),t.leftController&&(console.log("üîç Debug: Verificando fun√ß√µes do controle esquerdo..."),console.log("onLeftStickMove:",typeof t.onLeftStickMove,t.onLeftStickMove),console.log("onLeftTriggerDown:",typeof t.onLeftTriggerDown,t.onLeftTriggerDown),console.log("onLeftTriggerUp:",typeof t.onLeftTriggerUp,t.onLeftTriggerUp),console.log("onLeftGripDown:",typeof t.onLeftGripDown,t.onLeftGripDown),console.log("onLeftGripUp:",typeof t.onLeftGripUp,t.onLeftGripUp),"function"==typeof t.onLeftStickMove?t.leftController.addEventListener("thumbstickmoved",t.onLeftStickMove.bind(t)):console.warn("‚ö†Ô∏è onLeftStickMove n√£o √© uma fun√ß√£o:",typeof t.onLeftStickMove),"function"==typeof t.onLeftTriggerDown?t.leftController.addEventListener("triggerdown",t.onLeftTriggerDown.bind(t)):console.warn("‚ö†Ô∏è onLeftTriggerDown n√£o √© uma fun√ß√£o:",typeof t.onLeftTriggerDown),"function"==typeof t.onLeftTriggerUp?t.leftController.addEventListener("triggerup",t.onLeftTriggerUp.bind(t)):console.warn("‚ö†Ô∏è onLeftTriggerUp n√£o √© uma fun√ß√£o:",typeof t.onLeftTriggerUp),"function"==typeof t.onLeftGripDown?t.leftController.addEventListener("gripdown",t.onLeftGripDown.bind(t)):console.warn("‚ö†Ô∏è onLeftGripDown n√£o √© uma fun√ß√£o:",typeof t.onLeftGripDown),"function"==typeof t.onLeftGripUp?t.leftController.addEventListener("gripup",t.onLeftGripUp.bind(t)):console.warn("‚ö†Ô∏è onLeftGripUp n√£o √© uma fun√ß√£o:",typeof t.onLeftGripUp),console.log("‚úÖ Controle esquerdo configurado")),t.rightController&&("function"==typeof t.onRightStickMove&&t.rightController.addEventListener("thumbstickmoved",t.onRightStickMove.bind(t)),"function"==typeof t.onRightTriggerDown&&t.rightController.addEventListener("triggerdown",t.onRightTriggerDown.bind(t)),"function"==typeof t.onRightTriggerUp&&t.rightController.addEventListener("triggerup",t.onRightTriggerUp.bind(t)),"function"==typeof t.onRightButtonDown&&t.rightController.addEventListener("buttondown",t.onRightButtonDown.bind(t)),console.log("‚úÖ Controle direito configurado")),t.leftController||t.rightController||console.log("‚ÑπÔ∏è Controladores VR n√£o encontrados, usando apenas teclado")},1e3)},setupKeyboardControls:function(){window.addEventListener("keydown",t=>{this.keys[t.code]=!0,this.handleKeyboardSpecialActions(t.code,!0)}),window.addEventListener("keyup",t=>{this.keys[t.code]=!1,this.handleKeyboardSpecialActions(t.code,!1)}),this.showKeyboardHelp()},showKeyboardHelp:function(){const t=document.createElement("div");t.id="keyboard-help",t.style.cssText="\n            position: fixed;\n            bottom: 10px;\n            left: 10px;\n            background: rgba(0, 0, 0, 0.8);\n            color: #ffffff;\n            padding: 10px;\n            border-radius: 5px;\n            font-family: Arial, sans-serif;\n            font-size: 12px;\n            z-index: 1000;\n            max-width: 300px;\n        ",t.innerHTML='\n            <div style="font-weight: bold; margin-bottom: 5px;">üéÆ Controles:</div>\n            <div style="color: #ffff00; font-weight: bold; margin-bottom: 3px;">‚å®Ô∏è Controles Principais:</div>\n            <div>WASD - Altitude e giro (W=subir, S=descer, A=giro esq, D=giro dir)</div>\n            <div>‚Üë‚Üì‚Üê‚Üí - Movimento (frente/tr√°s/esquerda/direita)</div>\n            <div style="color: #00ff00; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">ü•Ω VR Simulado (Alternativo):</div>\n            <div>Z/X - Descer/Subir (Alavanca Esquerda Y) ‚ö†Ô∏è INVERTIDO</div>\n            <div>Q/E - Giro esquerda/direita (Alavanca Esquerda X)</div>\n            <div>I/K - Frente/Tr√°s (Alavanca Direita Y)</div>\n            <div>J/L - Esquerda/Direita (Alavanca Direita X)</div>\n            <div style="color: #ff8800; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">üîß Comandos Gerais:</div>\n            <div>Space - Ligar/Desligar drone</div>\n            <div>Shift - Modo boost</div>\n            <div>R - Reset posi√ß√£o</div>\n            <div>T - Toggle auto-nivelamento</div>\n            <div>G - Toggle estabiliza√ß√£o de solo</div>\n            <div>F - Toggle estat√≠sticas</div>\n            <div>M - Mutar/Desmutar √°udio</div>\n            <div>+/- - Aumentar/Diminuir volume</div>\n            <div>1/2/3 - Qualidade baixa/m√©dia/alta</div>\n            <div>H - Redefinir altitude base (estabiliza√ß√£o ¬±8cm SEMPRE ativa)</div>\n            <div style="color: #ff8800; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">üé¨ Modos de Voo:</div>\n            <div>C - Alternar CINEMATOGR√ÅFICO ‚áÑ FPV/SPORT</div>\n            <div>‚Ä¢ üé¨ Cinematogr√°fico: 40% velocidade, ¬±8cm estabiliza√ß√£o SEMPRE</div>\n            <div>‚Ä¢ üöÅ FPV/Sport: 100km/h m√°x, drone FPV, ultra responsivo</div>\n            <div>Grip Esquerdo (VR) - Alternar modos de voo</div>\n            <div style="color: #00ff88; font-weight: bold; margin-top: 5px; margin-bottom: 3px;">üõ¨ Sistema de Pouso:</div>\n            <div>Y - Pousar/Decolar (teclado)</div>\n            <div>Bot√£o Y (VR) - Pousar/Decolar em superf√≠cies s√≥lidas</div>\n        ',document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.opacity="0.3")},1e4)},setQuality:function(t){const e=this.el.sceneEl;e.components["performance-monitor"]&&(e.components["performance-monitor"].setQuality(t),console.log(`üéÆ Qualidade definida para: ${t}`))},setNewBaseAltitude:function(){const t=this.el.getAttribute("position").y;this.flightSimulation.baseAltitude=t,this.hoverHeight=t,this.data.targetAltitude=t,console.log(`üéØ Nova altitude base definida: ${t.toFixed(2)}m (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm)`);const e=document.createElement("div");e.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(0, 120, 255, 0.9);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tz-index: 1000;\n\t\t\t\tpointer-events: none;\n\t\t\t",e.innerHTML=`üéØ NOVA ALTITUDE BASE<br>Altitude: ${t.toFixed(1)}m<br>üìè Toler√¢ncia: ¬±${(100*this.stabilizationTolerance).toFixed(0)}cm<br><small>Estabiliza√ß√£o sempre ativa</small>`,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},3e3)},toggleFlightMode:function(){const t=Date.now();t-this.cinematicMode.lastToggleTime<this.cinematicMode.activationDelay||(this.cinematicMode.enabled?(this.cinematicMode.enabled=!1,this.fpvMode.enabled=!0,this.stabilizationTolerance=999,this.autoStabilizationActive=!1,console.log("üèéÔ∏è Modo FPV/SPORT ativado - Controle manual total!")):(this.cinematicMode.enabled=!0,this.fpvMode.enabled=!1,this.stabilizationTolerance=.08,this.autoStabilizationActive=!0,console.log("üé¨ Modo CINEMATOGR√ÅFICO ativado - Estabilidade ¬±8cm!")),this.cinematicMode.lastToggleTime=t,this.showFlightModeIndicator())},toggleCinematicMode:function(){this.toggleFlightMode()},showFlightModeIndicator:function(){const t=document.createElement("div"),e=this.cinematicMode.enabled,i=this.fpvMode.enabled;t.style.cssText=`\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: ${e?"rgba(255, 140, 0, 0.95)":"rgba(255, 50, 50, 0.95)"};\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 25px;\n\t\t\t\tborder-radius: 15px;\n\t\t\t\tfont-size: 20px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t\tpointer-events: none;\n\t\t\t\ttext-align: center;\n\t\t\t\tbox-shadow: 0 4px 20px rgba(0,0,0,0.3);\n\t\t\t`,e?t.innerHTML=`\n\t\t\t\t\tüé¨ MODO CINEMATOGR√ÅFICO<br>\n\t\t\t\t\t<div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">\n\t\t\t\t\t\t‚Ä¢ Velocidade: ${Math.round(100*this.cinematicMode.speedMultiplier)}% (suave)<br>\n\t\t\t\t\t\t‚Ä¢ Estabiliza√ß√£o: ¬±${Math.round(100*this.stabilizationTolerance)}cm<br>\n\t\t\t\t\t\t‚Ä¢ Inclina√ß√£o: Suave nas curvas<br>\n\t\t\t\t\t\t‚Ä¢ Controles: Cinematogr√°ficos\n\t\t\t\t\t</div>\n\t\t\t\t`:i&&(t.innerHTML=`\n\t\t\t\t\tüöÅ MODO FPV/SPORT<br>\n\t\t\t\t\t<div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">\n\t\t\t\t\t\t‚Ä¢ Velocidade: ${Math.round(3.6*this.fpvMode.maxSpeed)}km/h (m√°xima)<br>\n\t\t\t\t\t\t‚Ä¢ F√≠sica: Drone FPV de alta performance<br>\n\t\t\t\t\t\t‚Ä¢ Acelera√ß√£o: ${this.fpvMode.acceleration}m/s¬≤ (2x mais r√°pida)<br>\n\t\t\t\t\t\t‚Ä¢ Inclina√ß√£o: At√© ${this.fpvMode.maxBankAngle}¬∞ nas curvas<br>\n\t\t\t\t\t\t‚Ä¢ Controles: Ultra responsivos\n\t\t\t\t\t</div>\n\t\t\t\t`),document.body.appendChild(t),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},4e3)},showCinematicModeIndicator:function(t){this.showFlightModeIndicator()},adjustMasterVolume:function(t){const e=this.el.sceneEl.components["audio-system"];if(e){const i=e.data.masterVolume,o=Math.max(0,Math.min(1,i+t));e.setMasterVolume(o),this.showVolumeIndicator(o)}},showVolumeIndicator:function(t){const e=Math.round(100*t),i=document.createElement("div");i.style.cssText="\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            font-size: 24px;\n            z-index: 1000;\n            pointer-events: none;\n        ",i.textContent=`üîä Volume: ${e}%`,document.body.appendChild(i),setTimeout(()=>{document.body.removeChild(i)},1500)},setupPhysics:function(){this.el.getAttribute("physics-body")&&this.el.setAttribute("physics-body",{type:"dynamic",mass:this.data.mass,linearDamping:.1,angularDamping:.1,shape:"box"})},setupVisualEffects:function(){this.propellers=[this.el.querySelector("#prop1"),this.el.querySelector("#prop2"),this.el.querySelector("#prop3"),this.el.querySelector("#prop4")],this.setupDroneLights()},setupDroneLights:function(){this.ledElements=this.el.querySelectorAll('[material*="emissive"]')},setupAudioSystem:function(){this.lastMovementIntensity=0,this.audioSystem=this.el.sceneEl.components["audio-system"]},setupMotorSound:function(){},stabilizeInitialPosition:function(){setTimeout(()=>{this.el.setAttribute("position",{x:0,y:0,z:0}),this.hoverHeight=0,this.flightSimulation.baseAltitude=0,this.data.targetAltitude=0,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.thrustPower=.6,this.targetThrust=.6,this.isHovering=!0,console.log(`üéØ Drone posicionado no CH√ÉO: ${this.hoverHeight.toFixed(2)}m - Modo CINEMATOGR√ÅFICO ativo por padr√£o (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm)`)},100)},updateAudioFeedback:function(t){const e=t.length();this.lastMovementIntensity=e;const i=this.el.sceneEl.components["audio-system"];i&&i.updatePropellerSound(e),this.el.sceneEl&&this.el.sceneEl.emit("drone-throttle-change",{intensity:e})},onLeftStickMove:function(t){const e=this.applyDeadzone(t.detail.x),i=this.applyDeadzone(t.detail.y);if(this.leftStick.x=e,this.leftStick.y=i,Math.abs(e)<.01&&Math.abs(i)<.01)return this.targetAltitudeChange=0,void(this.targetYawRotation=0);let o,a,s;this.cinematicMode.enabled?(o=this.cinematicMode.speedMultiplier,a=this.cinematicMode.rotationMultiplier,s=this.data.maxSpeed):this.fpvMode.enabled?(o=this.fpvMode.speedMultiplier,a=this.fpvMode.rotationMultiplier,s=this.fpvMode.maxSpeed):(o=1,a=1,s=this.data.maxSpeed),this.targetAltitudeChange=-i*s*1*o,this.targetYawRotation=-e*this.data.rotationSpeed*a;const n=this.cinematicMode.enabled?"üé¨":this.fpvMode.enabled?"üèéÔ∏è":"üöÅ",r=this.cinematicMode.enabled?"CINEMATOGR√ÅFICO":this.fpvMode.enabled?"FPV/SPORT":"NORMAL";console.log(`${n} Alavanca Esquerda (${r}): x=${e.toFixed(2)}, y=${i.toFixed(2)} | Altitude=${this.targetAltitudeChange.toFixed(2)}, Yaw=${this.targetYawRotation.toFixed(2)}`)},onRightStickMove:function(t){const e=this.applyDeadzone(t.detail.x),i=this.applyDeadzone(t.detail.y);if(this.rightStick.x=e,this.rightStick.y=i,Math.abs(e)<.01&&Math.abs(i)<.01)return this.targetForwardSpeed=0,void(this.targetStrafeSpeed=0);let o,a;this.cinematicMode.enabled?(o=this.cinematicMode.speedMultiplier,a=this.data.maxSpeed):this.fpvMode.enabled?(o=this.fpvMode.speedMultiplier,a=this.fpvMode.maxSpeed):(o=1,a=this.data.maxSpeed),this.targetForwardSpeed=-i*a*o,this.targetStrafeSpeed=e*a*o;const s=this.cinematicMode.enabled?"üé¨":this.fpvMode.enabled?"üèéÔ∏è":"üöÅ",n=this.cinematicMode.enabled?"CINEMATOGR√ÅFICO":this.fpvMode.enabled?"FPV/SPORT":"NORMAL";console.log(`${s} Alavanca Direita (${n}): x=${e.toFixed(2)}, y=${i.toFixed(2)} | Forward=${this.targetForwardSpeed.toFixed(2)}, Strafe=${this.targetStrafeSpeed.toFixed(2)}`)},onLeftTriggerDown:function(){this.leftTriggerPressed=!0,this.activateDrone(),console.log("üéÆ Trigger esquerdo pressionado")},onLeftTriggerUp:function(){this.leftTriggerPressed=!1,console.log("üéÆ Trigger esquerdo solto")},activateDrone:function(){if(this.isActive)console.log("üöÅ Drone desativado"),this.isActive=!1,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.el.emit("drone-deactivated");else{console.log("üöÅ Drone ativado"),this.isActive=!0,this.isFlying=!0,this.el.emit("drone-activated");const t=document.querySelector("[game-manager]");if(t&&t.components["game-manager"]){const e=t.components["game-manager"];e.gameState.isPlaying||e.startGame()}}},onLeftGripDown:function(){this.toggleFlightMode()},onLeftGripUp:function(){console.log("üéØ Grip esquerdo solto")},onRightTriggerDown:function(){this.rightTriggerPressed=!0,this.boostMode=!0,console.log("‚ö° Modo boost ativado!")},onRightTriggerUp:function(){this.rightTriggerPressed=!1,this.boostMode=!1,console.log("‚ö° Modo boost desativado")},onRightButtonDown:function(t){0===t.detail.id?this.resetDronePosition():1===t.detail.id?this.emergencyStop():3===t.detail.id&&this.toggleLandingMode()},handleKeyboardSpecialActions:function(t,e){if(e)switch(t){case"Space":this.isFlying=!this.isFlying,this.updatePropellerEffects(this.isFlying),console.log("üöÅ Drone "+(this.isFlying?"ativado":"desativado"));break;case"KeyT":this.data.autoLevel=!this.data.autoLevel,console.log("üéØ Auto-nivelamento: "+(this.data.autoLevel?"ON":"OFF"));break;case"KeyG":this.data.groundStabilization=!this.data.groundStabilization,console.log("üåç Estabiliza√ß√£o de solo: "+(this.data.groundStabilization?"ON":"OFF"));break;case"ShiftLeft":this.boostMode=!0,console.log("‚ö° Modo boost ativado!");break;case"KeyP":this.el.emit("toggle-pause");break;case"KeyF":const t=this.el.sceneEl;t.components["performance-monitor"]&&t.components["performance-monitor"].toggleStats();break;case"KeyM":const e=this.el.sceneEl.components["audio-system"];e&&e.toggleMute();break;case"Minus":case"NumpadSubtract":this.adjustMasterVolume(-.1);break;case"Equal":case"Plus":case"NumpadAdd":this.adjustMasterVolume(.1);break;case"Digit1":this.setQuality("low");break;case"Digit2":this.setQuality("medium");break;case"Digit3":this.setQuality("high");break;case"KeyH":this.setNewBaseAltitude();break;case"KeyC":this.toggleFlightMode();break;case"KeyY":this.toggleLandingMode();break;case"KeyZ":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.y=-.8,this.targetAltitudeChange=-.8*this.data.maxSpeed*1);break;case"KeyX":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.y=.8,this.targetAltitudeChange=.8*this.data.maxSpeed*1);break;case"KeyQ":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.x=-.8,this.targetYawRotation=.8*this.data.rotationSpeed);break;case"KeyE":this.VR_SIMULATOR&&(this.VR_SIMULATOR.leftStick.x=.8,this.targetYawRotation=-.8*this.data.rotationSpeed);break;case"KeyI":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.y=.8,this.targetForwardSpeed=.8*this.data.maxSpeed);break;case"KeyK":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.y=-.8,this.targetForwardSpeed=-.8*this.data.maxSpeed);break;case"KeyJ":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.x=-.8,this.targetStrafeSpeed=-.8*this.data.maxSpeed);break;case"KeyL":this.VR_SIMULATOR&&(this.VR_SIMULATOR.rightStick.x=.8,this.targetStrafeSpeed=.8*this.data.maxSpeed)}else if("ShiftLeft"===t&&(this.boostMode=!1,console.log("‚ö° Modo boost desativado")),this.VR_SIMULATOR)switch(t){case"KeyZ":case"KeyX":this.VR_SIMULATOR.leftStick.y=0,this.targetAltitudeChange=0;break;case"KeyQ":case"KeyE":this.VR_SIMULATOR.leftStick.x=0,this.targetYawRotation=0;break;case"KeyI":case"KeyK":this.VR_SIMULATOR.rightStick.y=0,this.targetForwardSpeed=0;break;case"KeyJ":case"KeyL":this.VR_SIMULATOR.rightStick.x=0,this.targetStrafeSpeed=0}},simulateRealisticFlight:function(t){if(!this.flightSimulation.enabled||!this.isActive||!this.isFlying)return;const e=this.hasKeyboardInput()||this.hasVRInput(),i=Math.abs(this.targetAltitudeChange)>.1;if(!e&&!i&&this.flightSimulation.naturalHover){const e=t,i=this.el.getAttribute("position"),o=e*this.flightSimulation.oscillationSpeed,a=Math.sin(o)*this.flightSimulation.oscillationAmplitude,s=1.3*o+.5,n=Math.sin(s)*(.3*this.flightSimulation.oscillationAmplitude);let r=0;if(this.flightSimulation.windEffect){const t=e*this.flightSimulation.windSpeed;r=Math.sin(t)*this.flightSimulation.windStrength+Math.sin(2.1*t+1.2)*(.5*this.flightSimulation.windStrength)}let l=0;if(this.flightSimulation.microAdjustments){const t=e*this.flightSimulation.microSpeed;l=Math.sin(t)*this.flightSimulation.microAmplitude+Math.sin(3.7*t+.8)*(.6*this.flightSimulation.microAmplitude)}let h=1;h=this.isInLowAltitudeMode?1.3:.8;const d=(a+n+r+l)*h,c=this.flightSimulation.baseAltitude+d,u=(c-i.y)*this.flightSimulation.stabilizationStrength,m=.06,p=Math.max(-m,Math.min(m,u));if(this.targetAltitudeChange+=p,e-(this.flightSimulation.lastOscillationUpdate||0)>4e3){const t=Math.abs(100*d);console.log(`üåä Voo natural: altitude=${i.y.toFixed(2)}m, alvo=${c.toFixed(2)}m, oscila√ß√£o=${t.toFixed(1)}cm, for√ßa=${p.toFixed(3)}`),this.flightSimulation.lastOscillationUpdate=e}}},checkAltitudeAndAdjustThrust:function(){const t=this.el.getAttribute("position").y,e=Date.now(),i=this.isInLowAltitudeMode;if(this.isInLowAltitudeMode=t<this.altitudeThreshold,i!==this.isInLowAltitudeMode&&e-this.lastAltitudeCheck>2e3&&(this.isInLowAltitudeMode?(console.log(`üî∫ ALTITUDE BAIXA DETECTADA: ${t.toFixed(2)}m < ${this.altitudeThreshold}m`),console.log(`‚ö° Empuxo aumentado: ${100*this.lowAltitudeMinThrust}% - ${100*this.lowAltitudeMaxThrust}%`),console.log("üìè Estabiliza√ß√£o ¬±8cm ATIVA")):(console.log(`üîª ALTITUDE NORMAL: ${t.toFixed(2)}m >= ${this.altitudeThreshold}m`),console.log(`‚ö° Empuxo normal: ${100*this.normalThrust}%`)),this.lastAltitudeCheck=e),this.isInLowAltitudeMode){const e=Math.max(0,Math.min(1,t/this.altitudeThreshold)),i=this.lowAltitudeMaxThrust-this.lowAltitudeMinThrust;this.targetThrust=this.lowAltitudeMaxThrust-e*i,this.targetThrust=Math.max(this.lowAltitudeMinThrust,Math.min(this.lowAltitudeMaxThrust,this.targetThrust))}else this.targetThrust=this.normalThrust;const o=this.targetThrust-this.thrustPower;this.thrustPower+=.1*o},tick:function(t,e){this.simulateRealisticFlight(t),this.checkAltitudeAndAdjustThrust(),this.isDroneStopped(),this.processLanding(e),this.isLanded||this.processControlInput(),this.applyMovement(e),this.applyRotation(e),this.applyRealisticPhysics(e),this.updateAdvancedPropellerEffects(),this.updateVisualEffects(),this.updateHUD()},processControlInput:function(){this.hasVRInput()||(this.targetForwardSpeed=0,this.targetStrafeSpeed=0,this.targetAltitudeChange=0,this.targetYawRotation=0),this.targetPitchRotation=0,this.processKeyboardInput(),this.boostMode&&(this.targetForwardSpeed*=1.5,this.targetStrafeSpeed*=1.5,this.targetAltitudeChange*=1.5)},hasVRInput:function(){const t=.05;return Math.abs(this.leftStick.x)>t||Math.abs(this.leftStick.y)>t||Math.abs(this.rightStick.x)>t||Math.abs(this.rightStick.y)>t},processKeyboardInput:function(){const t=this.data.maxSpeed*this.data.sensitivity;this.keys.KeyW&&(this.targetAltitudeChange=1*t),this.keys.KeyS&&(this.targetAltitudeChange=1*-t),this.keys.KeyA&&(this.targetYawRotation=this.data.rotationSpeed),this.keys.KeyD&&(this.targetYawRotation=-this.data.rotationSpeed),this.keys.ArrowUp&&(this.targetForwardSpeed=t),this.keys.ArrowDown&&(this.targetForwardSpeed=-t),this.keys.ArrowLeft&&(this.targetStrafeSpeed=-t),this.keys.ArrowRight&&(this.targetStrafeSpeed=t)},applyMovement:function(t){const e=this.el.getAttribute("position"),i=this.el.getAttribute("rotation"),o=new THREE.Quaternion;o.setFromEuler(new THREE.Euler(THREE.MathUtils.degToRad(i.x),THREE.MathUtils.degToRad(i.y),THREE.MathUtils.degToRad(i.z)));const a=new THREE.Vector3(0,0,-1).applyQuaternion(o),s=new THREE.Vector3(1,0,0).applyQuaternion(o),n=new THREE.Vector3(0,1,0),r=t/1e3;let l=this.data.acceleration*r;this.cinematicMode.enabled?l*=this.cinematicMode.smoothingFactor:this.fpvMode.enabled&&(l*=this.fpvMode.acceleration/this.data.acceleration,l*=this.fpvMode.responsiveness/this.cinematicMode.smoothingFactor),this.velocity.add(a.multiplyScalar(this.targetForwardSpeed*l)),this.velocity.add(s.multiplyScalar(this.targetStrafeSpeed*l));let h=this.targetAltitudeChange;if(this.autoStabilizationActive){const t=Math.abs(this.targetAltitudeChange)>.05;if(!t&&this.wasManuallyControllingAltitude&&(this.flightSimulation.baseAltitude=e.y,this.data.targetAltitude=e.y,this.hoverHeight=e.y,console.log(`üéØ Controle solto - Estabilizando na altitude atual: ${e.y.toFixed(2)}m (¬±${(100*this.stabilizationTolerance).toFixed(0)}cm - oscila√ß√µes naturais permitidas)`)),this.wasManuallyControllingAltitude=t,!t){const t=this.flightSimulation.baseAltitude||this.data.targetAltitude,i=t-e.y;if(Math.abs(i)>this.stabilizationTolerance){let o=.03;this.isInLowAltitudeMode&&(o=.05);const a=i*o;if(h+=a,Date.now()-(this.lastStabilizationCheck||0)>2e3){const s=this.isInLowAltitudeMode?"BAIXA ALTITUDE":"NORMAL";console.log(`üéØ Estabiliza√ß√£o ${s}: atual=${e.y.toFixed(2)}m, alvo=${t.toFixed(2)}m, diferen√ßa=${i.toFixed(2)}m, for√ßa=${a.toFixed(2)} (mult: ${o})`),this.lastStabilizationCheck=Date.now()}}}}else if(this.data.altitudeStabilization){if(!(Math.abs(this.targetAltitudeChange)>.15)&&!this.stabilizationActive){const t=this.flightSimulation.baseAltitude||this.data.targetAltitude,i=(t-e.y)*this.data.altitudeStabilizationForce*.1;h+=i,Date.now()-(this.lastAltitudeStabilizationLog||0)>4e3&&(console.log(`üìè Estabiliza√ß√£o altitude: atual=${e.y.toFixed(2)}m, alvo=${t.toFixed(2)}m, for√ßa=${i.toFixed(3)}`),this.lastAltitudeStabilizationLog=Date.now())}}this.velocity.add(n.multiplyScalar(h*l));if(!(Math.abs(this.targetAltitudeChange)>.05)){const t=this.isInLowAltitudeMode?.85:.9;this.velocity.y*=t;const e=this.isInLowAltitudeMode?1.5:2;this.velocity.y=Math.max(-e,Math.min(e,this.velocity.y))}this.velocity.length()>this.data.maxSpeed&&this.velocity.normalize().multiplyScalar(this.data.maxSpeed);const d={x:e.x+this.velocity.x*r,y:Math.max(this.data.minAltitude,e.y+this.velocity.y*r),z:e.z+this.velocity.z*r};d.y<=this.data.minAltitude&&this.velocity.y<0&&(this.velocity.y=0,d.y=this.data.minAltitude),this.el.setAttribute("position",d),this.updateAudioFeedback(this.velocity),this.currentSpeed=this.velocity.length()},applyRotation:function(t){const e=this.el.getAttribute("rotation");let i=t/1e3;this.cinematicMode.enabled&&(i*=this.cinematicMode.smoothingFactor),this.targetYawRotation?this.angularVelocity.y+=this.targetYawRotation*i:this.angularVelocity.y*=.85,this.targetPitchRotation&&(this.angularVelocity.x+=this.targetPitchRotation*i);let o=0;if(Math.abs(this.targetForwardSpeed)>.1){const t=this.fpvMode.enabled?this.fpvMode.maxSpeed:this.data.maxSpeed;o=-(Math.abs(this.targetForwardSpeed)/t)*(this.fpvMode.enabled?12:8)*Math.sign(this.targetForwardSpeed)}if(this.data.autoLevel){const t=o-e.x,a=this.fpvMode.enabled?3:2;this.angularVelocity.x+=t*a*i;const s=2;this.angularVelocity.x=Math.max(-s,Math.min(s,this.angularVelocity.x)),Math.abs(t)<1?this.angularVelocity.x*=.85:this.angularVelocity.x*=.92,this.angularVelocity.z=5*-e.z*i,this.angularVelocity.z=Math.max(-s,Math.min(s,this.angularVelocity.z)),this.angularVelocity.z*=.7}const a={x:e.x+THREE.MathUtils.radToDeg(this.angularVelocity.x*i),y:e.y+THREE.MathUtils.radToDeg(this.angularVelocity.y*i),z:e.z+THREE.MathUtils.radToDeg(this.angularVelocity.z*i)};this.el.setAttribute("rotation",a)},applyBankingEffect:function(t){if(!this.fpvMode.enabled||!this.fpvMode.bankingEnabled)return;const e=this.el.getAttribute("rotation");let i=0;if(0!==this.targetYawRotation||0!==this.targetStrafeSpeed){const t=Math.abs(this.targetYawRotation)/this.data.rotationSpeed,e=Math.abs(this.targetStrafeSpeed)/(this.fpvMode.enabled?this.fpvMode.maxSpeed:this.data.maxSpeed);i=Math.max(t,e)*(this.fpvMode.enabled?this.fpvMode.maxBankAngle:15),(this.targetYawRotation<0||this.targetStrafeSpeed<0)&&(i=-i)}const o=this.fpvMode.enabled?3:1.5,a=e.z,s=(i-a)*o*t,n={x:e.x,y:e.y,z:a+s};if(this.el.setAttribute("rotation",n),Math.abs(i)>1){const t=this.fpvMode.enabled?"üèéÔ∏è":"üé¨";console.log(`${t} Inclina√ß√£o: ${i.toFixed(1)}¬∞ (atual: ${a.toFixed(1)}¬∞)`)}},applyRealisticPhysics:function(t){const e=t/1e3,i=this.el.getAttribute("position");if(this.isFlying){const t=9.8*this.data.mass;if(Math.abs(this.targetAltitudeChange)<.1){this.isHovering=!0;const e=(this.flightSimulation.baseAltitude||this.hoverHeight)-i.y;let o=.3;this.autoStabilizationActive&&(o=Math.abs(e)>this.stabilizationTolerance?1.2:.6);const a=e*this.data.hoverStability*o;this.targetThrust=(t+a)/this.data.hoverThrust}else this.isHovering=!1,this.targetThrust=(t+this.targetAltitudeChange*this.data.mass)/this.data.hoverThrust;let o=1.5;if(this.autoStabilizationActive&&this.isHovering){const t=this.flightSimulation.baseAltitude||this.hoverHeight;o=Math.abs(t-i.y)>this.stabilizationTolerance?3:2}this.thrustPower+=(this.targetThrust-this.thrustPower)*o*e,this.isFlying&&this.isActive?this.isInLowAltitudeMode?this.thrustPower=Math.max(this.lowAltitudeMinThrust,Math.min(this.lowAltitudeMaxThrust,this.thrustPower)):this.thrustPower=Math.max(.5,Math.min(.7,this.thrustPower)):this.thrustPower=Math.max(0,Math.min(1.5,this.thrustPower));const a=this.thrustPower*this.data.hoverThrust;this.velocity.y+=(a-t)*e/this.data.mass,Math.abs(this.targetForwardSpeed)<.1&&Math.abs(this.targetStrafeSpeed)<.1&&(this.velocity.x*=Math.pow(this.data.windResistance,e),this.velocity.z*=Math.pow(this.data.windResistance,e))}else this.thrustPower=0,this.targetThrust=0,this.isHovering=!1,this.velocity.y-=9.8*e;this.velocity.multiplyScalar(Math.pow(this.data.drag,e)),this.angularVelocity.multiplyScalar(Math.pow(this.data.angularDrag,e));const o=this.el.getAttribute("position");this.isFlying&&!this.isHovering&&(this.hoverHeight=o.y)},applyDrag:function(){this.velocity.multiplyScalar(this.data.drag),this.angularVelocity.multiplyScalar(this.data.angularDrag)},applyDeadzone:function(t){return Math.abs(t)<this.data.deadzone?0:t},hasKeyboardInput:function(){return this.keys.KeyW||this.keys.KeyS||this.keys.KeyA||this.keys.KeyD||this.keys.KeyQ||this.keys.KeyE||this.keys.ArrowUp||this.keys.ArrowDown||this.keys.ArrowLeft||this.keys.ArrowRight},isDroneStopped:function(){const t=this.hasKeyboardInput()||this.hasVRInput(),e=Math.abs(this.targetAltitudeChange)>.1,i=this.velocity.length()<.5,o=!t&&!e&&i;if(this.autoStabilizationActive){const t=.08;if(Math.abs(this.stabilizationTolerance-t)>.001){const e=.002;this.stabilizationTolerance>t?this.stabilizationTolerance=Math.max(t,this.stabilizationTolerance-e):this.stabilizationTolerance=Math.min(t,this.stabilizationTolerance+e),Date.now()-(this.lastToleranceChangeLog||0)>1e3&&(console.log(`üéØ Auto estabilidade: mantendo ¬±${(100*this.stabilizationTolerance).toFixed(1)}cm em qualquer altitude`),this.lastToleranceChangeLog=Date.now())}}return o},checkGroundContact:function(){const t=this.el.getAttribute("position"),e=Date.now();return this.isGrounded=t.y<=this.data.groundDetectionHeight,e-this.lastGroundCheck>2e3&&(console.log(`üåç Verifica√ß√£o do solo: altura=${t.y.toFixed(2)}m, tocando=${this.isGrounded?"SIM":"N√ÉO"}`),this.lastGroundCheck=e),this.isGrounded},applyGroundStabilization:function(t){const e={groundStabilization:this.data.groundStabilization,isActive:this.isActive,isFlying:this.isFlying,position:this.el.getAttribute("position")};if(Date.now()-(this.lastDebugLog||0)>3e3&&(console.log("üîç Debug estabiliza√ß√£o:",e),this.lastDebugLog=Date.now()),!this.data.groundStabilization||!this.isActive||!this.isFlying)return this.stabilizationActive=!1,0;const i=this.el.getAttribute("position"),o=Date.now();if(Math.abs(this.targetAltitudeChange)>.1)return this.stabilizationActive=!1,0;if(this.checkGroundContact(),this.isGrounded)return this.stabilizationActive&&(this.stabilizationActive=!1,console.log("üåç Estabiliza√ß√£o autom√°tica DESATIVADA - drone tocando o solo")),0;{this.stabilizationActive||(this.stabilizationActive=!0,this.stabilizationStartTime=o,console.log(`üöÅ Estabiliza√ß√£o autom√°tica ATIVADA - altura atual: ${i.y.toFixed(2)}m`));const t=this.data.stabilizationLift*this.data.stabilizationSmoothing*.2,e=.001*(o-this.stabilizationStartTime),a=.08*Math.sin(2*e),s=t+a;return o-this.lastGroundCheck>2e3&&console.log(`üîß Aplicando estabiliza√ß√£o: for√ßa=${s.toFixed(4)}, oscila√ß√£o=${a.toFixed(4)}`),s}},updatePropellerEffects:function(t){this.propellers.forEach((e,i)=>{if(e){let o,a;if(t&&this.isFlying){const t=Math.max(.1,this.thrustPower);o=Math.max(150,3e3/(t*(this.boostMode?2:1))),a=Math.min(.8,.2+.4*t),this.boostMode&&(a=Math.min(.9,1.5*a))}else o=2e3,a=.1;const s=i%2==0?"3600":"-3600";e.setAttribute("animation",{property:"rotation",to:`0 ${s} 0`,loop:!0,dur:o}),e.setAttribute("material","opacity",a)}})},initPropellerAnimations:function(){["prop1","prop2","prop3","prop4"].forEach((t,e)=>{const i=document.querySelector(`#${t}`);if(i){i.setAttribute("material",{color:"#ff4444",transparent:!0,opacity:.3,metalness:.1,roughness:.9}),i.setAttribute("geometry",{primitive:"cylinder",radius:.6,height:.03,segmentsRadial:8});const t=e%2==0?3600:-3600;i.setAttribute("animation",{property:"rotation",to:`0 ${t} 0`,loop:!0,dur:300})}})},updateAdvancedPropellerEffects:function(){["prop1","prop2","prop3","prop4"].forEach((t,e)=>{const i=document.querySelector(`#${t}`);if(i){let t=300,o=.3,a=.6,s="#ff4444",n=0;this.isFlying&&(n=this.thrustPower,t=Math.max(50,300-250*n),o=Math.min(.9,.3+.6*n),n>.7&&(a=.3+.8*(n-.7),o=Math.max(.2,o-.3*(n-.7)),s="#ff6666"),this.boostMode&&(t=Math.max(8,.4*t),o=Math.min(.95,o+.15),a+=.2,s="#ff8888"));const r=e%2==0?3600:-3600;i.setAttribute("geometry",{primitive:"cylinder",radius:a,height:.03,segmentsRadial:Math.max(6,Math.min(12,Math.round(8+4*n)))}),i.setAttribute("material",{color:s,transparent:!0,opacity:o,metalness:.1,roughness:.9}),i.setAttribute("animation",{property:"rotation",to:`0 ${r} 0`,loop:!0,dur:t,easing:"linear"})}})},updateVisualEffects:function(){const t=this.isFlying?1:.3;this.ledElements.forEach(e=>{if(e){e.getAttribute("material").emissive;e.setAttribute("material","emissiveIntensity",t)}})},updateHUD:function(){const t=document.querySelector("#speed-indicator");if(t){const e=Math.round(3.6*this.currentSpeed),i=Math.round(100*this.thrustPower),o=this.el.getAttribute("position");let a=`Velocidade: ${e} km/h | Altitude: ${Math.round(10*o.y)/10}m`;if(this.isFlying){if(a+=` | Empuxo: ${i}%`,this.isInLowAltitudeMode?a+=" | üî∫BAIXA ALT":a+=" | üîªNORMAL",this.isHovering&&(a+=" | HOVER"),this.autoStabilizationActive){const t=this.flightSimulation.baseAltitude||this.data.targetAltitude,e=Math.abs(t-o.y)<=this.stabilizationTolerance;a+=` | AUTO-ESTAB (¬±${Math.round(100*this.stabilizationTolerance)}cm)`,a+=e?" ‚úÖ":" ‚ö†Ô∏è"}else this.stabilizationActive&&(a+=" | ESTABILIZANDO");this.isGrounded&&(a+=" | SOLO"),this.boostMode&&(a+=" | BOOST"),this.cinematicMode.enabled?a+=` | üé¨ CINEMATOGR√ÅFICO (${Math.round(100*this.cinematicMode.speedMultiplier)}%)`:this.fpvMode.enabled?a+=` | üèéÔ∏è FPV/SPORT (${Math.round(3.6*this.fpvMode.maxSpeed)}km/h)`:a+=" | üöÅ NORMAL"}else a+=" | DESLIGADO";t.setAttribute("value",a)}const e=document.querySelector("#flight-mode-indicator");if(e){let t,i;this.cinematicMode.enabled?(t=`üé¨ CINEMATOGR√ÅFICO (${Math.round(100*this.cinematicMode.speedMultiplier)}%)`,i="#ff8800"):this.fpvMode.enabled?(t=`üöÅ FPV/SPORT (${Math.round(3.6*this.fpvMode.maxSpeed)}km/h)`,i="#ff5050"):(t="üöÅ NORMAL",i="#00ff00"),e.setAttribute("value",t),e.setAttribute("color",i)}this.updateStabilizationIndicator()},updateStabilizationIndicator:function(){let t=document.querySelector("#stabilization-indicator");t||(t=document.createElement("div"),t.id="stabilization-indicator",t.style.cssText="\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: 20px;\n\t\t\t\t\tright: 20px;\n\t\t\t\t\tbackground: rgba(0, 0, 0, 0.8);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tpadding: 10px 15px;\n\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\tfont-family: Arial, sans-serif;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t\tborder-left: 4px solid #00ff00;\n\t\t\t\t",document.body.appendChild(t)),this.updateCinematicIndicator();const e=this.el.getAttribute("position"),i=this.flightSimulation.baseAltitude||this.data.targetAltitude,o=i-e.y,a=Math.abs(o),s=a<=this.stabilizationTolerance,n=s?"#00ff00":"#ffaa00";t.style.borderLeftColor=n;const r=Math.round(100*this.stabilizationTolerance),l=Math.round(100*a),h=s?"‚úÖ EST√ÅVEL":"‚ö†Ô∏è AJUSTANDO";t.innerHTML=`\n\t\t\t\t<div style="font-weight: bold; color: ${n};">üéØ ESTABILIZA√á√ÉO ATIVA</div>\n\t\t\t\t<div>Alvo: ${i.toFixed(1)}m (¬±${r}cm)</div>\n\t\t\t\t<div>Atual: ${e.y.toFixed(1)}m</div>\n\t\t\t\t<div>Diferen√ßa: ${l}cm</div>\n\t\t\t\t<div style="color: ${n}; font-weight: bold;">${h}</div>\n\t\t\t`},updateCinematicIndicator:function(){let t=document.querySelector("#cinematic-indicator");this.cinematicMode.enabled?(t||(t=document.createElement("div"),t.id="cinematic-indicator",t.style.cssText="\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\ttop: 20px;\n\t\t\t\t\t\tleft: 20px;\n\t\t\t\t\t\tbackground: rgba(255, 140, 0, 0.9);\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\tpadding: 10px 15px;\n\t\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\t\tfont-family: Arial, sans-serif;\n\t\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tz-index: 1000;\n\t\t\t\t\t\tborder-left: 4px solid #ff8c00;\n\t\t\t\t\t\tbox-shadow: 0 2px 10px rgba(255, 140, 0, 0.3);\n\t\t\t\t\t",document.body.appendChild(t)),t.innerHTML=`\n\t\t\t\t\t<div style="color: #fff; font-weight: bold;">üé¨ MODO CINEMATOGR√ÅFICO</div>\n\t\t\t\t\t<div style="font-size: 12px; margin-top: 3px; opacity: 0.9;">\n\t\t\t\t\t\tVelocidade: ${Math.round(100*this.cinematicMode.speedMultiplier)}% | \n\t\t\t\t\t\tRota√ß√£o: ${Math.round(100*this.cinematicMode.rotationMultiplier)}%\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="font-size: 11px; margin-top: 2px; opacity: 0.8;">\n\t\t\t\t\t\tGrip Esquerdo (VR) ou C (Teclado) para desativar\n\t\t\t\t\t</div>\n\t\t\t\t`):t&&t.parentNode&&t.parentNode.removeChild(t)},resetDronePosition:function(){console.log("üîÑ Resetando posi√ß√£o do drone..."),this.el.setAttribute("position","0 3 0"),this.el.setAttribute("rotation","0 0 0"),this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},emergencyStop:function(){console.log("üö® Parada de emerg√™ncia!"),this.isFlying=!1,this.isLanding=!1,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.updatePropellerEffects(!1),this.updateAudioFeedback(new THREE.Vector3(0,0,0))},toggleLandingMode:function(){this.isLanded?this.takeOff():this.isLanding?this.cancelLanding():this.startLanding()},startLanding:function(){if(this.isActive&&this.isFlying){if(!this.canLandHere())return console.log("‚ö†Ô∏è N√£o √© poss√≠vel pousar aqui - procure uma superf√≠cie adequada"),void this.showLandingWarning("Superf√≠cie inadequada para pouso!");this.isLanding=!0,console.log("üõ¨ Iniciando sequ√™ncia de pouso autom√°tico..."),this.showLandingIndicator(!0),this.el.sceneEl.emit("drone-landing-start")}else console.log("‚ö†Ô∏è Drone deve estar ativo e voando para pousar")},cancelLanding:function(){this.isLanding=!1,console.log("‚ùå Pouso cancelado"),this.showLandingIndicator(!1)},takeOff:function(){this.isLanded&&(this.isLanded=!1,this.isLanding=!1,this.isActive=!0,this.isFlying=!0,this.velocity.y=3,console.log("üöÅ Decolando..."),this.showTakeOffIndicator())},canLandHere:function(){const t=this.el.getAttribute("position");return null!==this.detectSurfaceBelow(t)},detectSurfaceBelow:function(t){if(t.y<=this.landingHeight+.5)return{type:"ground",height:0};const e=document.querySelectorAll(".building");for(let i of e){const e=i.getAttribute("position"),o=i.getAttribute("geometry");if(!e||!o)continue;const a=o.width||10,s=o.depth||10,n=o.height||20,r=Math.abs(t.x-e.x),l=Math.abs(t.z-e.z);if(r<a/2&&l<s/2){const o=e.y+n/2;if(t.y>o&&t.y-o<10)return{type:"building",height:o,object:i}}}return null},processLanding:function(t){if(!this.isLanding)return;const e=this.el.getAttribute("position"),i=this.detectSurfaceBelow(e);if(!i)return console.log("‚ö†Ô∏è Nenhuma superf√≠cie detectada para pouso"),void this.cancelLanding();const o=i.height+this.landingHeight;e.y>o?(this.velocity.y=-this.landingSpeed,this.velocity.x*=.9,this.velocity.z*=.9):this.completeLanding(i)},completeLanding:function(t){this.isLanding=!1,this.isLanded=!0,this.isFlying=!1,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0);const e=this.el.getAttribute("position");e.y=t.height+this.landingHeight,this.el.setAttribute("position",e),console.log(`‚úÖ Pouso conclu√≠do em ${t.type} na altura ${t.height.toFixed(2)}m`),this.showLandedIndicator(),this.showLandingIndicator(!1)},showLandingWarning:function(t){const e=document.createElement("div");e.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 30%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(255, 100, 100, 0.95);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t\tpointer-events: none;\n\t\t\t\ttext-align: center;\n\t\t\t",e.innerHTML=`‚ö†Ô∏è ${t}`,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},3e3)},showLandingIndicator:function(t){let e=document.getElementById("landing-indicator");t&&!e?(e=document.createElement("div"),e.id="landing-indicator",e.style.cssText="\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: 20px;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\ttransform: translateX(-50%);\n\t\t\t\t\tbackground: rgba(255, 165, 0, 0.9);\n\t\t\t\t\tcolor: white;\n\t\t\t\t\tpadding: 10px 20px;\n\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t\tanimation: pulse 1s infinite;\n\t\t\t\t",e.innerHTML="üõ¨ MODO POUSO ATIVO<br><small>Descendo suavemente...</small>",document.body.appendChild(e)):!t&&e&&e.remove()},showTakeOffIndicator:function(){const t=document.createElement("div");t.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(0, 255, 0, 0.9);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t",t.innerHTML="üöÅ DECOLANDO!",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},2e3)},showLandedIndicator:function(){const t=document.createElement("div");t.style.cssText="\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 50%;\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\tbackground: rgba(0, 150, 0, 0.9);\n\t\t\t\tcolor: white;\n\t\t\t\tpadding: 20px;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tfont-size: 18px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tz-index: 1000;\n\t\t\t",t.innerHTML="‚úÖ POUSADO COM SUCESSO!<br><small>Pressione Y novamente para decolar</small>",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},3e3)}}),console.log("üì¶ M√≥dulo drone-controller.js carregado com sucesso!"),AFRAME.components["futuristic-hud-melhorado"]||(AFRAME.registerComponent("futuristic-hud-melhorado",{schema:{transparency:{type:"number",default:.7},hudColor:{type:"color",default:"#00ffff"},warningColor:{type:"color",default:"#ff4444"},successColor:{type:"color",default:"#44ff44"},enabled:{type:"boolean",default:!0},hudWidth:{type:"number",default:4},hudHeight:{type:"number",default:3},hudScale:{type:"number",default:1},hudDistance:{type:"number",default:2.5}},init:function(){console.log("üöÄ Inicializando HUD Futur√≠stico Melhorado..."),this.hudData={speedMS:0,speedKMH:0,altitude:0,batteryPercent:100,gpsSignal:!0,mode:"CINEMATOGR√ÅFICO",objective:"CHECKPOINT A",distanceToObjective:120,temperature:25,missionTime:0,coordinates:{x:0,y:0,z:0},objectiveDirection:0},this.hudElements={},this.animationFrameId=null,this.startTime=Date.now(),this.missionStartTime=Date.now(),this.setupKeyboardControls(),this.createHUDStructure(),this.startUpdates(),console.log("‚úÖ HUD Futur√≠stico Melhorado inicializado!"),console.log("üìä Novos recursos:"),console.log("  ‚Ä¢ Velocidade em M/S"),console.log("  ‚Ä¢ Bateria baseada no tempo da miss√£o"),console.log("  ‚Ä¢ Seta GPS din√¢mica para pr√≥ximo objetivo"),console.log("  ‚Ä¢ Dist√¢ncia para objetivo destacada")},setupKeyboardControls:function(){console.log("üéÆ Configurando controles do HUD melhorado...");const t=this;document.addEventListener("keydown",e=>{switch(e.key.toLowerCase()){case"h":t.toggleHUD();break;case"u":t.cycleTransparency();break;case"i":t.cycleHUDColor();break;case"+":case"=":t.increaseHUDSize();break;case"-":case"_":t.decreaseHUDSize();break;case"0":t.resetHUDSize()}})},createHUDStructure:function(){console.log("üèóÔ∏è Criando HUD melhorado com imagem..."),this.hudContainer=document.createElement("a-entity"),this.hudContainer.setAttribute("id","futuristic-hud-melhorado-container"),this.hudContainer.setAttribute("position",`0 0 -${this.data.hudDistance}`),this.createImageBasedHUD(),this.el.appendChild(this.hudContainer),console.log("‚úÖ HUD melhorado criado!")},createImageBasedHUD:function(){const t=document.createElement("a-plane");t.setAttribute("width",this.data.hudWidth*this.data.hudScale),t.setAttribute("height",this.data.hudHeight*this.data.hudScale),t.setAttribute("position","0 0 0"),t.setAttribute("material",{src:"assets/hud-overlay-melhorado.svg",transparent:!0,opacity:this.data.transparency,alphaTest:.1}),this.hudContainer.appendChild(t),this.hudElements.hudPlane=t,this.createDynamicTextElements()},createDynamicTextElements:function(){const t=document.createElement("a-text");t.setAttribute("id","hud-speed-ms"),t.setAttribute("value","12.5"),t.setAttribute("position","-1.4 0.6 0.01"),t.setAttribute("align","center"),t.setAttribute("color",this.data.hudColor),t.setAttribute("scale","0.8 0.8 0.8"),this.hudContainer.appendChild(t),this.hudElements.speedText=t;const e=document.createElement("a-text");e.setAttribute("id","hud-battery-time"),e.setAttribute("value","100%"),e.setAttribute("position","1.4 0.6 0.01"),e.setAttribute("align","center"),e.setAttribute("color",this.data.successColor),e.setAttribute("scale","0.6 0.6 0.6"),this.hudContainer.appendChild(e),this.hudElements.batteryText=e;const i=document.createElement("a-text");i.setAttribute("id","hud-altitude-metros"),i.setAttribute("value","450"),i.setAttribute("position","-1.4 -0.6 0.01"),i.setAttribute("align","center"),i.setAttribute("color",this.data.hudColor),i.setAttribute("scale","0.8 0.8 0.8"),this.hudContainer.appendChild(i),this.hudElements.altitudeText=i;const o=document.createElement("a-text");o.setAttribute("id","hud-distance-objetivo"),o.setAttribute("value","120M"),o.setAttribute("position","-0.6 -0.8 0.01"),o.setAttribute("align","center"),o.setAttribute("color","#ffaa00"),o.setAttribute("scale","0.6 0.6 0.6"),this.hudContainer.appendChild(o),this.hudElements.distanceText=o;const a=document.createElement("a-text");a.setAttribute("id","hud-mode-voo"),a.setAttribute("value","CINEMATOGR√ÅFICO"),a.setAttribute("position","0.6 -0.8 0.01"),a.setAttribute("align","center"),a.setAttribute("color","#ff8800"),a.setAttribute("scale","0.5 0.5 0.5"),this.hudContainer.appendChild(a),this.hudElements.modeText=a;const s=document.createElement("a-text");s.setAttribute("id","hud-mission-time"),s.setAttribute("value","MISS√ÉO: 00:00"),s.setAttribute("position","0 1.3 0.01"),s.setAttribute("align","center"),s.setAttribute("color",this.data.hudColor),s.setAttribute("scale","0.25 0.25 0.25"),this.hudContainer.appendChild(s),this.hudElements.missionTimeText=s;const n=document.createElement("a-text");n.setAttribute("id","hud-coords-melhorado"),n.setAttribute("value","X:0 Y:0 Z:0"),n.setAttribute("position","0.8 1.3 0.01"),n.setAttribute("align","center"),n.setAttribute("color",this.data.hudColor),n.setAttribute("scale","0.25 0.25 0.25"),this.hudContainer.appendChild(n),this.hudElements.coordsText=n,this.createGPSArrow()},createGPSArrow:function(){const t=document.createElement("a-entity");t.setAttribute("id","gps-arrow-3d"),t.setAttribute("position","1.4 -0.6 0.02");const e=document.createElement("a-cone");e.setAttribute("radius-bottom","0.03"),e.setAttribute("radius-top","0"),e.setAttribute("height","0.08"),e.setAttribute("rotation","0 0 -90"),e.setAttribute("material",{color:this.data.successColor,transparent:!0,opacity:.8}),t.appendChild(e),this.hudContainer.appendChild(t),this.hudElements.gpsArrow=t},startUpdates:function(){console.log("üîÑ Iniciando atualiza√ß√µes do HUD melhorado..."),this.updateHUD()},updateHUD:function(){this.data.enabled&&(this.updateDroneData(),this.updateVisualElements(),this.animationFrameId=requestAnimationFrame(()=>{this.updateHUD()}))},updateDroneData:function(){const t=document.querySelector("#drone"),e=document.querySelector("[game-manager]");if(!t)return;const i=t.getAttribute("position"),o=t.components["drone-controller"],a=e?.components["game-manager"];if(this.hudData.coordinates={x:Math.round(i.x),y:Math.round(i.y),z:Math.round(i.z)},o&&o.velocity){const t=o.velocity;this.hudData.speedMS=t.length(),this.hudData.speedKMH=3.6*this.hudData.speedMS}else if(this.lastPosition){const t=Date.now(),e=(t-this.lastTime)/1e3;if(e>.1){const o=i.x-this.lastPosition.x,a=i.y-this.lastPosition.y,s=i.z-this.lastPosition.z,n=Math.sqrt(o*o+a*a+s*s);this.hudData.speedMS=n/e,this.hudData.speedKMH=3.6*this.hudData.speedMS,this.lastPosition={...i},this.lastTime=t}}else this.lastPosition={...i},this.lastTime=Date.now(),this.hudData.speedMS=0;if(this.hudData.altitude=Math.round(i.y),a&&a.gameState&&a.gameState.isPlaying){this.hudData.missionTime=a.gameState.elapsedTime/1e3;const t=a.data.timeLimit||300;this.hudData.batteryPercent=Math.max(5,100-this.hudData.missionTime/t*100)}else{this.hudData.missionTime=(Date.now()-this.missionStartTime)/1e3;const t=300;this.hudData.batteryPercent=Math.max(5,100-this.hudData.missionTime/t*100)}o&&(o.cinematicMode?.enabled?this.hudData.mode="CINEMATOGR√ÅFICO":o.fpvMode?.enabled?this.hudData.mode="FPV/SPORT":this.hudData.mode="NORMAL"),this.calculateObjectiveData()},calculateObjectiveData:function(){const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=document.querySelectorAll("[checkpoint]");let o=999,a=null;if(i.forEach((t,i)=>{const s=t.getAttribute("position"),n=Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2)+Math.pow(e.z-s.z,2));n<o&&(o=n,a=t)}),this.hudData.distanceToObjective=Math.round(o),a){const t=a.getAttribute("position"),i=t.x-e.x,o=t.z-e.z;this.hudData.objectiveDirection=Math.atan2(i,o)*(180/Math.PI)}},updateVisualElements:function(){if(this.hudElements.speedText&&this.hudElements.speedText.setAttribute("value",this.hudData.speedMS.toFixed(1)),this.hudElements.batteryText){const t=Math.round(this.hudData.batteryPercent);this.hudElements.batteryText.setAttribute("value",`${t}%`);let e=this.data.successColor;t<20?e=this.data.warningColor:t<50&&(e="#ffaa00"),this.hudElements.batteryText.setAttribute("color",e)}if(this.hudElements.altitudeText&&this.hudElements.altitudeText.setAttribute("value",this.hudData.altitude.toString()),this.hudElements.distanceText&&this.hudElements.distanceText.setAttribute("value",`${this.hudData.distanceToObjective}M`),this.hudElements.modeText&&this.hudElements.modeText.setAttribute("value",this.hudData.mode),this.hudElements.missionTimeText){const t=Math.floor(this.hudData.missionTime/60),e=Math.floor(this.hudData.missionTime%60);this.hudElements.missionTimeText.setAttribute("value",`MISS√ÉO: ${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`)}this.hudElements.coordsText&&this.hudElements.coordsText.setAttribute("value",`X:${this.hudData.coordinates.x} Y:${this.hudData.coordinates.y} Z:${this.hudData.coordinates.z}`),this.updateGPSArrow()},updateGPSArrow:function(){this.hudElements.gpsArrow&&(this.hudElements.gpsArrow.setAttribute("rotation","0 0 "+-this.hudData.objectiveDirection),this.hudData.distanceToObjective<50?this.hudElements.gpsArrow.setAttribute("animation",{property:"scale",to:"1.2 1.2 1.2",dur:500,dir:"alternate",loop:!0}):this.hudElements.gpsArrow.removeAttribute("animation"))},toggleHUD:function(){this.data.enabled=!this.data.enabled,this.hudContainer&&this.hudContainer.setAttribute("visible",this.data.enabled),console.log("üöÄ HUD Melhorado: "+(this.data.enabled?"ATIVADO":"DESATIVADO"))},cycleTransparency:function(){const t=[.3,.5,.7,.9],e=(t.indexOf(this.data.transparency)+1)%t.length;this.data.transparency=t[e],this.hudElements.hudPlane&&this.hudElements.hudPlane.setAttribute("material.opacity",this.data.transparency),console.log(`üîç Transpar√™ncia: ${Math.round(100*this.data.transparency)}%`)},cycleHUDColor:function(){const t=["#00ffff","#00ff00","#ffff00","#ff8800","#ff4444"],e=(t.indexOf(this.data.hudColor)+1)%t.length;this.data.hudColor=t[e];[this.hudElements.speedText,this.hudElements.altitudeText,this.hudElements.missionTimeText,this.hudElements.coordsText].forEach(t=>{t&&t.setAttribute("color",this.data.hudColor)}),console.log(`üé® Cor do HUD: ${["CIANO","VERDE","AMARELO","LARANJA","VERMELHO"][e]}`)},increaseHUDSize:function(){this.data.hudScale=Math.min(2,this.data.hudScale+.1),this.updateHUDDimensions(),console.log(`üìè Tamanho: ${Math.round(100*this.data.hudScale)}%`)},decreaseHUDSize:function(){this.data.hudScale=Math.max(.3,this.data.hudScale-.1),this.updateHUDDimensions(),console.log(`üìè Tamanho: ${Math.round(100*this.data.hudScale)}%`)},resetHUDSize:function(){this.data.hudScale=1,this.updateHUDDimensions(),console.log("üîÑ Tamanho resetado para 100%")},updateHUDDimensions:function(){if(this.hudElements.hudPlane){const t=this.data.hudWidth*this.data.hudScale,e=this.data.hudHeight*this.data.hudScale;this.hudElements.hudPlane.setAttribute("width",t),this.hudElements.hudPlane.setAttribute("height",e)}},remove:function(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.hudContainer&&this.hudContainer.parentNode&&this.hudContainer.parentNode.removeChild(this.hudContainer)}}),console.log("üì¶ M√≥dulo futuristic-hud-melhorado.js carregado com sucesso!")),AFRAME.components["futuristic-hud"]||(AFRAME.registerComponent("futuristic-hud",{schema:{transparency:{type:"number",default:.8},hudColor:{type:"color",default:"#ffffff"},warningColor:{type:"color",default:"#ff4444"},successColor:{type:"color",default:"#44ff44"},enabled:{type:"boolean",default:!0},hudWidth:{type:"number",default:3.5},hudHeight:{type:"number",default:2.5},hudScale:{type:"number",default:1},hudDistance:{type:"number",default:2},useCleanHUD:{type:"boolean",default:!0},parallaxIntensity:{type:"number",default:.03},smoothingFactor:{type:"number",default:.1}},init:function(){console.log("üöÄ Inicializando HUD Fixo com hud-01.svg..."),console.log("üéØ FOR√áANDO USO DO HUD-01.SVG COM LINHAS BRANCAS"),this.hudData={speed:0,altitude:0,battery:100,gpsSignal:!0,mode:"CINEMATOGR√ÅFICO",objective:"CHECKPOINT 1",distance:120,temperature:25,flightTime:0,coordinates:{x:0,y:0,z:0}},this.parallax={lastDronePosition:{x:0,y:0,z:0},currentOffset:{x:0,y:0,z:0},targetOffset:{x:0,y:0,z:0},basePosition:{x:0,y:0,z:-this.data.hudDistance}},this.hudElements={},this.animationFrameId=null,this.startTime=Date.now(),this.setupKeyboardControls(),setTimeout(()=>{this.createHUDStructure(),this.startUpdates()},500),console.log("‚úÖ HUD Fixo com hud-01.svg inicializado!"),console.log("üéÆ Controles do HUD:"),console.log("  H - Alternar HUD"),console.log("  U - Ajustar transpar√™ncia"),console.log("  K - For√ßar hud-01.svg")},setupKeyboardControls:function(){console.log("üéÆ Configurando controles de teclado do HUD...");const t=this;document.addEventListener("keydown",e=>{switch(console.log(`üîë Tecla pressionada: ${e.key}`),e.key.toLowerCase()){case"h":console.log("üöÄ Comando H - Toggle HUD"),t.toggleHUD();break;case"u":console.log("üîç Comando U - Transpar√™ncia"),t.cycleTransparency();break;case"i":console.log("üé® Comando I - Cor do HUD"),t.cycleHUDColor();break;case"n":console.log("üìä Comando N - Grid de Navega√ß√£o"),t.toggleNavigationGrid();break;case"l":console.log("üìç Comando L - Linhas de Navega√ß√£o"),t.toggleNavigationLines();break;case"=":case"+":console.log("üîç Comando + - Aumentar HUD"),t.increaseHUDSize();break;case"-":case"_":console.log("üîç Comando - - Diminuir HUD"),t.decreaseHUDSize();break;case"0":console.log("üîÑ Comando 0 - Reset tamanho HUD"),t.resetHUDSize();break;case"[":console.log("üìè Comando [ - HUD mais pr√≥ximo"),t.moveHUDCloser();break;case"]":console.log("üìè Comando ] - HUD mais distante"),t.moveHUDFarther();break;case"k":console.log("üéØ Comando K - For√ßar hud-01.svg"),t.forceHUD01()}}),console.log("‚úÖ Controles de teclado configurados!")},toggleHUD:function(){console.log("üöÄ Executando toggleHUD..."),this.data.enabled=!this.data.enabled,this.data.enabled?(this.show(),this.showNotification("üöÄ HUD FUTUR√çSTICO ATIVADO","#00ff00"),console.log("üöÄ HUD Futur√≠stico ATIVADO")):(this.hide(),this.showNotification("üöÄ HUD FUTUR√çSTICO DESATIVADO","#ff4444"),console.log("üöÄ HUD Futur√≠stico DESATIVADO"))},cycleTransparency:function(){console.log("üîç Executando cycleTransparency...");const t=[.3,.5,.7,.9],e=(t.indexOf(this.data.transparency)+1)%t.length;this.setTransparency(t[e]);const i=Math.round(100*this.data.transparency);this.showNotification(`üîç TRANSPAR√äNCIA: ${i}%`,"#ffaa00"),console.log(`üîç Transpar√™ncia do HUD: ${i}%`)},cycleHUDColor:function(){console.log("üé® Executando cycleHUDColor...");const t=["#00ffff","#00ff00","#ffff00","#ff8800","#ff4444"],e=["CIANO","VERDE","AMARELO","LARANJA","VERMELHO"],i=(t.indexOf(this.data.hudColor)+1)%t.length;this.setHUDColor(t[i]),this.showNotification(`üé® COR: ${e[i]}`,t[i]),console.log(`üé® Cor do HUD: ${e[i]}`)},toggleNavigationGrid:function(){if(console.log("üìä Executando toggleNavigationGrid..."),this.hudElements.navigationGrid){const t=this.hudElements.navigationGrid.getAttribute("visible");this.hudElements.navigationGrid.setAttribute("visible",!t),this.showNotification(t?"üìä GRID DESATIVADO":"üìä GRID ATIVADO","#ffaa00")}},toggleNavigationLines:function(){if(console.log("üìç Executando toggleNavigationLines..."),this.hudElements.navigationLines){const t=this.hudElements.navigationLines.getAttribute("visible");this.hudElements.navigationLines.setAttribute("visible",!t),this.showNotification(t?"üìç LINHAS DESATIVADAS":"üìç LINHAS ATIVADAS","#ffaa00")}},forceHUD01:function(){console.log("üéØ FOR√áANDO HUD-01.SVG..."),this.hudContainer&&this.hudContainer.parentNode.removeChild(this.hudContainer),setTimeout(()=>{this.createHUDStructure(),this.showNotification("üéØ HUD-01.SVG RECARREGADO!","#ffffff"),console.log("üéØ HUD-01.SVG recarregado com sucesso!")},100)},toggleCleanHUD:function(){console.log("üéØ Executando toggleCleanHUD...");const t=Date.now();this.hudElements.hudPlane&&this.hudElements.hudPlane.setAttribute("material",{src:`assets/hud-01.svg?v=${t}`,transparent:!0,opacity:this.data.transparency,alphaTest:.1,color:"#ffffff",shader:"flat"}),this.showNotification("üéØ HUD-01.SVG FOR√áADO!","#ffffff"),console.log("üéØ For√ßando uso do hud-01.svg com linhas brancas")},increaseHUDSize:function(){console.log("üîç Aumentando tamanho do HUD..."),this.data.hudScale=Math.min(2,this.data.hudScale+.1),this.updateHUDDimensions(),this.showNotification(`üìè TAMANHO: ${Math.round(100*this.data.hudScale)}%`,"#00ff00")},decreaseHUDSize:function(){console.log("üîç Diminuindo tamanho do HUD..."),this.data.hudScale=Math.max(.3,this.data.hudScale-.1),this.updateHUDDimensions(),this.showNotification(`üìè TAMANHO: ${Math.round(100*this.data.hudScale)}%`,"#ffaa00")},resetHUDSize:function(){console.log("üîÑ Resetando tamanho do HUD..."),this.data.hudScale=1,this.data.hudDistance=2.5,this.updateHUDDimensions(),this.updateHUDPosition(),this.showNotification("üîÑ TAMANHO RESETADO","#00ffff")},moveHUDCloser:function(){console.log("üìè Movendo HUD para mais perto..."),this.data.hudDistance=Math.max(1,this.data.hudDistance-.2),this.updateHUDPosition(),this.showNotification(`üìè DIST√ÇNCIA: ${this.data.hudDistance.toFixed(1)}m`,"#ffaa00")},moveHUDFarther:function(){console.log("üìè Movendo HUD para mais longe..."),this.data.hudDistance=Math.min(5,this.data.hudDistance+.2),this.updateHUDPosition(),this.showNotification(`üìè DIST√ÇNCIA: ${this.data.hudDistance.toFixed(1)}m`,"#ffaa00")},updateHUDDimensions:function(){if(this.hudElements.hudPlane){const t=this.data.hudWidth*this.data.hudScale,e=this.data.hudHeight*this.data.hudScale;this.hudElements.hudPlane.setAttribute("width",t),this.hudElements.hudPlane.setAttribute("height",e),console.log(`üìè HUD redimensionado: ${t.toFixed(1)} x ${e.toFixed(1)}`)}this.updateTextElementsScale()},updateHUDPosition:function(){this.hudContainer&&(this.hudContainer.setAttribute("position",`0 0 -${this.data.hudDistance}`),console.log(`üìè HUD reposicionado: dist√¢ncia ${this.data.hudDistance}m`))},updateTextElementsScale:function(){const t=this.data.hudScale;[this.hudElements.speedText,this.hudElements.batteryText,this.hudElements.altitudeText,this.hudElements.modeText,this.hudElements.objectiveText,this.hudElements.distanceText,this.hudElements.coordsText].forEach(e=>{if(e){const i=e.getAttribute("scale"),o={x:i.x/this.lastTextScale||i.x,y:i.y/this.lastTextScale||i.y,z:i.z/this.lastTextScale||i.z};e.setAttribute("scale",{x:o.x*t,y:o.y*t,z:o.z*t})}}),this.lastTextScale=t},setHUDSize:function(t,e,i=1){console.log(`üìè Definindo tamanho customizado: ${t}x${e} (escala: ${i})`),this.data.hudWidth=t,this.data.hudHeight=e,this.data.hudScale=i,this.updateHUDDimensions(),this.showNotification(`üìè TAMANHO: ${t.toFixed(1)}x${e.toFixed(1)}`,"#00ffff")},setHUDPreset:function(t){switch(t){case"small":this.setHUDSize(3,2.25,.8),this.showNotification("üìè PRESET: PEQUENO","#ffaa00");break;case"medium":this.setHUDSize(4,3,1),this.showNotification("üìè PRESET: M√âDIO","#00ffff");break;case"large":this.setHUDSize(5,3.75,1.2),this.showNotification("üìè PRESET: GRANDE","#00ff00");break;case"fullscreen":this.setHUDSize(6,4.5,1.5),this.showNotification("üìè PRESET: TELA CHEIA","#ff8800")}},createHUDStructure:function(){console.log("üèóÔ∏è Criando HUD fixo com movimento sutil..."),this.hudContainer=document.createElement("a-entity"),this.hudContainer.setAttribute("id","fixed-hud-container"),this.hudContainer.setAttribute("position",`${this.parallax.basePosition.x} ${this.parallax.basePosition.y} ${this.parallax.basePosition.z}`),this.createFixedImageHUD(),this.el.appendChild(this.hudContainer),console.log(`‚úÖ HUD Fixo criado! Tamanho: ${this.data.hudWidth}x${this.data.hudHeight}, Dist√¢ncia: ${this.data.hudDistance}m`),console.log(`üéØ Paralaxe: intensidade ${this.data.parallaxIntensity}, suaviza√ß√£o ${this.data.smoothingFactor}`)},createFixedImageHUD:function(){console.log("üéØ Criando HUD com hud-01.svg FOR√áADO...");const t=document.createElement("a-plane");t.setAttribute("width",(this.data.hudWidth+.2)*this.data.hudScale),t.setAttribute("height",(this.data.hudHeight+.2)*this.data.hudScale),t.setAttribute("position","0 0 -0.01"),t.setAttribute("material",{color:"#000000",transparent:!0,opacity:.3}),this.hudContainer.appendChild(t);const e=document.createElement("a-plane");e.setAttribute("width",this.data.hudWidth*this.data.hudScale),e.setAttribute("height",this.data.hudHeight*this.data.hudScale),e.setAttribute("position","0 0 0");const i=Date.now();e.setAttribute("material",{src:`assets/hud-01.svg?v=${i}`,transparent:!0,opacity:this.data.transparency,alphaTest:.1,color:"#ffffff",shader:"flat",side:"front"}),this.hudContainer.appendChild(e),this.hudElements.hudPlane=e,this.hudElements.hudBackground=t,console.log("‚úÖ HUD FOR√áADO para usar hud-01.svg com linhas brancas"),console.log(`üìÅ Arquivo: assets/hud-01.svg?v=${i}`),this.lastTextScale=1,this.createCompactDataElements()},createCompactDataElements:function(){const t=document.createElement("a-text");t.setAttribute("id","hud-speed-dynamic"),t.setAttribute("value","96"),t.setAttribute("position","-1.2 0.4 0.01"),t.setAttribute("align","center"),t.setAttribute("color","#ffffff"),t.setAttribute("scale","0.7 0.7 0.7"),t.setAttribute("font","monospace"),this.hudContainer.appendChild(t),this.hudElements.speedText=t;const e=document.createElement("a-text");e.setAttribute("id","hud-battery-dynamic"),e.setAttribute("value","87%"),e.setAttribute("position","1.2 0.4 0.01"),e.setAttribute("align","center"),e.setAttribute("color","#ffffff"),e.setAttribute("scale","0.6 0.6 0.6"),e.setAttribute("font","monospace"),this.hudContainer.appendChild(e),this.hudElements.batteryText=e;const i=document.createElement("a-text");i.setAttribute("id","hud-altitude-dynamic"),i.setAttribute("value","450"),i.setAttribute("position","-1.2 -0.4 0.01"),i.setAttribute("align","center"),i.setAttribute("color","#ffffff"),i.setAttribute("scale","0.7 0.7 0.7"),i.setAttribute("font","monospace"),this.hudContainer.appendChild(i),this.hudElements.altitudeText=i;const o=document.createElement("a-text");o.setAttribute("id","hud-distance-dynamic"),o.setAttribute("value","120M"),o.setAttribute("position","1.2 -0.2 0.01"),o.setAttribute("align","center"),o.setAttribute("color","#ffffff"),o.setAttribute("scale","0.5 0.5 0.5"),o.setAttribute("font","monospace"),this.hudContainer.appendChild(o),this.hudElements.distanceText=o;const a=document.createElement("a-text");a.setAttribute("id","hud-mode-dynamic"),a.setAttribute("value","CINEMATIC"),a.setAttribute("position","-0.5 -0.8 0.01"),a.setAttribute("align","center"),a.setAttribute("color","#ffffff"),a.setAttribute("scale","0.4 0.4 0.4"),a.setAttribute("font","monospace"),this.hudContainer.appendChild(a),this.hudElements.modeText=a;const s=document.createElement("a-text");s.setAttribute("id","hud-objective-dynamic"),s.setAttribute("value","CHECKPOINT 1"),s.setAttribute("position","0.5 -0.6 0.01"),s.setAttribute("align","center"),s.setAttribute("color","#ffffff"),s.setAttribute("scale","0.4 0.4 0.4"),s.setAttribute("font","monospace"),this.hudContainer.appendChild(s),this.hudElements.objectiveText=s;const n=document.createElement("a-text");n.setAttribute("id","hud-coords-dynamic"),n.setAttribute("value","X:0 Y:450 Z:0"),n.setAttribute("position","0.5 1.0 0.01"),n.setAttribute("align","center"),n.setAttribute("color","#ffffff"),n.setAttribute("scale","0.3 0.3 0.3"),n.setAttribute("font","monospace"),this.hudContainer.appendChild(n),this.hudElements.coordsText=n;const r=document.createElement("a-text");r.setAttribute("id","hud-time-dynamic"),r.setAttribute("value","02:34"),r.setAttribute("position","0 1.0 0.01"),r.setAttribute("align","center"),r.setAttribute("color","#ffffff"),r.setAttribute("scale","0.3 0.3 0.3"),r.setAttribute("font","monospace"),this.hudContainer.appendChild(r),this.hudElements.timeText=r;const l=document.createElement("a-circle");l.setAttribute("id","hud-center-indicator"),l.setAttribute("radius","0.02"),l.setAttribute("position","0 0 0.02"),l.setAttribute("material",{color:"#ffff00",transparent:!0,opacity:.8}),l.setAttribute("animation",{property:"material.opacity",to:"0.3",dur:2e3,dir:"alternate",loop:!0}),this.hudContainer.appendChild(l),this.hudElements.centerIndicator=l},startUpdates:function(){console.log("üîÑ Iniciando atualiza√ß√µes do HUD..."),this.updateHUD()},updateHUD:function(){this.data.enabled&&(this.updateBasicData(),this.updateParallax(),this.animationFrameId=requestAnimationFrame(()=>{this.updateHUD()}))},updateParallax:function(){const t=document.querySelector("#drone");if(!t||!this.hudContainer)return;const e=t.getAttribute("position"),i=e.x-this.parallax.lastDronePosition.x,o=e.y-this.parallax.lastDronePosition.y,a=e.z-this.parallax.lastDronePosition.z;this.parallax.targetOffset.x+=i*this.data.parallaxIntensity,this.parallax.targetOffset.y+=o*this.data.parallaxIntensity*.5,this.parallax.targetOffset.z+=a*this.data.parallaxIntensity*.3,this.parallax.currentOffset.x+=(this.parallax.targetOffset.x-this.parallax.currentOffset.x)*this.data.smoothingFactor,this.parallax.currentOffset.y+=(this.parallax.targetOffset.y-this.parallax.currentOffset.y)*this.data.smoothingFactor,this.parallax.currentOffset.z+=(this.parallax.targetOffset.z-this.parallax.currentOffset.z)*this.data.smoothingFactor;const s=.1;this.parallax.currentOffset.x=Math.max(-.1,Math.min(s,this.parallax.currentOffset.x)),this.parallax.currentOffset.y=Math.max(-.1,Math.min(s,this.parallax.currentOffset.y)),this.parallax.currentOffset.z=Math.max(-.1,Math.min(s,this.parallax.currentOffset.z));const n={x:this.parallax.basePosition.x+this.parallax.currentOffset.x,y:this.parallax.basePosition.y+this.parallax.currentOffset.y,z:this.parallax.basePosition.z+this.parallax.currentOffset.z};this.hudContainer.setAttribute("position",n),this.parallax.lastDronePosition={...e}},updateBasicData:function(){const t=document.querySelector("#drone");if(t){const e=t.getAttribute("position"),i=t.components["drone-controller"];this.hudData.coordinates={x:Math.round(e.x),y:Math.round(e.y),z:Math.round(e.z)},i&&i.velocity&&(this.hudData.speed=Math.round(3.6*i.velocity.length())),this.hudData.altitude=Math.round(e.y);const o=(Date.now()-this.startTime)/1e3;this.hudData.battery=Math.max(10,100-Math.floor(o/10)),i&&(i.cinematicMode?.enabled?this.hudData.mode="CINEMATIC":i.fpvMode?.enabled?this.hudData.mode="FPV/SPORT":this.hudData.mode="NORMAL")}this.updateVisualElements()},updateVisualElements:function(){if(this.hudElements.speedText&&this.hudElements.speedText.setAttribute("value",this.hudData.speed.toString()),this.hudElements.batteryText){this.hudElements.batteryText.setAttribute("value",`${this.hudData.battery}%`);const t=this.hudData.battery<20?"#ff4444":this.hudData.battery<50?"#ffaa00":"#ffffff";this.hudElements.batteryText.setAttribute("color",t)}if(this.hudElements.altitudeText&&this.hudElements.altitudeText.setAttribute("value",this.hudData.altitude.toString()),this.calculateDistanceToNearestCheckpoint(),this.hudElements.distanceText&&this.hudElements.distanceText.setAttribute("value",`${this.hudData.distance}M`),this.hudElements.modeText&&this.hudElements.modeText.setAttribute("value",this.hudData.mode),this.hudElements.objectiveText&&this.hudElements.objectiveText.setAttribute("value",this.hudData.objective),this.hudElements.coordsText&&this.hudElements.coordsText.setAttribute("value",`X:${this.hudData.coordinates.x} Y:${this.hudData.coordinates.y} Z:${this.hudData.coordinates.z}`),this.hudElements.timeText){const t=Math.floor((Date.now()-this.startTime)/1e3),e=Math.floor(t/60),i=t%60;this.hudElements.timeText.setAttribute("value",`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`)}},calculateDistanceToNearestCheckpoint:function(){const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=document.querySelectorAll("[checkpoint]");let o=999;i.forEach(t=>{const i=t.getAttribute("position"),a=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2));a<o&&(o=a)}),this.hudData.distance=Math.round(o)},showNotification:function(t,e="#00ffff",i=2e3){console.log(`üì¢ Notifica√ß√£o: ${t}`);const o=document.createElement("a-text");o.setAttribute("value",t),o.setAttribute("color",e),o.setAttribute("position","0 0.5 -1.5"),o.setAttribute("align","center"),o.setAttribute("scale","1.5 1.5 1.5"),o.setAttribute("animation",{property:"position",to:"0 1.0 -1.5",dur:500,easing:"easeOutQuad"}),o.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:i,delay:500}),this.el.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},i+1e3)},show:function(){this.data.enabled=!0,this.hudContainer&&this.hudContainer.setAttribute("visible",!0)},hide:function(){this.data.enabled=!1,this.hudContainer&&this.hudContainer.setAttribute("visible",!1)},setTransparency:function(t){this.data.transparency=Math.max(.1,Math.min(1,t)),console.log(`üîç Transpar√™ncia definida para: ${this.data.transparency}`),this.hudElements.hudPlane&&this.hudElements.hudPlane.setAttribute("material.opacity",this.data.transparency)},setHUDColor:function(t){this.data.hudColor="#ffffff",console.log(`üé® HUD mant√©m linhas brancas (cor solicitada: ${t})`);[this.hudElements.speedText,this.hudElements.altitudeText,this.hudElements.coordsText,this.hudElements.distanceText,this.hudElements.modeText,this.hudElements.objectiveText,this.hudElements.timeText].forEach(t=>{t&&t.setAttribute("color","#ffffff")}),this.hudElements.hudPlane&&this.hudElements.hudPlane.setAttribute("material.color","#ffffff"),this.showNotification("üé® LINHAS BRANCAS MANTIDAS","#ffffff")},remove:function(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.hudContainer&&this.hudContainer.parentNode&&this.hudContainer.parentNode.removeChild(this.hudContainer)}}),console.log("üì¶ M√≥dulo futuristic-hud.js carregado com sucesso!")),AFRAME.components["game-manager"]||(AFRAME.registerComponent("game-manager",{schema:{totalCheckpoints:{type:"number",default:5},timeLimit:{type:"number",default:120},bestTime:{type:"number",default:0}},init:function(){console.log("üéÆ Inicializando Game Manager..."),this.gameState={isPlaying:!1,isPaused:!1,isFinished:!1,startTime:0,currentTime:0,elapsedTime:0,remainingTime:1e3*this.data.timeLimit,score:0,checkpointsReached:0,currentLap:1,totalLaps:3,bestLapTime:0,currentLapStartTime:0,timeWarningShown:!1,timeCriticalShown:!1},this.uiElements={},this.setupEventListeners(),this.setupUI(),this.setupDebugControls(),this.setupPersistence(),console.log("‚úÖ Game Manager inicializado!")},setupEventListeners:function(){this.el.addEventListener("checkpoint-reached",this.onCheckpointReached.bind(this)),this.el.addEventListener("race-finished",this.onRaceFinished.bind(this)),this.el.addEventListener("game-start",this.startGame.bind(this)),this.el.addEventListener("game-pause",this.pauseGame.bind(this)),this.el.addEventListener("enter-vr",this.onEnterVR.bind(this)),this.el.addEventListener("exit-vr",this.onExitVR.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this))},setupUI:function(){console.log("üñ•Ô∏è Configurando interface do usu√°rio..."),this.uiElements={timer:document.querySelector("#timer"),checkpointCounter:document.querySelector("#checkpoint-counter"),speedometer:document.querySelector("#speedometer"),score:document.querySelector("#score"),lapCounter:document.querySelector("#lap-counter"),bestTime:document.querySelector("#best-time")},this.createMissingUIElements(),this.updateUI(),this.createMainMenu()},createMissingUIElements:function(){const t=document.querySelector("#hud-container")||this.createHUDContainer();this.uiElements.score||(this.uiElements.score=this.createElement("a-text",{id:"score",value:"PONTOS: 0",position:"-2 1.5 -3",color:"#00ff00",scale:"0.8 0.8 0.8"}),t.appendChild(this.uiElements.score)),this.uiElements.lapCounter||(this.uiElements.lapCounter=this.createElement("a-text",{id:"lap-counter",value:"VOLTA: 1/3",position:"2 1.5 -3",color:"#ffff00",scale:"0.8 0.8 0.8"}),t.appendChild(this.uiElements.lapCounter)),this.uiElements.bestTime||(this.uiElements.bestTime=this.createElement("a-text",{id:"best-time",value:"MELHOR: --:--",position:"0 -1.5 -3",color:"#ff6600",scale:"0.6 0.6 0.6"}),t.appendChild(this.uiElements.bestTime))},createHUDContainer:function(){const t=document.querySelector("#drone-camera");if(!t)return console.error("‚ùå C√¢mera n√£o encontrada! Verificando seletor..."),null;const e=this.createElement("a-entity",{id:"hud-container"});return t.appendChild(e),e},createElement:function(t,e){const i=document.createElement(t);for(const[t,o]of Object.entries(e))i.setAttribute(t,o);return i},createMainMenu:function(){const t=this.createElement("a-entity",{id:"main-menu",position:"0 2 -4",visible:!0}),e=this.createElement("a-text",{value:"DRONE RACING VR",position:"0 1 0",color:"#00ffff",scale:"2 2 2",align:"center"}),i=this.createElement("a-box",{id:"start-button",position:"0 0 0",width:"2",height:"0.5",depth:"0.1",color:"#00ff00",class:"clickable"}),o=this.createElement("a-text",{value:"INICIAR CORRIDA",position:"0 0 0.06",color:"#000000",scale:"0.8 0.8 0.8",align:"center"}),a=this.createElement("a-box",{id:"settings-button",position:"0 -0.8 0",width:"2",height:"0.5",depth:"0.1",color:"#ffaa00",class:"clickable"}),s=this.createElement("a-text",{value:"CONFIGURA√á√ïES",position:"0 0 0.06",color:"#000000",scale:"0.8 0.8 0.8",align:"center"});i.appendChild(o),a.appendChild(s),t.appendChild(e),t.appendChild(i),t.appendChild(a),i.addEventListener("click",()=>{this.hideMainMenu(),this.startGame()}),this.el.appendChild(t),this.mainMenu=t},setupDebugControls:function(){this.debugMode=!1,this.debugPanel=null},setupPersistence:function(){this.loadGameData()},startGame:function(){console.log("üöÄ Iniciando corrida..."),this.gameState.isPlaying||(this.gameState.isPlaying=!0,this.gameState.isPaused=!1,this.gameState.isFinished=!1,this.gameState.startTime=Date.now(),this.gameState.currentLapStartTime=Date.now(),this.gameState.elapsedTime=0,this.gameState.score=0,this.gameState.checkpointsReached=0,this.gameState.currentLap=1,this.resetAllCheckpoints(),this.startTimer(),this.enableDroneControls(),this.updateUI(),this.el.emit("game-started"),console.log("‚úÖ Corrida iniciada!"))},pauseGame:function(){this.gameState.isPlaying&&!this.gameState.isPaused&&(console.log("‚è∏Ô∏è Pausando jogo..."),this.gameState.isPaused=!0,this.stopTimer(),this.disableDroneControls(),this.showPauseMenu(),this.el.emit("game-paused"))},showPauseMenu:function(){console.log("Exibindo menu de pausa");const t=document.querySelector("#pause-menu");t?t.style.display="flex":(console.warn("Menu de pausa n√£o encontrado no DOM"),this.createPauseMenu())},hidePauseMenu:function(){console.log("Ocultando menu de pausa");const t=document.querySelector("#pause-menu");t&&(t.style.display="none")},createPauseMenu:function(){console.log("Criando menu de pausa");const t=document.createElement("div");t.id="pause-menu",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="9999";const e=document.createElement("h1");e.textContent="JOGO PAUSADO",e.style.color="white",e.style.marginBottom="20px";const i=document.createElement("button");i.textContent="CONTINUAR",i.style.padding="10px 20px",i.style.fontSize="18px",i.style.margin="10px",i.style.cursor="pointer",i.onclick=()=>{document.querySelector("[game-manager]").components["game-manager"].resumeGame()},t.appendChild(e),t.appendChild(i),document.body.appendChild(t)},resumeGame:function(){this.gameState.isPaused&&(console.log("‚ñ∂Ô∏è Retomando jogo..."),this.gameState.isPaused=!1,this.gameState.startTime=Date.now()-this.gameState.elapsedTime,this.startTimer(),this.enableDroneControls(),this.hidePauseMenu(),this.el.emit("game-resumed"))},resetGame:function(){console.log("üîÑ Resetando jogo..."),console.trace("üîç Stack trace do resetGame:"),this.gameOverScreen&&this.gameOverScreen.parentNode&&(this.gameOverScreen.parentNode.removeChild(this.gameOverScreen),this.gameOverScreen=null),this.gameState.isPlaying=!1,this.gameState.isPaused=!1,this.gameState.isFinished=!1,this.gameState.elapsedTime=0,this.gameState.remainingTime=1e3*this.data.timeLimit,this.gameState.score=0,this.gameState.checkpointsReached=0,this.gameState.currentLap=1,this.gameState.timeWarningShown=!1,this.gameState.timeCriticalShown=!1,this.stopTimer(),this.resetAllCheckpoints(),this.resetDrone(),this.updateUI(),this.showMainMenu()},finishGame:function(){console.log("üèÅ Finalizando corrida..."),this.gameState.isPlaying=!1,this.gameState.isFinished=!0,this.stopTimer(),this.disableDroneControls(),this.calculateFinalScore(),this.saveBestTime();const t=this.isNewHighScore();this.saveHighScore(),t&&console.log("üéâ NOVO RECORDE! Parab√©ns!"),this.showHighScores(),this.showResultsScreen(),this.el.emit("game-finished",{finalScore:this.gameState.score,finalTime:this.gameState.elapsedTime,checkpointsReached:this.gameState.checkpointsReached})},onCheckpointReached:function(t){const e=t.detail;console.log(`üéØ Checkpoint ${e.id} alcan√ßado!`),this.gameState.checkpointsReached++,this.gameState.score+=e.points,e.timeBonus&&(this.gameState.elapsedTime-=1e3*e.timeBonus),this.gameState.checkpointsReached>=this.data.totalCheckpoints&&this.completeLap(),this.updateUI(),this.saveGameData()},onCollision:function(t,e){console.log(`üí• Colis√£o registrada: ${t}`),this.gameState.collisions||(this.gameState.collisions=0),this.gameState.collisions++;const i=this.getCollisionPenalty(t);i>0&&(this.gameState.score=Math.max(0,this.gameState.score-i),console.log(`‚ö†Ô∏è Penalidade de ${i} pontos por colis√£o!`)),this.updateUI(),this.el.emit("collision-registered",{type:t,object:e,totalCollisions:this.gameState.collisions,penalty:i})},getCollisionPenalty:function(t){switch(t){case"building":return 50;case"obstacle":return 30;case"boundary":return 20;case"ceiling":return 10;case"ground":return 15;default:return 0}},onRaceFinished:function(t){this.el.sceneEl.emit("race-finished",{result:"victory"}),this.finishGame()},finishRace:function(t){"timeout"===t&&(console.log("‚è∞ Tempo esgotado!"),this.el.sceneEl.emit("race-finished",{result:"timeout"})),this.finishGame()},completeLap:function(){const t=Date.now()-this.gameState.currentLapStartTime;console.log(`üèÅ Volta ${this.gameState.currentLap} completada em ${this.formatTime(t)}!`),(0===this.gameState.bestLapTime||t<this.gameState.bestLapTime)&&(this.gameState.bestLapTime=t,console.log("üèÜ Novo recorde de volta!")),this.gameState.currentLap<this.gameState.totalLaps?(this.gameState.currentLap++,this.gameState.currentLapStartTime=Date.now(),this.gameState.checkpointsReached=0,this.resetAllCheckpoints(),this.showLapNotification()):this.finishGame()},startTimer:function(){this.timerInterval=setInterval(()=>{this.gameState.isPaused||(this.gameState.currentTime=Date.now(),this.gameState.elapsedTime=this.gameState.currentTime-this.gameState.startTime,this.updateTimer())},100)},stopTimer:function(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)},updateTimer:function(){if(this.gameState.remainingTime=1e3*this.data.timeLimit-this.gameState.elapsedTime,this.uiElements.timer){const t=Math.max(0,this.gameState.remainingTime);this.uiElements.timer.setAttribute("value",`TEMPO: ${this.formatTime(t)}`);const e=t/1e3;e<=10?(this.uiElements.timer.setAttribute("color","#ff0000"),this.uiElements.timer.setAttribute("scale","1.2 1.2 1.2"),this.gameState.timeCriticalShown||(this.showTimeWarning("TEMPO CR√çTICO!","#ff0000"),this.gameState.timeCriticalShown=!0)):e<=30?(this.uiElements.timer.setAttribute("color","#ff8800"),this.uiElements.timer.setAttribute("scale","1.1 1.1 1.1"),this.gameState.timeWarningShown||(this.showTimeWarning("ATEN√á√ÉO: Tempo acabando!","#ff8800"),this.gameState.timeWarningShown=!0)):(this.uiElements.timer.setAttribute("color","#00ff00"),this.uiElements.timer.setAttribute("scale","1.0 1.0 1.0"))}this.gameState.remainingTime<=0&&this.gameState.isPlaying&&this.onTimeUp()},formatTime:function(t){const e=Math.floor(t/1e3),i=Math.floor(e/60),o=e%60,a=Math.floor(t%1e3/10);return`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${a.toString().padStart(2,"0")}`},showTimeWarning:function(t,e){const i=document.createElement("a-text");i.setAttribute("value",t),i.setAttribute("color",e),i.setAttribute("position","0 2 -3"),i.setAttribute("align","center"),i.setAttribute("scale","2 2 2"),i.setAttribute("animation","property: scale; to: 2.5 2.5 2.5; dur: 500; dir: alternate; loop: 3"),this.el.sceneEl.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},3e3),console.log(`‚è∞ ${t}`)},onTimeUp:function(){console.log("‚è∞ Tempo esgotado! Game Over"),this.gameState.isPlaying=!1,this.gameState.isFinished=!0,this.stopTimer(),this.disableDroneControls(),this.showGameOverScreen("TEMPO ESGOTADO!"),this.el.emit("game-over",{reason:"timeout",score:this.gameState.score,checkpoints:this.gameState.checkpointsReached,timeElapsed:this.gameState.elapsedTime})},showGameOverScreen:function(t){const e=document.createElement("a-entity");e.setAttribute("id","game-over-screen"),e.setAttribute("position","0 0 -5");const i=document.createElement("a-plane");i.setAttribute("width","10"),i.setAttribute("height","6"),i.setAttribute("color","#000000"),i.setAttribute("opacity","0.8"),e.appendChild(i);const o=document.createElement("a-text");o.setAttribute("value",t),o.setAttribute("color","#ff0000"),o.setAttribute("position","0 1.5 0.1"),o.setAttribute("align","center"),o.setAttribute("scale","3 3 3"),e.appendChild(o);const a=document.createElement("a-text"),s=[`PONTUA√á√ÉO FINAL: ${this.gameState.score}`,`CHECKPOINTS: ${this.gameState.checkpointsReached}/${this.data.totalCheckpoints}`,`TEMPO DECORRIDO: ${this.formatTime(this.gameState.elapsedTime)}`,"","Pressione R para reiniciar"].join("\n");a.setAttribute("value",s),a.setAttribute("color","#ffffff"),a.setAttribute("position","0 -0.5 0.1"),a.setAttribute("align","center"),a.setAttribute("scale","1.5 1.5 1.5"),e.appendChild(a),this.el.sceneEl.appendChild(e),this.gameOverScreen=e},updateUI:function(){this.updateTimer(),this.uiElements.checkpointCounter&&this.uiElements.checkpointCounter.setAttribute("value",`CHECKPOINT: ${this.gameState.checkpointsReached}/${this.data.totalCheckpoints}`),this.uiElements.score&&this.uiElements.score.setAttribute("value",`PONTOS: ${this.gameState.score}`),this.uiElements.lapCounter&&this.uiElements.lapCounter.setAttribute("value",`VOLTA: ${this.gameState.currentLap}/${this.gameState.totalLaps}`),this.uiElements.bestTime&&this.data.bestTime>0&&this.uiElements.bestTime.setAttribute("value",`MELHOR: ${this.formatTime(this.data.bestTime)}`)},hideMainMenu:function(){this.mainMenu&&this.mainMenu.setAttribute("visible",!1)},showMainMenu:function(){this.mainMenu&&this.mainMenu.setAttribute("visible",!0)},onKeyDown:function(t){switch(t.key.toLowerCase()){case" ":this.gameState.isPlaying&&!this.gameState.isPaused?this.pauseGame():this.gameState.isPaused&&this.resumeGame();break;case"r":this.resetGame();break;case"enter":this.gameState.isPlaying||this.startGame()}},resetAllCheckpoints:function(){document.querySelectorAll("[checkpoint]").forEach(t=>{t.components&&t.components.checkpoint&&"function"==typeof t.components.checkpoint.reset&&t.components.checkpoint.reset()})},enableDroneControls:function(){const t=document.querySelector("#drone");t&&t.components["drone-controller"]&&(t.components["drone-controller"].enabled=!0)},disableDroneControls:function(){const t=document.querySelector("#drone");t&&t.components["drone-controller"]&&(t.components["drone-controller"].enabled=!1)},resetDrone:function(){const t=document.querySelector("#drone");t&&t.components["drone-controller"]&&t.components["drone-controller"].resetDronePosition()},addScore:function(t){this.gameState.score+=t,this.updateUI(),console.log(`üí∞ Score atualizado: ${this.gameState.score} pontos`)},calculateFinalScore:function(){const t=Math.max(0,(1e3*this.data.timeLimit-this.gameState.elapsedTime)/1e3);this.gameState.score+=Math.floor(10*t),this.gameState.score+=1e3*(this.gameState.currentLap-1)},saveBestTime:function(){this.gameState.currentLap>=this.gameState.totalLaps&&(0===this.data.bestTime||this.gameState.elapsedTime<this.data.bestTime)&&(this.data.bestTime=this.gameState.elapsedTime,this.saveGameData(),console.log("üèÜ Novo recorde geral!"))},saveGameData:function(){const t={bestTime:this.data.bestTime,bestLapTime:this.gameState.bestLapTime,totalGames:(this.loadedData?.totalGames||0)+(this.gameState.isFinished?1:0)};localStorage.setItem("droneRacingVR",JSON.stringify(t))},loadGameData:function(){try{const t=localStorage.getItem("droneRacingVR");t&&(this.loadedData=JSON.parse(t),this.data.bestTime=this.loadedData.bestTime||0,this.gameState.bestLapTime=this.loadedData.bestLapTime||0)}catch(t){console.warn("Erro ao carregar dados salvos:",t)}},saveHighScore:function(){try{let t=JSON.parse(localStorage.getItem("droneRacingHighScores")||"[]");const e={score:this.gameState.score,time:this.gameState.elapsedTime,date:(new Date).toISOString(),checkpoints:this.gameState.checkpointsReached,laps:this.gameState.currentLap-1};return t.push(e),t.sort((t,e)=>e.score-t.score),t=t.slice(0,10),localStorage.setItem("droneRacingHighScores",JSON.stringify(t)),console.log("üèÜ Pontua√ß√£o salva no ranking!"),t}catch(t){return console.warn("Erro ao salvar ranking:",t),[]}},getHighScores:function(){try{return JSON.parse(localStorage.getItem("droneRacingHighScores")||"[]")}catch(t){return console.warn("Erro ao carregar ranking:",t),[]}},showHighScores:function(){const t=this.getHighScores();return console.log("üèÜ === RANKING DE MAIORES PONTUA√á√ïES ==="),t.forEach((t,e)=>{const i=this.formatTime(t.time),o=new Date(t.date).toLocaleDateString("pt-BR");console.log(`${e+1}¬∫ - ${t.score} pts | ${i} | ${o}`)}),t},isNewHighScore:function(){const t=this.getHighScores();return t.length<10||this.gameState.score>t[t.length-1].score},onEnterVR:function(){console.log("ü•Ω Entrando no modo VR...")},onExitVR:function(){console.log("üñ•Ô∏è Saindo do modo VR...")}}),console.log("üì¶ M√≥dulo game-manager.js carregado com sucesso!")),AFRAME.components["hud-controller"]||(AFRAME.registerComponent("hud-controller",{schema:{enabled:{type:"boolean",default:!0},transparency:{type:"number",default:1},hudWidth:{type:"number",default:3.5},hudHeight:{type:"number",default:2.5},hudDistance:{type:"number",default:2},parallaxIntensity:{type:"number",default:.03},smoothingFactor:{type:"number",default:.1}},init:function(){console.log("üéØ Inicializando HUD Controller Centralizado..."),this.setupHUDData(),this.setupParallax(),this.setupKeyboardControls(),setTimeout(()=>{this.createHUD(),this.startUpdateLoop()},500),console.log("‚úÖ HUD Controller inicializado!")},setupHUDData:function(){this.hudData={speed:0,altitude:0,battery:100,mode:"CINEMATOGR√ÅFICO",objective:"CHECKPOINT 1",distance:120,coordinates:{x:0,y:0,z:0}},this.hudElements={},this.startTime=Date.now()},setupParallax:function(){this.parallax={lastDronePosition:{x:0,y:0,z:0},currentOffset:{x:0,y:0,z:0},targetOffset:{x:0,y:0,z:0},basePosition:{x:0,y:0,z:-this.data.hudDistance}}},setupKeyboardControls:function(){console.log("üéÆ Configurando controles do HUD..."),document.addEventListener("keydown",t=>{switch(t.key.toLowerCase()){case"h":this.toggleHUD();break;case"u":this.cycleTransparency();break;case"k":this.reloadHUD();break;case"+":case"=":this.changeHUDSize(.1);break;case"-":case"_":this.changeHUDSize(-.1);break;case"0":this.resetHUD()}})},createHUD:function(){console.log("üèóÔ∏è Criando HUD totalmente transparente..."),this.hudContainer=document.createElement("a-entity"),this.hudContainer.setAttribute("id","hud-container"),this.hudContainer.setAttribute("position",`${this.parallax.basePosition.x} ${this.parallax.basePosition.y} ${this.parallax.basePosition.z}`),this.createTransparentHUD(),this.createDataElements(),this.el.appendChild(this.hudContainer),console.log("‚úÖ HUD transparente criado!")},createTransparentHUD:function(){const t=document.createElement("a-plane");t.setAttribute("width",this.data.hudWidth),t.setAttribute("height",this.data.hudHeight),t.setAttribute("position","0 0 0");const e=Date.now();t.setAttribute("material",{src:`assets/hud-01.svg?v=${e}`,transparent:!0,opacity:this.data.transparency,alphaTest:.01,color:"#ffffff",shader:"flat",side:"front"}),this.hudContainer.appendChild(t),this.hudElements.hudPlane=t,console.log("üéØ HUD SVG carregado sem fundo")},createDataElements:function(){this.hudElements.speedText=this.createTextElement({id:"speed-text",value:"96",position:"-1.2 0.4 0.01",scale:"0.7 0.7 0.7"}),this.hudElements.batteryText=this.createTextElement({id:"battery-text",value:"87%",position:"1.2 0.4 0.01",scale:"0.6 0.6 0.6"}),this.hudElements.altitudeText=this.createTextElement({id:"altitude-text",value:"450",position:"-1.2 -0.4 0.01",scale:"0.7 0.7 0.7"}),this.hudElements.distanceText=this.createTextElement({id:"distance-text",value:"120M",position:"1.2 -0.2 0.01",scale:"0.5 0.5 0.5"}),this.hudElements.modeText=this.createTextElement({id:"mode-text",value:"CINEMATIC",position:"-0.5 -0.8 0.01",scale:"0.4 0.4 0.4"}),this.hudElements.objectiveText=this.createTextElement({id:"objective-text",value:"CHECKPOINT 1",position:"0.5 -0.6 0.01",scale:"0.4 0.4 0.4"}),this.hudElements.coordsText=this.createTextElement({id:"coords-text",value:"X:0 Y:450 Z:0",position:"0.5 1.0 0.01",scale:"0.3 0.3 0.3"}),this.hudElements.timeText=this.createTextElement({id:"time-text",value:"02:34",position:"0 1.0 0.01",scale:"0.3 0.3 0.3"}),this.createCenterIndicator()},createTextElement:function(t){const e=document.createElement("a-text");return e.setAttribute("id",t.id),e.setAttribute("value",t.value),e.setAttribute("position",t.position),e.setAttribute("align","center"),e.setAttribute("color","#ffffff"),e.setAttribute("scale",t.scale),e.setAttribute("font","monospace"),this.hudContainer.appendChild(e),e},createCenterIndicator:function(){const t=document.createElement("a-circle");t.setAttribute("id","center-indicator"),t.setAttribute("radius","0.02"),t.setAttribute("position","0 0 0.02"),t.setAttribute("material",{color:"#ffff00",transparent:!0,opacity:.8}),t.setAttribute("animation",{property:"material.opacity",to:"0.3",dur:2e3,dir:"alternate",loop:!0}),this.hudContainer.appendChild(t),this.hudElements.centerIndicator=t},startUpdateLoop:function(){this.updateHUD()},updateHUD:function(){this.data.enabled&&(this.updateDroneData(),this.updateParallax(),this.updateVisualElements(),requestAnimationFrame(()=>this.updateHUD()))},updateDroneData:function(){const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=t.components["drone-controller"];this.hudData.coordinates={x:Math.round(e.x),y:Math.round(e.y),z:Math.round(e.z)},i&&i.velocity&&(this.hudData.speed=Math.round(3.6*i.velocity.length())),this.hudData.altitude=Math.round(e.y);const o=(Date.now()-this.startTime)/1e3;this.hudData.battery=Math.max(10,100-Math.floor(o/10)),i&&(i.cinematicMode?.enabled?this.hudData.mode="CINEMATIC":i.fpvMode?.enabled?this.hudData.mode="FPV/SPORT":this.hudData.mode="NORMAL"),this.calculateDistanceToCheckpoint()},updateParallax:function(){const t=document.querySelector("#drone");if(!t||!this.hudContainer)return;const e=t.getAttribute("position"),i=e.x-this.parallax.lastDronePosition.x,o=e.y-this.parallax.lastDronePosition.y,a=e.z-this.parallax.lastDronePosition.z;this.parallax.targetOffset.x+=i*this.data.parallaxIntensity,this.parallax.targetOffset.y+=o*this.data.parallaxIntensity*.5,this.parallax.targetOffset.z+=a*this.data.parallaxIntensity*.3,this.parallax.currentOffset.x+=(this.parallax.targetOffset.x-this.parallax.currentOffset.x)*this.data.smoothingFactor,this.parallax.currentOffset.y+=(this.parallax.targetOffset.y-this.parallax.currentOffset.y)*this.data.smoothingFactor,this.parallax.currentOffset.z+=(this.parallax.targetOffset.z-this.parallax.currentOffset.z)*this.data.smoothingFactor;const s=.1;this.parallax.currentOffset.x=Math.max(-.1,Math.min(s,this.parallax.currentOffset.x)),this.parallax.currentOffset.y=Math.max(-.1,Math.min(s,this.parallax.currentOffset.y)),this.parallax.currentOffset.z=Math.max(-.1,Math.min(s,this.parallax.currentOffset.z));const n={x:this.parallax.basePosition.x+this.parallax.currentOffset.x,y:this.parallax.basePosition.y+this.parallax.currentOffset.y,z:this.parallax.basePosition.z+this.parallax.currentOffset.z};this.hudContainer.setAttribute("position",n),this.parallax.lastDronePosition={...e}},updateVisualElements:function(){if(this.hudElements.speedText&&this.hudElements.speedText.setAttribute("value",this.hudData.speed.toString()),this.hudElements.batteryText){this.hudElements.batteryText.setAttribute("value",`${this.hudData.battery}%`);const t=this.hudData.battery<20?"#ff4444":this.hudData.battery<50?"#ffaa00":"#ffffff";this.hudElements.batteryText.setAttribute("color",t)}if(this.hudElements.altitudeText&&this.hudElements.altitudeText.setAttribute("value",this.hudData.altitude.toString()),this.hudElements.distanceText&&this.hudElements.distanceText.setAttribute("value",`${this.hudData.distance}M`),this.hudElements.modeText&&this.hudElements.modeText.setAttribute("value",this.hudData.mode),this.hudElements.objectiveText&&this.hudElements.objectiveText.setAttribute("value",this.hudData.objective),this.hudElements.coordsText&&this.hudElements.coordsText.setAttribute("value",`X:${this.hudData.coordinates.x} Y:${this.hudData.coordinates.y} Z:${this.hudData.coordinates.z}`),this.hudElements.timeText){const t=Math.floor((Date.now()-this.startTime)/1e3),e=Math.floor(t/60),i=t%60;this.hudElements.timeText.setAttribute("value",`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`)}},calculateDistanceToCheckpoint:function(){const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position"),i=document.querySelectorAll("[checkpoint]");let o=999;i.forEach(t=>{const i=t.getAttribute("position"),a=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2));a<o&&(o=a)}),this.hudData.distance=Math.round(o)},toggleHUD:function(){this.data.enabled=!this.data.enabled,this.hudContainer&&this.hudContainer.setAttribute("visible",this.data.enabled),this.showNotification(this.data.enabled?"üéØ HUD ATIVADO":"üéØ HUD DESATIVADO"),console.log("HUD "+(this.data.enabled?"ATIVADO":"DESATIVADO"))},cycleTransparency:function(){const t=[.3,.5,.7,.9,1],e=(t.indexOf(this.data.transparency)+1)%t.length;this.data.transparency=t[e],this.hudElements.hudPlane&&this.hudElements.hudPlane.setAttribute("material.opacity",this.data.transparency);const i=Math.round(100*this.data.transparency);this.showNotification(`üîç TRANSPAR√äNCIA: ${i}%`),console.log(`Transpar√™ncia: ${i}%`)},reloadHUD:function(){console.log("üîÑ Recarregando HUD..."),this.hudContainer&&this.hudContainer.parentNode.removeChild(this.hudContainer),setTimeout(()=>{this.createHUD(),this.showNotification("üéØ HUD RECARREGADO!"),console.log("‚úÖ HUD recarregado com sucesso!")},100)},changeHUDSize:function(t){this.data.hudWidth=Math.max(2,Math.min(6,this.data.hudWidth+t)),this.data.hudHeight=Math.max(1.5,Math.min(4.5,this.data.hudHeight+.75*t)),this.hudElements.hudPlane&&(this.hudElements.hudPlane.setAttribute("width",this.data.hudWidth),this.hudElements.hudPlane.setAttribute("height",this.data.hudHeight)),this.showNotification(`üìè TAMANHO: ${this.data.hudWidth.toFixed(1)}x${this.data.hudHeight.toFixed(1)}`)},resetHUD:function(){this.data.hudWidth=3.5,this.data.hudHeight=2.5,this.data.transparency=1,this.data.hudDistance=2,this.reloadHUD(),this.showNotification("üîÑ HUD RESETADO")},showNotification:function(t,e=2e3){console.log(`üì¢ ${t}`);const i=document.createElement("a-text");i.setAttribute("value",t),i.setAttribute("color","#ffffff"),i.setAttribute("position","0 0.5 -1.5"),i.setAttribute("align","center"),i.setAttribute("scale","1.2 1.2 1.2"),i.setAttribute("animation__fade",{property:"material.opacity",from:1,to:0,dur:e,delay:500}),this.el.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},e+1e3)},remove:function(){this.hudContainer&&this.hudContainer.parentNode&&this.hudContainer.parentNode.removeChild(this.hudContainer)}}),console.log("üì¶ HUD Controller carregado com sucesso!")),AFRAME.registerComponent("navigation-arrow",{schema:{targetCheckpoint:{type:"number",default:1},distance:{type:"number",default:2},size:{type:"number",default:.4},color:{type:"color",default:"#00ff00"},showDistance:{type:"boolean",default:!0},showPhase:{type:"boolean",default:!0},showPath:{type:"boolean",default:!0},pathArrows:{type:"number",default:3}},init:function(){this.currentTarget=null,this.checkpoints=[],this.dronePosition=new THREE.Vector3,this.targetPosition=new THREE.Vector3,this.totalCheckpoints=0,this.pathArrows=[],this.createArrowElements(),this.setupEventListeners(),setTimeout(()=>{this.findCheckpoints(),this.updateTarget(),this.startNavigation()},1e3)},createArrowElements:function(){this.arrowContainer=document.createElement("a-entity"),this.arrowContainer.setAttribute("id","navigation-arrow-container"),this.arrowContainer.setAttribute("data-arrow-container","true"),this.el.appendChild(this.arrowContainer),this.arrowMesh=document.createElement("a-entity"),this.arrowMesh.setAttribute("data-arrow-mesh","true"),this.arrowMesh.setAttribute("geometry",{primitive:"cone",radiusBottom:.4*this.data.size,radiusTop:0,height:2*this.data.size}),this.arrowMesh.setAttribute("material",{color:this.data.color,emissive:this.data.color,emissiveIntensity:.5,transparent:!0,opacity:.9}),this.arrowMesh.setAttribute("position",`0 0.2 -${this.data.distance+1}`),this.arrowMesh.setAttribute("rotation","90 0 0"),this.arrowMesh.setAttribute("animation__pulse",{property:"scale",to:"1.3 1.3 1.3",dur:800,direction:"alternate",loop:!0,easing:"easeInOutSine"}),this.arrowMesh.setAttribute("animation__spin",{property:"rotation",to:"90 360 0",dur:3e3,loop:!0,easing:"linear"}),this.arrowContainer.appendChild(this.arrowMesh),this.highlightRing=document.createElement("a-entity"),this.highlightRing.setAttribute("geometry",{primitive:"torus",radius:.8*this.data.size,radiusTubular:.05}),this.highlightRing.setAttribute("material",{color:this.data.color,emissive:this.data.color,emissiveIntensity:.3,transparent:!0,opacity:.6}),this.highlightRing.setAttribute("position",`0 0.5 -${this.data.distance}`),this.highlightRing.setAttribute("rotation","0 0 0"),this.highlightRing.setAttribute("animation__ring",{property:"rotation",to:"0 0 360",dur:2e3,loop:!0,easing:"linear"}),this.arrowContainer.appendChild(this.highlightRing),this.data.showDistance&&(this.distanceText=document.createElement("a-text"),this.distanceText.setAttribute("data-distance-text","true"),this.distanceText.setAttribute("value","0m"),this.distanceText.setAttribute("position",`0 -0.5 -${this.data.distance}`),this.distanceText.setAttribute("align","center"),this.distanceText.setAttribute("color",this.data.color),this.distanceText.setAttribute("scale","1.2 1.2 1.2"),this.distanceText.setAttribute("font","dejavu"),this.arrowContainer.appendChild(this.distanceText)),this.data.showPhase&&(this.phaseText=document.createElement("a-text"),this.phaseText.setAttribute("data-phase-text","true"),this.phaseText.setAttribute("value","FASE 1"),this.phaseText.setAttribute("position",`0 1.7 -${this.data.distance}`),this.phaseText.setAttribute("align","center"),this.phaseText.setAttribute("color","#ffffff"),this.phaseText.setAttribute("scale","1.0 1.0 1.0"),this.phaseText.setAttribute("font","dejavu"),this.phaseBackground=document.createElement("a-entity"),this.phaseBackground.setAttribute("geometry",{primitive:"plane",width:2,height:.5}),this.phaseBackground.setAttribute("material",{color:"#000000",transparent:!0,opacity:.7}),this.phaseBackground.setAttribute("position",`0 1.7 -${this.data.distance+.01}`),this.arrowContainer.appendChild(this.phaseBackground),this.arrowContainer.appendChild(this.phaseText)),this.connectionLine=document.createElement("a-entity"),this.connectionLine.setAttribute("geometry",{primitive:"cylinder",radius:.03,height:1}),this.connectionLine.setAttribute("material",{color:this.data.color,emissive:this.data.color,emissiveIntensity:.3,transparent:!0,opacity:.6}),this.connectionLine.setAttribute("position","0 0.25 -"+.5*this.data.distance),this.connectionLine.setAttribute("rotation","90 0 0"),this.connectionLine.setAttribute("animation__glow",{property:"material.emissiveIntensity",to:"0.8",dur:1500,direction:"alternate",loop:!0,easing:"easeInOutSine"}),this.arrowContainer.appendChild(this.connectionLine),this.data.showPath&&this.createPathArrows()},createPathArrows:function(){this.clearPathArrows();this.checkpoints.filter(t=>!t.reached).slice(0,this.data.pathArrows).forEach((t,e)=>{if(0===e)return;const i=document.createElement("a-cone");i.setAttribute("geometry",{radiusBottom:.6*this.data.size,radiusTop:0,height:1.5*this.data.size});const o=["#ffff00","#ff8800","#ff0088"][e-1]||"#888888";i.setAttribute("material",{color:o,emissive:o,emissiveIntensity:.3,transparent:!0,opacity:.6}),i.setAttribute("rotation","90 0 0"),i.setAttribute("scale","0.8 0.8 0.8"),i.setAttribute("animation__pulse",{property:"scale",to:"1.0 1.0 1.0",dur:1500,direction:"alternate",loop:!0,easing:"easeInOutSine"}),this.pathArrows.push({element:i,checkpoint:t,index:e}),this.arrowContainer.appendChild(i)})},clearPathArrows:function(){this.pathArrows.forEach(t=>{t.element.parentNode&&t.element.parentNode.removeChild(t.element)}),this.pathArrows=[]},setupEventListeners:function(){this.el.sceneEl.addEventListener("checkpoint-reached",this.onCheckpointReached.bind(this)),this.el.sceneEl.addEventListener("game-reset",this.onGameReset.bind(this))},findCheckpoints:function(){const t=document.querySelectorAll("[checkpoint]");this.checkpoints=[],t.forEach((t,e)=>{const i=t.getAttribute("checkpoint"),o=t.getAttribute("position");i&&o&&this.checkpoints.push({id:i.id,element:t,position:new THREE.Vector3(o.x,o.y,o.z),reached:!1})}),this.checkpoints.sort((t,e)=>t.id-e.id)},updateTarget:function(){if(this.currentTarget=this.checkpoints.find(t=>!t.reached),this.currentTarget){if(this.arrowContainer.setAttribute("visible",!0),this.phaseText){const t=this.currentTarget.id,e=this.checkpoints.length;this.phaseText.setAttribute("value",`FASE ${t}/${e}`)}this.data.showPath&&this.createPathArrows()}else this.arrowContainer.setAttribute("visible",!1),this.clearPathArrows()},startNavigation:function(){console.log("üß≠ Sistema de navega√ß√£o iniciado"),this.updateArrowVisibility(!0),this.data.showPath&&0===this.pathArrows.length&&this.createPathArrows()},updateArrowVisibility:function(t){this.arrowContainer&&this.arrowContainer.setAttribute("visible",t)},tick:function(t,e){if(!this.currentTarget)return;const i=document.querySelector("#drone");if(!i)return;const o=i.getAttribute("position");this.dronePosition.set(o.x,o.y,o.z),this.targetPosition.copy(this.currentTarget.position);const a=this.targetPosition.clone().sub(this.dronePosition),s=a.length();a.normalize();const n=Math.atan2(a.x,a.z);this.arrowContainer.setAttribute("rotation",`0 ${THREE.MathUtils.radToDeg(n)} 0`),this.distanceText&&this.distanceText.setAttribute("value",`${s.toFixed(0)}m`);const r=Math.max(.3,Math.min(1,50/s));this.arrowMesh.setAttribute("material","emissiveIntensity",r);const l=Math.min(this.data.distance,.1*s);this.connectionLine.setAttribute("geometry","height",l),this.connectionLine.setAttribute("position","0 0 -"+.5*l),this.updatePathArrows()},updatePathArrows:function(){if(!this.data.showPath||0===this.pathArrows.length)return;const t=document.querySelector("#drone");if(!t)return;const e=t.getAttribute("position");this.pathArrows.forEach((t,i)=>{const o=t.checkpoint;if(!o)return;const a=o.position.clone().sub(new THREE.Vector3(e.x,e.y,e.z)),s=a.length();a.normalize();const n=this.data.distance+1.5*i,r=a.multiplyScalar(n);t.element.setAttribute("position",`${r.x} ${r.y+.2} ${r.z}`);const l=Math.atan2(a.x,a.z);t.element.setAttribute("rotation",`90 ${THREE.MathUtils.radToDeg(l)} 0`);const h=Math.max(.3,Math.min(.8,100/s));t.element.setAttribute("material","opacity",h)})},onCheckpointReached:function(t){const e=t.detail.id,i=this.checkpoints.find(t=>t.id===e);i&&(i.reached=!0,console.log(`‚úÖ Checkpoint ${e} marcado como alcan√ßado`)),this.updateTarget()},onGameReset:function(){this.checkpoints.forEach(t=>{t.reached=!1}),this.updateTarget()},remove:function(){this.arrowContainer&&this.arrowContainer.remove()}}),AFRAME.registerComponent("performance-monitor",{schema:{targetFPS:{type:"number",default:60},minFPS:{type:"number",default:45},maxFPS:{type:"number",default:90},monitorInterval:{type:"number",default:1e3},autoOptimize:{type:"boolean",default:!0},showStats:{type:"boolean",default:!0}},init(){console.log("üìä Inicializando monitor de performance..."),this.performanceData={fps:0,frameTime:0,memory:0,drawCalls:0,triangles:0,lastFrameTime:performance.now(),frameCount:0,fpsHistory:[],qualityLevel:"high"},this.optimizationSettings={high:{shadowMapSize:2048,fogFar:200,lodDistance:80,particleCount:100},medium:{shadowMapSize:1024,fogFar:150,lodDistance:60,particleCount:50},low:{shadowMapSize:512,fogFar:100,lodDistance:40,particleCount:25}},this.setupPerformanceMonitoring(),this.createStatsDisplay(),this.startMonitoring()},setupPerformanceMonitoring(){this.fpsCounter={startTime:performance.now(),frameCount:0},this.originalRender=this.el.sceneEl.renderer.render,this.el.sceneEl.renderer.render=(t,e)=>{this.updatePerformanceMetrics(),this.originalRender.call(this.el.sceneEl.renderer,t,e)}},updatePerformanceMetrics(){const t=performance.now(),e=t-this.performanceData.lastFrameTime;this.performanceData.frameTime=e,this.performanceData.lastFrameTime=t,this.fpsCounter.frameCount++,t-this.fpsCounter.startTime>=1e3&&(this.performanceData.fps=Math.round(1e3*this.fpsCounter.frameCount/(t-this.fpsCounter.startTime)),this.performanceData.fpsHistory.push(this.performanceData.fps),this.performanceData.fpsHistory.length>10&&this.performanceData.fpsHistory.shift(),this.fpsCounter.frameCount=0,this.fpsCounter.startTime=t);const i=this.el.sceneEl.renderer;i.info&&(this.performanceData.drawCalls=i.info.render.calls,this.performanceData.triangles=i.info.render.triangles),performance.memory&&(this.performanceData.memory=Math.round(performance.memory.usedJSHeapSize/1024/1024))},createStatsDisplay(){this.data.showStats&&(this.statsPanel=document.createElement("div"),this.statsPanel.id="performance-stats",this.statsPanel.style.cssText="\n            position: fixed;\n            top: 10px;\n            right: 10px;\n            background: rgba(0, 0, 0, 0.8);\n            color: #00ff00;\n            padding: 10px;\n            border-radius: 5px;\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            z-index: 1000;\n            min-width: 200px;\n        ",document.body.appendChild(this.statsPanel))},updateStatsDisplay(){if(!this.statsPanel)return;const t=this.performanceData.fpsHistory.length>0?Math.round(this.performanceData.fpsHistory.reduce((t,e)=>t+e,0)/this.performanceData.fpsHistory.length):0,e=this.performanceData.fps>=this.data.targetFPS?"#00ff00":this.performanceData.fps>=this.data.minFPS?"#ffff00":"#ff0000";this.statsPanel.innerHTML=`\n            <div style="color: ${e}; font-weight: bold;">\n                FPS: ${this.performanceData.fps} (avg: ${t})\n            </div>\n            <div>Frame Time: ${this.performanceData.frameTime.toFixed(2)}ms</div>\n            <div>Memory: ${this.performanceData.memory}MB</div>\n            <div>Draw Calls: ${this.performanceData.drawCalls}</div>\n            <div>Triangles: ${this.performanceData.triangles}</div>\n            <div>Quality: ${this.performanceData.qualityLevel.toUpperCase()}</div>\n            <div style="margin-top: 5px; font-size: 10px;">\n                Target: ${this.data.targetFPS} FPS\n            </div>\n        `},startMonitoring(){this.monitorInterval=setInterval(()=>{this.updateStatsDisplay(),this.data.autoOptimize&&this.autoOptimizePerformance()},this.data.monitorInterval)},autoOptimizePerformance(){const t=this.performanceData.fpsHistory.length>0?this.performanceData.fpsHistory.reduce((t,e)=>t+e,0)/this.performanceData.fpsHistory.length:this.performanceData.fps;let e=this.performanceData.qualityLevel;t<this.data.minFPS?"high"===this.performanceData.qualityLevel?e="medium":"medium"===this.performanceData.qualityLevel&&(e="low"):t>this.data.targetFPS+10&&("low"===this.performanceData.qualityLevel?e="medium":"medium"===this.performanceData.qualityLevel&&(e="high")),e!==this.performanceData.qualityLevel&&(this.applyQualitySettings(e),this.performanceData.qualityLevel=e,console.log(`üéÆ Qualidade ajustada para: ${e} (FPS: ${t})`))},applyQualitySettings(t){const e=this.optimizationSettings[t],i=this.el.sceneEl;i.getAttribute("fog")&&i.setAttribute("fog",`far: ${e.fogFar}`);const o=i.components["urban-environment"];o&&o.lodSystem&&(o.lodSystem.maxDistance=e.lodDistance),this.el.emit("quality-changed",{level:t,settings:e})},setQuality(t){this.optimizationSettings[t]&&(this.applyQualitySettings(t),this.performanceData.qualityLevel=t)},getPerformanceData(){return{...this.performanceData}},toggleStats(){this.statsPanel&&(this.statsPanel.style.display="none"===this.statsPanel.style.display?"block":"none")},remove(){this.monitorInterval&&clearInterval(this.monitorInterval),this.statsPanel&&document.body.removeChild(this.statsPanel),this.originalRender&&(this.el.sceneEl.renderer.render=this.originalRender)}}),window.PerformanceUtils={throttle(t,e){let i;return function(){const o=arguments,a=this;i||(t.apply(a,o),i=!0,setTimeout(()=>i=!1,e))}},debounce(t,e){let i;return function(...o){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),t(...o)},e)}},createObjectPool(t,e,i=10){const o=[];for(let e=0;e<i;e++)o.push(t());return{get:()=>o.length>0?o.pop():t(),release(t){e&&e(t),o.push(t)},size:()=>o.length}}},console.log("üì¶ M√≥dulo performance-monitor.js carregado com sucesso!"),AFRAME.registerComponent("urban-environment",{schema:{citySize:{type:"number",default:200},buildingCount:{type:"number",default:50},obstacleCount:{type:"number",default:30},treeCount:{type:"number",default:20},streetWidth:{type:"number",default:8},seed:{type:"number",default:12345},vrOptimized:{type:"boolean",default:!1},ultraLowPoly:{type:"boolean",default:!1}},init:function(){console.log("üèôÔ∏è Inicializando ambiente urbano..."),this.random=this.createSeededRandom(this.data.seed),this.urbanContainer=document.createElement("a-entity"),this.urbanContainer.setAttribute("id","urban-container"),this.el.appendChild(this.urbanContainer),this.generateStreets(),this.generateBuildings(),this.generateObstacles(),this.generateVegetation(),this.generateLighting(),this.generateSkybox(),console.log("‚úÖ Ambiente urbano criado com sucesso!")},setupVROptimizedLOD(){console.log("üîß Configurando LOD otimizado para VR..."),this.vrLOD={camera:null,buildings:[],updateInterval:null,updateFrequency:200},setTimeout(()=>{this.vrLOD.camera=document.querySelector("#drone-camera"),this.vrLOD.camera&&(this.collectBuildingsForVRLOD(),this.startVRLODUpdates())},1e3)},collectBuildingsForVRLOD(){const t=this.el.querySelectorAll('[data-building="true"]');this.vrLOD.buildings=Array.from(t).map(t=>({element:t,position:t.getAttribute("position")}))},startVRLODUpdates(){this.vrLOD.updateInterval=setInterval(()=>{this.updateVRLOD()},this.vrLOD.updateFrequency)},updateVRLOD(){if(!this.vrLOD.camera)return;const t=this.vrLOD.camera.getAttribute("position");t&&this.vrLOD.buildings.forEach(e=>{this.calculateDistance(t,e.position)>40?e.element.setAttribute("visible",!1):e.element.setAttribute("visible",!0)})},calculateDistance(t,e){const i=t.x-e.x,o=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+o*o+a*a)},remove(){this.vrLOD&&this.vrLOD.updateInterval&&clearInterval(this.vrLOD.updateInterval)},createSeededRandom:function(t){let e=2147483648,i=t||Math.floor(Math.random()*(e-1));return function(){return i=(1103515245*i+12345)%e,i/(e-1)}},generateStreets:function(){console.log("üõ£Ô∏è Ruas desabilitadas para cen√°rio limpo");const t=document.createElement("a-entity");t.setAttribute("id","streets"),this.urbanContainer.appendChild(t)},generateCityBlocks:function(t){console.log("üèòÔ∏è Quadras desabilitadas para otimiza√ß√£o VR")},generateBuildings:function(){console.log("üè¢ Pr√©dios desabilitados para cen√°rio limpo");const t=document.createElement("a-entity");t.setAttribute("id","buildings"),this.urbanContainer.appendChild(t),this.setupVROptimizedLOD()},createFuturisticBuilding:function(){const t=document.createElement("a-entity");t.classList.add("futuristic-building"),t.setAttribute("data-building","true");const e=this.data.ultraLowPoly?3+2*this.random():4+3*this.random(),i=this.data.ultraLowPoly?3+2*this.random():4+3*this.random(),o=this.data.ultraLowPoly?6+8*this.random():8+12*this.random(),a=document.createElement("a-box");a.setAttribute("geometry",{width:e,height:o,depth:i});const s=this.data.ultraLowPoly?[{color:"#1a1a2e",emissive:"#16213e"},{color:"#0f3460",emissive:"#0e6ba8"},{color:"#2d1b69",emissive:"#3f51b5"}]:[{color:"#1a1a2e",emissive:"#16213e"},{color:"#0f3460",emissive:"#0e6ba8"},{color:"#16537e",emissive:"#1e88e5"},{color:"#2d1b69",emissive:"#3f51b5"},{color:"#1a1a1a",emissive:"#00ffff"}],n=s[Math.floor(this.random()*s.length)],r=this.data.ultraLowPoly?{color:n.color,emissive:n.emissive,emissiveIntensity:.1,roughness:1,metalness:0}:{color:n.color,emissive:n.emissive,emissiveIntensity:.2,roughness:.1,metalness:.8};return a.setAttribute("material",r),a.setAttribute("position",`0 ${o/2} 0`),t.appendChild(a),this.data.ultraLowPoly||this.addFuturisticWindows(t,e,o,i),t},createBuilding:function(){return this.createFuturisticBuilding()},addFuturisticWindows:function(t,e,i,o){const a=2+Math.floor(2*this.random());for(let s=0;s<a;s++){const a=document.createElement("a-plane");a.setAttribute("geometry",{width:.6*e,height:2});const n=["#00ffff","#ff00ff","#ffff00","#00ff88","#ff8800"],r=n[Math.floor(this.random()*n.length)];a.setAttribute("material",{color:r,emissive:r,emissiveIntensity:.4,transparent:!0,opacity:.7});const l=.3*i+s*i*.3;a.setAttribute("position",`0 ${l} ${o/2+.01}`),t.appendChild(a)}},isOnStreet:function(t,e){const i=this.data.streetWidth;for(let e=-this.data.citySize;e<=this.data.citySize;e+=40)if(Math.abs(t-e)<i)return!0;for(let t=-this.data.citySize;t<=this.data.citySize;t+=50)if(Math.abs(e-t)<i)return!0;return!1},generateObstacles:function(){console.log("üöß Obst√°culos desabilitados para cen√°rio limpo");const t=document.createElement("a-entity");t.setAttribute("id","obstacles"),this.urbanContainer.appendChild(t)},createFuturisticObstacle:function(){const t=document.createElement("a-entity");if(t.setAttribute("class","futuristic-obstacle"),this.data.ultraLowPoly){const e=document.createElement("a-box");e.setAttribute("geometry",{width:1,height:6,depth:1}),e.setAttribute("material",{color:"#001122",emissive:"#00ffff",emissiveIntensity:.2,roughness:1,metalness:0}),e.setAttribute("position","0 3 0"),t.appendChild(e)}else{const e=document.createElement("a-cylinder");e.setAttribute("geometry",{radius:.5,height:8}),e.setAttribute("material",{color:"#001122",emissive:"#00ffff",emissiveIntensity:.3,transparent:!0,opacity:.8}),e.setAttribute("position","0 4 0");const i=document.createElement("a-sphere");i.setAttribute("geometry",{radius:.2}),i.setAttribute("material",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:.8}),i.setAttribute("position","0 8.5 0"),i.setAttribute("animation",{property:"material.emissiveIntensity",from:.8,to:.3,dur:2e3,dir:"alternate",loop:!0}),t.appendChild(e),t.appendChild(i)}return t},createObstacle:function(){return this.createFuturisticObstacle()},generateVegetation:function(){console.log("üå≥ Vegeta√ß√£o desabilitada para otimiza√ß√£o VR");const t=document.createElement("a-entity");t.setAttribute("id","vegetation"),this.urbanContainer.appendChild(t)},generateLighting:function(){console.log("üí° Postes de luz desabilitados para cen√°rio limpo");const t=document.createElement("a-entity");t.setAttribute("id","urban-lighting"),this.urbanContainer.appendChild(t)},createFuturisticStreetLight:function(){const t=document.createElement("a-entity");t.classList.add("futuristic-street-light");const e=document.createElement("a-cylinder");e.setAttribute("geometry",{radius:.1,height:6}),e.setAttribute("material",{color:"#001122",emissive:"#00ffff",emissiveIntensity:.2,transparent:!0,opacity:.7}),e.setAttribute("position","0 3 0"),t.appendChild(e);const i=document.createElement("a-sphere");return i.setAttribute("geometry",{radius:.3}),i.setAttribute("material",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:.6}),i.setAttribute("position","0 6.5 0"),i.setAttribute("animation",{property:"material.emissiveIntensity",from:.6,to:.2,dur:3e3,dir:"alternate",loop:!0}),t.appendChild(i),t},createStreetLight:function(){return this.createFuturisticStreetLight()},generateSkybox:function(){console.log("üåÜ Skybox customizado - pulando gera√ß√£o autom√°tica")}}),console.log("üì¶ M√≥dulo urban-environment.js carregado com sucesso!"),void 0===window.GAME_CONSTANTS&&(window.GAME_CONSTANTS={GRAVITY:-9.81,AIR_DENSITY:1.225,DRAG_COEFFICIENT:.47,DRONE_MASS:1.5,MAX_THRUST:18,MAX_ANGULAR_VELOCITY:5,DEADZONE:.1,SENSITIVITY:1,TARGET_FPS:90,MAX_PARTICLES:100,MASTER_VOLUME:.7,SFX_VOLUME:.5,IPD:.064,COMFORT_SETTINGS:{VIGNETTE:!0,SNAP_TURN:!1,TELEPORT:!1}},console.log("‚úÖ GAME_CONSTANTS definidas com sucesso!"));const MathUtils={degToRad:function(t){return t*(Math.PI/180)},radToDeg:function(t){return t*(180/Math.PI)},lerp:function(t,e,i){return t+(e-t)*Math.max(0,Math.min(1,i))},smoothStep:function(t,e,i){const o=Math.max(0,Math.min(1,(i-t)/(e-t)));return o*o*(3-2*o)},applyDeadzone:function(t,e=GAME_CONSTANTS.DEADZONE){const i=Math.abs(t);if(i<e)return 0;return Math.sign(t)*((i-e)/(1-e))},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},map:function(t,e,i,o,a){return(t-e)*(a-o)/(i-e)+o},distance3D:function(t,e){const i=t.x-e.x,o=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+o*o+a*a)},normalize3D:function(t){const e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0===e?{x:0,y:0,z:0}:{x:t.x/e,y:t.y/e,z:t.z/e}},dot3D:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},cross3D:function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},random:function(t,e){return Math.random()*(e-t)+t},randomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t}},PerformanceUtils={fpsMonitor:{frames:0,lastTime:0,fps:0,update:function(){this.frames++;const t=performance.now();return t-this.lastTime>=1e3&&(this.fps=Math.round(1e3*this.frames/(t-this.lastTime)),this.frames=0,this.lastTime=t),this.fps}},throttle:function(t,e){let i,o=0;return function(...a){const s=Date.now();s-o>e?(t.apply(this,a),o=s):(clearTimeout(i),i=setTimeout(()=>{t.apply(this,a),o=Date.now()},e-(s-o)))}},debounce:function(t,e){let i;return function(...o){clearTimeout(i),i=setTimeout(()=>t.apply(this,o),e)}},ObjectPool:function(t,e,i=10){this.createFn=t,this.resetFn=e,this.pool=[];for(let t=0;t<i;t++)this.pool.push(this.createFn());this.get=function(){return this.pool.length>0?this.pool.pop():this.createFn()},this.release=function(t){this.resetFn(t),this.pool.push(t)}}},VRUtils={isVRAvailable:function(){return"xr"in navigator&&"isSessionSupported"in navigator.xr},isInVR:function(){const t=document.querySelector("a-scene");return t&&t.is("vr-mode")},getVRControllers:function(){return{left:document.querySelector("#leftHand"),right:document.querySelector("#rightHand")}},triggerHaptic:function(t,e=.5,i=100){t&&t.components.haptics&&t.components.haptics.pulse(e,i)},getHeadsetPosition:function(){const t=document.querySelector("#camera");return t?t.getAttribute("position"):{x:0,y:0,z:0}},getHeadsetRotation:function(){const t=document.querySelector("#camera");return t?t.getAttribute("rotation"):{x:0,y:0,z:0}}},DebugUtils={log:function(t,e="info"){const i=`[${(new Date).toISOString().substr(11,12)}] [${e.toUpperCase()}]`;switch(e){case"error":console.error(i,t);break;case"warn":console.warn(i,t);break;case"debug":console.debug(i,t);break;default:console.log(i,t)}},showPerformanceInfo:function(){const t={fps:PerformanceUtils.fpsMonitor.fps,memory:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1048576)+" MB",total:Math.round(performance.memory.totalJSHeapSize/1048576)+" MB"}:"N/A",entities:document.querySelectorAll("a-entity").length,isVR:VRUtils.isInVR()};return console.table(t),t},createDebugPanel:function(){const t=document.createElement("a-entity");t.setAttribute("id","debug-panel"),t.setAttribute("position","2 2 -3");const e=document.createElement("a-plane");e.setAttribute("width","3"),e.setAttribute("height","2"),e.setAttribute("color","#000000"),e.setAttribute("opacity","0.7");const i=document.createElement("a-text");i.setAttribute("id","debug-text"),i.setAttribute("value","Debug Info"),i.setAttribute("color","#00ff00"),i.setAttribute("position","-1.4 0.8 0.01"),i.setAttribute("scale","0.5 0.5 0.5"),t.appendChild(e),t.appendChild(i);const o=document.querySelector("#camera");return o&&o.appendChild(t),t},updateDebugPanel:function(){const t=document.querySelector("#debug-text");if(!t)return;const e=this.showPerformanceInfo(),i=document.querySelector("#drone"),o=i?i.getAttribute("position"):{x:0,y:0,z:0},a=[`FPS: ${e.fps}`,`Entidades: ${e.entities}`,"VR: "+(e.isVR?"Sim":"N√£o"),`Drone: ${o.x.toFixed(1)}, ${o.y.toFixed(1)}, ${o.z.toFixed(1)}`,`Mem√≥ria: ${e.memory.used||"N/A"}`].join("\n");t.setAttribute("value",a)}},ValidationUtils={isValidNumber:function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)},isValidPosition:function(t){return t&&this.isValidNumber(t.x)&&this.isValidNumber(t.y)&&this.isValidNumber(t.z)},sanitizeInput:function(t,e="string"){switch(e){case"number":const e=parseFloat(t);return this.isValidNumber(e)?e:0;case"string":return String(t).trim();case"boolean":return Boolean(t);default:return t}}};window.GameUtils={CONSTANTS:GAME_CONSTANTS,Math:MathUtils,Performance:PerformanceUtils,VR:VRUtils,Debug:DebugUtils,Validation:ValidationUtils},document.addEventListener("DOMContentLoaded",function(){console.log("üîß Utilit√°rios do jogo carregados!"),setInterval(()=>{PerformanceUtils.fpsMonitor.update()},100);"true"===new URLSearchParams(window.location.search).get("debug")&&(console.log("üêõ Modo debug ativado!"),setTimeout(()=>{DebugUtils.createDebugPanel(),setInterval(()=>{DebugUtils.updateDebugPanel()},1e3)},2e3),document.addEventListener("keydown",function(t){if(t.ctrlKey)switch(t.key){case"p":DebugUtils.showPerformanceInfo(),t.preventDefault();break;case"r":location.reload(!0),t.preventDefault()}}))}),console.log("üì¶ M√≥dulo utils.js carregado com sucesso!");